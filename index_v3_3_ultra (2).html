<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Baustellenbericht v3.3 Ultra-Mega-DB - Fliesen Unger S√ºd</title>
    
    <!-- PWA Meta-Tags -->
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Baustellenbericht">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192x192.png">
    
    <!-- jsPDF f√ºr PDF-Export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        window.jsPDF = window.jspdf.jsPDF;
    </script>
    
    <!-- Leaflet f√ºr interaktive Karte (kostenlos, ohne API-Key!) -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <!-- Eruda Console f√ºr On-Device Debugging (v1.14 Feature) -->
    <script>
        // Eruda wird nur geladen wenn:
        // 1. Nicht sicherer Kontext ODER
        // 2. URL-Parameter ?debug=1
        const shouldLoadEruda = !window.isSecureContext || window.location.search.includes('debug=1');
        if (shouldLoadEruda) {
            const eruScript = document.createElement('script');
            eruScript.src = 'https://cdn.jsdelivr.net/npm/eruda@3.0.1/eruda.min.js';
            eruScript.onload = () => {
                if (typeof eruda !== 'undefined') {
                    eruda.init();
                    console.log('üõ†Ô∏è Eruda Debug Console aktiviert (v1.14)!');
                }
            };
            document.head.appendChild(eruScript);
        }
    </script>
    
    <!-- jsQR Library f√ºr QR-Code Fallback (v1.15 Feature) -->
    
    
    <!-- v2.0: Capacitor f√ºr Native-App Funktionalit√§t -->
    <script>
        // Capacitor wird nur geladen wenn als Native-App installiert
        // Im Browser wird es ignoriert
        window.isCapacitorApp = typeof window.Capacitor !== 'undefined' && window.Capacitor.isNativePlatform && window.Capacitor.isNativePlatform();
        
        // Log f√ºr Debugging
        console.log('üöÄ Baustellenbericht v3.3 Ultra-Mega-DB');
        console.log('üì± Capacitor verf√ºgbar:', window.isCapacitorApp ? 'JA (Native App)' : 'NEIN (Browser)');
    </script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background: #667eea;
            padding: 20px 10px;
        }
        
        /* TABS */
        .tabs {
            display: flex;
            max-width: 900px;
            margin: 0 auto 0 auto;
            background: white;
            border-radius: 12px 12px 0 0;
            overflow: hidden;
        }
        
        .tab {
            flex: 1;
            padding: 16px;
            border: none;
            background: #f1f5f9;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            color: #64748b;
            border-bottom: 3px solid transparent;
        }
        
        .tab.active {
            background: white;
            color: #dc2626;
            border-bottom: 3px solid #dc2626;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* RAPPORT FORM - EXAKTES ORIGINAL LAYOUT */
        .rapport-container {
            max-width: 900px;
            margin: 0 auto;
            background: #fff8dc; /* Gelb wie Original */
            padding: 30px;
            border: 4px solid #000;
            box-shadow: 0 8px 24px rgba(0,0,0,0.3);
        }
        
        /* HEADER */
        .rapport-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 3px solid #000;
        }
        
        .rapport-logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .logo-box {
            width: 60px;
            height: 60px;
            background: #dc2626;
            border: 3px solid #000;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            font-weight: bold;
            color: white;
        }
        
        .company-text {
            line-height: 1.1;
        }
        
        .company-name {
            font-size: 20px;
            font-weight: bold;
        }
        
        .company-name span {
            color: #dc2626;
        }
        
        .rapport-contact {
            text-align: right;
            font-size: 10px;
            line-height: 1.4;
        }
        
        /* RAPPORT NR SECTION */
        .rapport-nr-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border: 2px solid #000;
            background: #f5f5dc;
            margin-bottom: 15px;
        }
        
        .rapport-nr-box {
            padding: 12px 25px;
            border: 3px solid #000;
            background: white;
            font-weight: bold;
            font-size: 16px;
        }
        
        .rapport-worker-box {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            font-size: 10px;
        }
        
        .worker-checkbox {
            display: flex;
            gap: 5px;
            margin-top: 5px;
        }
        
        .worker-checkbox div {
            width: 40px;
            height: 25px;
            border: 2px solid #000;
            background: white;
        }
        
        /* HAUPTTABELLE */
        .rapport-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 15px;
        }
        
        .rapport-table th,
        .rapport-table td {
            border: 2px solid #000;
            padding: 8px;
            text-align: left;
            vertical-align: top;
        }
        
        .rapport-table th {
            background: #f0f0f0;
            font-weight: bold;
            font-size: 12px;
        }
        
        .rapport-table td {
            font-size: 11px;
            min-height: 30px;
        }
        
        .pos-col { width: 50px; }
        .datum-col { width: 100px; }
        .taetig-col { min-height: 40px; }
        
        /* Zeilen f√ºr manuelle Eingabe */
        .editable-row td {
            background: white;
        }
        
        .editable-row input,
        .editable-row textarea {
            width: 100%;
            border: none;
            background: transparent;
            font-family: Arial;
            font-size: 11px;
            padding: 4px;
        }
        
        .editable-row textarea {
            min-height: 80px;
            resize: vertical;
        }
        
        /* MATERIAL/MASCHINEN SECTIONS */
        .rapport-section {
            border: 2px solid #000;
            padding: 12px;
            margin-bottom: 15px;
            background: #f5f5dc;
        }
        
        .rapport-section-title {
            font-weight: bold;
            font-size: 13px;
            margin-bottom: 8px;
        }
        
        .rapport-section textarea {
            width: 100%;
            min-height: 80px;
            border: none;
            background: white;
            padding: 8px;
            font-family: Arial;
            font-size: 11px;
            resize: vertical;
        }
        
        /* UNTERSCHRIFTEN */
        .rapport-signatures {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        .signature-box {
            text-align: center;
        }
        
        .signature-pad {
            width: 100%;
            height: 120px;
            border: 2px solid #000;
            background: white;
            cursor: crosshair;
            touch-action: none;
            margin-bottom: 10px;
        }
        
        .signature-label {
            border-top: 2px solid #000;
            padding-top: 10px;
            font-size: 11px;
        }
        
        .signature-label strong {
            display: block;
            margin-top: 5px;
        }
        
        /* BUTTONS */
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: #dc2626;
            color: white;
        }
        
        .btn-primary:hover {
            background: #b91c1c;
        }
        
        .btn-secondary {
            background: #64748b;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #475569;
        }
        
        .btn-success {
            background: #10b981;
            color: white;
        }
        
        .btn-success:hover {
            background: #059669;
        }
        
        /* HELPER SECTIONS */
        .helper-section {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
        }
        
        .helper-section h4 {
            color: #dc2626;
            margin-bottom: 12px;
            font-size: 15px;
        }
        
        .helper-section label {
            display: block;
            font-weight: 600;
            margin-bottom: 6px;
            font-size: 13px;
        }
        
        .helper-section select,
        .helper-section input,
        .helper-section textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            font-size: 14px;
            margin-bottom: 10px;
        }
        
        .helper-section textarea {
            min-height: 80px;
            resize: vertical;
            font-family: Arial;
        }
        
        .chips-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 10px 0;
        }
        
        .chip {
            padding: 8px 14px;
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 16px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
        }
        
        .chip:hover {
            border-color: #dc2626;
            background: #fef2f2;
        }
        
        .chip.selected {
            background: #dc2626;
            color: white;
            border-color: #dc2626;
        }
        
        .chip.selected::after {
            content: ' ‚úÖ‚Äú';
        }
        
        /* LISTE */
        .berichte-liste {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            padding: 20px;
        }
        
        .bericht-card {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
        }
        
        .bericht-card h3 {
            color: #dc2626;
            margin-bottom: 8px;
        }
        
        .bericht-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 12px;
        }
        
        .bericht-actions .btn {
            padding: 8px 14px;
            font-size: 13px;
        }
        
        /* PHOTO GRID */
        .photo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
            margin: 10px 0;
        }
        
        .photo-item {
            position: relative;
            border: 2px solid #000;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .photo-item img {
            width: 100%;
            height: 100px;
            object-fit: cover;
        }
        
        .photo-delete {
            position: absolute;
            top: 4px;
            right: 4px;
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 50%;
            width: 26px;
            height: 26px;
            cursor: pointer;
            font-size: 14px;
        }
        
        /* TOAST */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #1e293b;
            color: white;
            padding: 14px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 9999;
            animation: slideIn 0.3s;
        }
        
        @keyframes slideIn {
            from { transform: translateX(400px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .toast.success {
            background: #10b981;
        }
        
        .toast.error {
            background: #ef4444;
        }
        
        .hidden {
            display: none !important;
        }
        
        /* ACTIONS BAR */
        .actions-bar {
            display: flex;
            gap: 10px;
            padding: 20px;
            background: white;
            border-top: 3px solid #000;
            flex-wrap: wrap;
        }
        
        /* GPS STATUS */
        .gps-status {
            padding: 12px;
            border-radius: 6px;
            font-size: 13px;
            margin: 10px 0;
        }
        
        .gps-success {
            background: #d1fae5;
            color: #065f46;
            border: 2px solid #10b981;
        }
        
        .gps-error {
            background: #fee2e2;
            color: #991b1b;
            border: 2px solid #ef4444;
        }
        
        .gps-loading {
            background: #dbeafe;
            color: #1e40af;
            border: 2px solid #3b82f6;
        }
        
        @media (max-width: 768px) {
            .rapport-header {
                flex-direction: column;
                gap: 15px;
            }
            
            .rapport-contact {
                text-align: left;
            }
            
            .rapport-signatures {
                grid-template-columns: 1fr;
            }
        }
        
        /* MIKROFON PERMISSION MODAL */
        .mic-modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(4px);
        }
        
        .mic-modal-content {
            background-color: white;
            margin: 15% auto;
            padding: 30px;
            border: 3px solid #dc2626;
            border-radius: 12px;
            width: 90%;
            max-width: 450px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            text-align: center;
        }
        
        .mic-modal h3 {
            color: #dc2626;
            margin-bottom: 20px;
            font-size: 22px;
        }
        
        .mic-modal p {
            margin-bottom: 25px;
            line-height: 1.6;
            color: #4b5563;
        }
        
        .mic-modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        
        .mic-modal-buttons button {
            padding: 12px 24px;
            font-size: 16px;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .mic-modal-allow {
            background: #dc2626;
            color: white;
        }
        
        .mic-modal-allow:hover {
            background: #b91c1c;
            transform: translateY(-2px);
        }
        
        .mic-modal-later {
            background: #e5e7eb;
            color: #4b5563;
        }
        
        .mic-modal-later:hover {
            background: #d1d5db;
        }
        
        /* ===== SETUP ASSISTANT MODAL ===== */
        .setup-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            z-index: 100000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            animation: fadeIn 0.3s;
        }
        
        .setup-modal.hidden {
            display: none;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .setup-content {
            background: white;
            border-radius: 16px;
            max-width: 700px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            animation: slideUp 0.3s;
        }
        
        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .setup-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 16px 16px 0 0;
            text-align: center;
        }
        
        .setup-header h2 {
            margin: 0 0 10px 0;
            font-size: 28px;
        }
        
        .setup-header p {
            margin: 0;
            opacity: 0.9;
            font-size: 14px;
        }
        
        .setup-body {
            padding: 30px;
        }
        
        .setup-warning {
            background: #fee;
            border-left: 4px solid #dc2626;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 25px;
        }
        
        .setup-warning strong {
            display: block;
            color: #dc2626;
            margin-bottom: 5px;
        }
        
        .setup-step {
            margin-bottom: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
            border: 2px solid #e9ecef;
        }
        
        .setup-step-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
        }
        
        .setup-step-number {
            background: #667eea;
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }
        
        .setup-step-title {
            font-weight: bold;
            font-size: 16px;
            color: #1f2937;
        }
        
        .setup-step-content {
            margin-left: 44px;
        }
        
        .setup-command {
            background: #1f2937;
            color: #10b981;
            padding: 12px 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            margin: 10px 0;
            position: relative;
            overflow-x: auto;
            white-space: pre;
        }
        
        .setup-copy-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background: #374151;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }
        
        .setup-copy-btn:hover {
            background: #4b5563;
        }
        
        .setup-copy-btn:active {
            transform: scale(0.95);
        }
        
        .setup-copy-btn.copied {
            background: #10b981;
        }
        
        .setup-info {
            background: #eff6ff;
            border-left: 4px solid #3b82f6;
            padding: 12px;
            border-radius: 6px;
            font-size: 14px;
            margin: 10px 0;
        }
        
        .setup-success {
            background: #f0fdf4;
            border-left: 4px solid #10b981;
            padding: 12px;
            border-radius: 6px;
            font-size: 14px;
            margin: 10px 0;
        }
        
        .setup-ip-box {
            background: #fff;
            border: 2px solid #667eea;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            margin: 15px 0;
        }
        
        .setup-ip-box strong {
            display: block;
            color: #667eea;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .setup-ip-box .ip-address {
            font-size: 24px;
            font-weight: bold;
            color: #1f2937;
            font-family: 'Courier New', monospace;
        }
        
        .setup-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            border-bottom: 2px solid #e5e7eb;
        }
        
        .setup-tab {
            padding: 10px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 500;
            color: #6b7280;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
        }
        
        .setup-tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }
        
        .setup-tab-content {
            display: none;
        }
        
        .setup-tab-content.active {
            display: block;
        }
        
        .setup-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #e5e7eb;
        }
        
        .setup-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
        }
        
        .setup-btn-primary {
            background: #667eea;
            color: white;
        }
        
        .setup-btn-primary:hover {
            background: #5568d3;
        }
        
        .setup-btn-secondary {
            background: #e5e7eb;
            color: #374151;
        }
        
        .setup-btn-secondary:hover {
            background: #d1d5db;
        }
        
        .setup-checkbox {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            margin: 5px 0;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .setup-checkbox:hover {
            background: #f3f4f6;
        }
        
        .setup-checkbox input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
        
        .setup-file-note {
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
            padding: 12px;
            border-radius: 6px;
            font-size: 14px;
            margin: 15px 0;
        }
        
        .setup-minimize-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.2s;
        }
        
        .setup-minimize-btn:hover {
            background: rgba(255,255,255,0.3);
        }
        
        .setup-reopen-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #dc2626;
            color: white;
            border: none;
            padding: 15px 20px;
            border-radius: 50px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 8px 24px rgba(220, 38, 38, 0.4);
            z-index: 99999;
            animation: pulse 2s infinite;
        }
        
        .setup-reopen-btn.hidden {
            display: none;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .setup-qr {
            text-align: center;
            padding: 20px;
            background: white;
            border-radius: 8px;
            margin: 15px 0;
        }
        
        .setup-qr img {
            max-width: 200px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
        }
        
        /* ===== v1.14 FEATURES: HTTPS WARNING BANNER ===== */
        .https-warning-banner {
            max-width: 900px;
            margin: 0 auto 10px;
            background: #fef3c7;
            border: 3px solid #f59e0b;
            border-radius: 8px;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .https-warning-banner .warning-icon {
            font-size: 32px;
            flex-shrink: 0;
        }
        
        .https-warning-banner .warning-content {
            flex: 1;
        }
        
        .https-warning-banner .warning-title {
            font-weight: bold;
            font-size: 16px;
            color: #92400e;
            margin-bottom: 5px;
        }
        
        .https-warning-banner .warning-text {
            font-size: 13px;
            color: #78350f;
            margin-bottom: 8px;
        }
        
        .https-warning-banner .protocol-info {
            font-family: monospace;
            background: #fde68a;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            display: inline-block;
        }
        
        .https-warning-banner .btn-help {
            padding: 8px 16px;
            background: #f59e0b;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            white-space: nowrap;
        }
        
        .https-warning-banner .btn-help:hover {
            background: #d97706;
        }
        
        /* ===== v1.14 FEATURES: DEBUG INFO BOX ===== */
        .debug-info-box {
            position: fixed;
            top: 10px;
            right: 10px;
            background: #1e293b;
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 12px;
            z-index: 10000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            max-width: 280px;
        }
        
        .debug-info-box .debug-title {
            font-weight: bold;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .debug-info-box .debug-line {
            margin: 4px 0;
            display: flex;
            justify-content: space-between;
            gap: 10px;
        }
        
        .debug-info-box .debug-label {
            opacity: 0.7;
        }
        
        .debug-info-box .debug-value {
            font-weight: bold;
        }
        
        .debug-info-box .btn-close-debug {
            margin-top: 10px;
            padding: 6px 12px;
            background: #64748b;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
            width: 100%;
        }
        
        /* ===== v1.15 FEATURES: GPS SOURCE BADGE ===== */
        .gps-source-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            margin-left: 10px;
            vertical-align: middle;
        }
        
        .gps-source-badge.source-gps {
            background: #d1fae5;
            color: #065f46;
            border: 2px solid #10b981;
        }
        
        .gps-source-badge.source-ip {
            background: #fef3c7;
            color: #92400e;
            border: 2px solid #f59e0b;
        }
        
        .gps-source-badge .badge-icon {
            font-size: 13px;
        }
        
        /* ===== v1.15 FEATURES: QR SCANNER OVERLAY ===== */
        .qr-scanner-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 10001;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .qr-scanner-overlay .scanner-header {
            color: white;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .qr-scanner-overlay .scanner-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .qr-scanner-overlay .scanner-instructions {
            font-size: 14px;
            opacity: 0.8;
        }
        
        .qr-scanner-overlay .scanner-video-container {
            position: relative;
            max-width: 500px;
            width: 100%;
            background: #000;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0,0,0,0.5);
        }
        
        .qr-scanner-overlay video {
            width: 100%;
            height: auto;
            display: block;
        }
        
        .qr-scanner-overlay canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        .qr-scanner-overlay .scanner-target-box {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 250px;
            height: 250px;
            border: 3px solid #10b981;
            border-radius: 12px;
            box-shadow: 0 0 0 99999px rgba(0, 0, 0, 0.5);
        }
        
        .qr-scanner-overlay .scanner-corners {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
        }
        
        .qr-scanner-overlay .corner {
            position: absolute;
            width: 30px;
            height: 30px;
            border: 4px solid #10b981;
        }
        
        .qr-scanner-overlay .corner.top-left {
            top: -2px;
            left: -2px;
            border-right: none;
            border-bottom: none;
        }
        
        .qr-scanner-overlay .corner.top-right {
            top: -2px;
            right: -2px;
            border-left: none;
            border-bottom: none;
        }
        
        .qr-scanner-overlay .corner.bottom-left {
            bottom: -2px;
            left: -2px;
            border-right: none;
            border-top: none;
        }
        
        .qr-scanner-overlay .corner.bottom-right {
            bottom: -2px;
            right: -2px;
            border-left: none;
            border-top: none;
        }
        
        .qr-scanner-overlay .scanner-status {
            margin-top: 20px;
            padding: 12px 24px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: white;
            font-size: 14px;
        }
        
        .qr-scanner-overlay .scanner-buttons {
            margin-top: 20px;
            display: flex;
            gap: 12px;
        }
        
        .qr-scanner-overlay .btn-scanner {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .qr-scanner-overlay .btn-scanner-close {
            background: #ef4444;
            color: white;
        }
        
        .qr-scanner-overlay .btn-scanner-close:hover {
            background: #dc2626;
        }
        
        /* ===== v1.15 FEATURES: AUDIO RECORDING INDICATOR ===== */
        .audio-recording-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: #fef2f2;
            border: 2px solid #ef4444;
            border-radius: 8px;
            color: #991b1b;
            font-size: 13px;
            font-weight: 600;
            margin-left: 10px;
            animation: pulse-recording 1.5s ease-in-out infinite;
        }
        
        @keyframes pulse-recording {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
        
        .audio-recording-indicator .recording-dot {
            width: 10px;
            height: 10px;
            background: #ef4444;
            border-radius: 50%;
            animation: blink-dot 1s ease-in-out infinite;
        }
        
        @keyframes blink-dot {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        
        .audio-recording-indicator .recording-time {
            font-family: monospace;
            font-size: 14px;
        }
        
        /* ===== v1.14/v1.15: HTTPS SETUP MODAL ===== */
        .https-setup-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 10002;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            overflow-y: auto;
        }
        
        .https-setup-modal .modal-content {
            background: white;
            border-radius: 12px;
            max-width: 700px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }
        
        .https-setup-modal .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 24px;
            border-radius: 12px 12px 0 0;
        }
        
        .https-setup-modal .modal-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .https-setup-modal .modal-subtitle {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .https-setup-modal .modal-body {
            padding: 24px;
        }
        
        .https-setup-modal .setup-section {
            margin-bottom: 24px;
            padding: 20px;
            background: #f8fafc;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        
        .https-setup-modal .setup-section-title {
            font-size: 18px;
            font-weight: bold;
            color: #1e293b;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .https-setup-modal .setup-section-time {
            display: inline-block;
            padding: 4px 10px;
            background: #dbeafe;
            color: #1e40af;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .https-setup-modal .setup-steps {
            margin-top: 12px;
        }
        
        .https-setup-modal .setup-step {
            margin: 10px 0;
            padding: 12px;
            background: white;
            border-radius: 6px;
            border: 1px solid #e2e8f0;
        }
        
        .https-setup-modal .setup-step-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            background: #667eea;
            color: white;
            border-radius: 50%;
            font-weight: bold;
            font-size: 12px;
            margin-right: 10px;
        }
        
        .https-setup-modal .setup-code {
            background: #1e293b;
            color: #10b981;
            padding: 12px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 13px;
            margin: 10px 0;
            overflow-x: auto;
            white-space: pre;
        }
        
        .https-setup-modal .setup-note {
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
            padding: 12px;
            border-radius: 6px;
            font-size: 13px;
            color: #78350f;
            margin: 10px 0;
        }
        
        .https-setup-modal .setup-note strong {
            color: #92400e;
        }
        
        .https-setup-modal .modal-footer {
            padding: 20px 24px;
            border-top: 2px solid #e2e8f0;
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }
        
        .https-setup-modal .btn-modal {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .https-setup-modal .btn-modal-close {
            background: #64748b;
            color: white;
        }
        
        .https-setup-modal .btn-modal-close:hover {
            background: #475569;
        }
        
        /* ===== V3.0 NEUE FEATURES ===== */
        
        /* Statistik-Karten */
        .stat-card {
            padding: 20px;
            border-radius: 15px;
            color: white;
            text-align: center;
        }
        
        .stat-icon {
            font-size: 30px;
            margin-bottom: 10px;
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: bold;
        }
        
        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }
        
        /* Stats Buttons */
        .stats-btn {
            padding: 10px 20px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s;
        }
        
        .stats-btn.active, .stats-btn:hover {
            background: #667eea;
            color: white;
        }
        
        /* Kalender */
        .kalender-tag {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: #f8fafc;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }
        
        .kalender-tag:hover {
            background: #e2e8f0;
        }
        
        .kalender-tag.heute {
            background: #667eea;
            color: white;
        }
        
        .kalender-tag.hat-bericht::after {
            content: 'üìã';
            position: absolute;
            bottom: 2px;
            font-size: 10px;
        }
        
        .kalender-tag.leer {
            background: transparent;
            cursor: default;
        }
        
        .kalender-header {
            font-weight: bold;
            color: #64748b;
            text-align: center;
            padding: 10px 0;
        }
        
        /* Stoppuhr */
        .stoppuhr-container {
            background: linear-gradient(135deg, #1e293b, #334155);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            color: white;
            margin-bottom: 15px;
        }
        
        .stoppuhr-display {
            font-size: 48px;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            margin: 15px 0;
            text-shadow: 0 0 20px rgba(102, 126, 234, 0.5);
        }
        
        .stoppuhr-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .stoppuhr-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .stoppuhr-btn.start {
            background: #22c55e;
            color: white;
        }
        
        .stoppuhr-btn.stop {
            background: #ef4444;
            color: white;
        }
        
        .stoppuhr-btn.uebernehmen {
            background: #667eea;
            color: white;
        }
        
        .stoppuhr-btn.reset {
            background: #64748b;
            color: white;
        }
        
        /* Wetter Widget */
        .wetter-widget {
            background: linear-gradient(135deg, #4facfe, #00f2fe);
            border-radius: 15px;
            padding: 15px 20px;
            color: white;
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .wetter-icon {
            font-size: 40px;
        }
        
        .wetter-info {
            flex: 1;
        }
        
        .wetter-temp {
            font-size: 28px;
            font-weight: bold;
        }
        
        .wetter-desc {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .wetter-warning {
            background: linear-gradient(135deg, #f97316, #ef4444);
        }
        
        /* Quick Actions Bar */
        .quick-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .quick-action-btn {
            flex: 1;
            min-width: 100px;
            padding: 12px;
            border: none;
            border-radius: 10px;
            background: #f1f5f9;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            transition: all 0.2s;
        }
        
        .quick-action-btn:hover {
            background: #e2e8f0;
            transform: translateY(-2px);
        }
        
        .quick-action-btn .icon {
            font-size: 24px;
        }
        
        /* Projekt-Karte */
        .projekt-card {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s;
        }
        
        .projekt-card:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }
        
        .projekt-card.aktiv {
            border-color: #22c55e;
            background: #f0fdf4;
        }
        
        .projekt-info h4 {
            margin: 0 0 5px 0;
            color: #1e293b;
        }
        
        .projekt-info span {
            color: #64748b;
            font-size: 14px;
        }
        
        .projekt-actions {
            display: flex;
            gap: 8px;
        }
        
        .projekt-actions button {
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }
        
        /* Dark Mode */
        body.dark-mode {
            background: #1e293b;
        }
        
        body.dark-mode .rapport-container {
            background: #334155;
            border-color: #475569;
        }
        
        body.dark-mode .tabs {
            background: #1e293b;
        }
        
        body.dark-mode .tab {
            background: #334155;
            color: #94a3b8;
        }
        
        body.dark-mode .tab.active {
            background: #475569;
            color: #f1f5f9;
        }
        
        body.dark-mode .helper-section {
            background: #475569;
        }
        
        body.dark-mode input,
        body.dark-mode select,
        body.dark-mode textarea {
            background: #334155;
            color: #f1f5f9;
            border-color: #475569;
        }
        
        body.dark-mode h4 {
            color: #f1f5f9;
        }
        
        /* Dark Mode Toggle */
        .dark-mode-toggle {
            position: fixed;
            bottom: 20px;
            left: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: #1e293b;
            color: white;
            border: none;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 1000;
            transition: all 0.3s;
        }
        
        body.dark-mode .dark-mode-toggle {
            background: #fbbf24;
            color: #1e293b;
        }
        
        /* Vorlagen Dropdown */
        .vorlagen-section {
            background: #fef3c7;
            border: 2px solid #f59e0b;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .vorlagen-section select {
            width: 100%;
            padding: 12px;
            border: 2px solid #f59e0b;
            border-radius: 8px;
            font-size: 16px;
            background: white;
        }
        
        /* Top Baustelle Bar */
        .top-baustelle-bar {
            display: flex;
            align-items: center;
            padding: 10px;
            background: white;
            border-radius: 8px;
            margin-bottom: 8px;
        }
        
        .top-baustelle-bar .rank {
            width: 30px;
            font-weight: bold;
            color: #667eea;
        }
        
        .top-baustelle-bar .name {
            flex: 1;
        }
        
        .top-baustelle-bar .hours {
            font-weight: bold;
            color: #22c55e;
        }
        
        .top-baustelle-bar .bar {
            height: 8px;
            background: #22c55e;
            border-radius: 4px;
            margin-left: 10px;
        }
    </style>
    <!-- v3.3 Ultra-Mega-DB: Puter.js f√ºr kostenlose KI -->
    <script src="https://js.puter.com/v2/"></script>
</head>
<body>
    <!-- MIKROFON PERMISSION PRIMING MODAL -->
    <div id="micPermissionModal" class="mic-modal">
        <div class="mic-modal-content">
            <h3>üé§ Spracherfassung aktivieren</h3>
            <p><strong>Diktieren Sie Ihre Berichte hands-free!</strong></p>
            <p style="color: #64748b; margin: 15px 0;">
                Wir ben√∂tigen Mikrofonzugriff, damit Sie Baustellennotizen sprechen k√∂nnen statt zu tippen - 
                ideal bei Handschuhen oder schmutzigen H√§nden auf der Baustelle.
            </p>
            <p id="httpsWarning" style="display: none; background: #fef3c7; padding: 10px; border-radius: 6px; color: #92400e; margin: 10px 0;">
                <strong>‚ö†Ô∏è HTTPS erforderlich!</strong><br>
                Mikrofon funktioniert nur √ºber sichere Verbindung (HTTPS) oder localhost.
            </p>
            <p style="font-size: 13px; color: #94a3b8; margin-top: 15px;">
                ‚ÑπÔ∏è Ihre Privatsph√§re: Wir speichern keine Aufnahmen. Die Spracheingabe wird nur zur sofortigen Texterkennung verwendet.
            </p>
            <div class="mic-modal-buttons">
                <button class="mic-modal-allow" onclick="allowMicrophone()">üé§ Mikrofon aktivieren</button>
                <button class="mic-modal-later" onclick="closeMicModal()">‚úÖ¬èÔ∏è Lieber tippen</button>
            </div>
        </div>
    </div>

    <!-- v1.14/v1.15: HTTPS WARNING BANNER (wird nur bei http:// gezeigt) -->
    <div id="httpsWarningBanner" class="https-warning-banner" style="display: none;">
        <div class="warning-icon">‚ö†Ô∏è</div>
        <div class="warning-content">
            <div class="warning-title">GPS & SPRACHEINGABE BEN√ñTIGEN HTTPS!</div>
            <div class="warning-text">
                Aktuelle Verbindung: <span class="protocol-info" id="currentProtocol"></span>
            </div>
        </div>
        <button class="btn-help" onclick="showHTTPSSetupModal()">üí° Anleitung anzeigen</button>
    </div>
    
    <!-- v1.14: DEBUG INFO BOX (wird nur bei !isSecureContext gezeigt) -->
    <div id="debugInfoBox" class="debug-info-box" style="display: none;">
        <div class="debug-title">üõ†Ô∏è Debug Info</div>
        <div class="debug-line">
            <span class="debug-label">Protocol:</span>
            <span class="debug-value" id="debugProtocol"></span>
        </div>
        <div class="debug-line">
            <span class="debug-label">Secure Context:</span>
            <span class="debug-value" id="debugSecure"></span>
        </div>
        <div class="debug-line">
            <span class="debug-label">GPS API:</span>
            <span class="debug-value" id="debugGPS"></span>
        </div>
        <div class="debug-line">
            <span class="debug-label">Speech API:</span>
            <span class="debug-value" id="debugSpeech"></span>
        </div>
        <div class="debug-line">
            <span class="debug-label">Barcode API:</span>
            <span class="debug-value" id="debugBarcode"></span>
        </div>
        <button class="btn-close-debug" onclick="closeDebugBox()">Schlie√üen</button>
    </div>

    <!-- TABS -->
    <div class="tabs">
        <button class="tab active" onclick="switchToTab('neu')">üìù Neu</button>
        <button class="tab" onclick="switchToTab('liste')">üìã Berichte</button>
        <button class="tab" onclick="switchToTab('projekte')">üìÅ Projekte</button>
        <button class="tab" onclick="switchToTab('statistiken')">üìä Stats</button>
        <button class="tab" onclick="switchToTab('kalender')">üìÖ Kalender</button>
    </div>
    
    <!-- TAB: NEUER BERICHT -->
    <div class="tab-content active" id="tab-neu">
        <!-- HELPER SECTIONS (VOR DEM FORMULAR) -->
        <div style="max-width: 900px; margin: 0 auto; background: white; padding: 20px;">
            <!-- PROJEKTNUMMER & BAUSTELLE -->
            
            <!-- V3.0: WETTER WIDGET -->
            <div class="wetter-widget" id="wetterWidget">
                <div class="wetter-icon" id="wetterIcon">üå§Ô∏è</div>
                <div class="wetter-info">
                    <div class="wetter-temp" id="wetterTemp">--¬∞C</div>
                    <div class="wetter-desc" id="wetterDesc">Wetter wird geladen...</div>
                </div>
                <div id="wetterOrt" style="font-size: 12px;">üìç --</div>
            </div>
            
            <!-- V3.0: STOPPUHR -->
            <div class="stoppuhr-container">
                <div style="font-size: 14px; margin-bottom: 5px;">‚è±Ô∏è Arbeitszeit-Stoppuhr</div>
                <div class="stoppuhr-display" id="stoppuhrDisplay">00:00:00</div>
                <div class="stoppuhr-buttons">
                    <button class="stoppuhr-btn start" id="stoppuhrStart" onclick="toggleStoppuhr()">‚ñ∂Ô∏è Start</button>
                    <button class="stoppuhr-btn reset" onclick="resetStoppuhr()">üîÑ Reset</button>
                    <button class="stoppuhr-btn uebernehmen" onclick="stoppuhrUebernehmen()">‚úÖ √úbernehmen</button>
                </div>
            </div>
            
            <!-- V3.0: QUICK ACTIONS -->
            <div class="quick-actions">
                <button class="quick-action-btn" onclick="navigateToBaustelle()">
                    <span class="icon">üß≠</span>
                    <span>Navigation</span>
                </button>
                <button class="quick-action-btn" onclick="schnellFoto()">
                    <span class="icon">üì∑</span>
                    <span>Foto</span>
                </button>
                <button class="quick-action-btn" onclick="callBuero()">
                    <span class="icon">üìû</span>
                    <span>B√ºro anrufen</span>
                </button>
                <button class="quick-action-btn" onclick="showAbwesenheit()">
                    <span class="icon">üìù</span>
                    <span>Abwesenheit</span>
                </button>
            </div>
            
            <!-- V3.0: VORLAGEN -->
            <div class="vorlagen-section">
                <h4 style="margin: 0 0 10px 0;">üìã Schnellvorlage laden</h4>
                <select id="vorlageSelect" onchange="loadVorlage(this.value)">
                    <option value="">-- Vorlage w√§hlen --</option>
                    <option value="fliesen-standard">üî≤ Standard Fliesenarbeit</option>
                    <option value="fliesen-bad">üöø Badezimmer komplett</option>
                    <option value="fliesen-kueche">üç≥ K√ºche</option>
                    <option value="fliesen-boden">‚¨ú Bodenfliesen</option>
                    <option value="fliesen-wand">üß± Wandfliesen</option>
                    <option value="naturstein">ü™® Naturstein</option>
                    <option value="reparatur">üîß Reparatur/Ausbesserung</option>
                    <option value="aufmass">üìê Nur Aufma√ü</option>
                </select>
            </div>
            
<div class="helper-section">
                <h4>üìã Projekt-Informationen</h4>
                <label>Projektnummer:</label>
                <input type="text" id="projektnummerHelper" placeholder="z.B. P-2024-001">
                <label>Baustelle:</label>
                <input type="text" id="baustelleHelper" placeholder="z.B. Aldi Sindelfingen">
                <button type="button" class="btn btn-success" onclick="copyProjektInfo()">‚úÖ‚Äú √úbernehmen</button>
            </div>
            
            <!-- GPS -->
            <div class="helper-section">
                <h4>üìç GPS Position</h4>
                <div id="gpsStatus" class="gps-status">üìç Klicke auf "üîÑ GPS neu erfassen" um Standort zu ermitteln</div>
                <button type="button" class="btn btn-secondary" onclick="getGPS()">üîÑ GPS neu erfassen</button>
                <button type="button" class="btn btn-primary" onclick="openMapPicker()" style="margin-left: 10px;">üó∫Ô∏è Karte √∂ffnen</button>
                
                <input type="hidden" id="gpsLat">
                <input type="hidden" id="gpsLon">
            </div>
            
            <!-- T√ÑTIGKEITEN HELPER -->
            <div class="helper-section">
                <h4>üî® T√§tigkeiten hinzuf√ºgen</h4>
                <label>Position:</label>
                <input type="text" id="taetigkeitPosition" placeholder="z.B. 1 oder 1.1" style="width: 100px;">
                <label>Menge:</label>
                <input type="number" id="taetigkeitMenge" placeholder="z.B. 15" min="0" step="0.1" style="width: 100px;">
                <label>Einheit:</label>
                <select id="taetigkeitEinheit" style="width: 120px;">
                    <option value="">--</option>
                    <option value="Kartons">Kartons</option>
                    <option value="Pakete">Pakete</option>
                    <option value="St√ºck">St√ºck</option>
                    <option value="m¬≤">m¬≤</option>
                    <option value="Laufmeter">Laufmeter</option>
                    <option value="kg">kg</option>
                    <option value="Liter">Liter</option>
                    <option value="Sack">Sack</option>
                    <option value="Eimer">Eimer</option>
                    <option value="Stunden">Stunden</option>
                    <option value="Pauschal">Pauschal</option>
                </select>
                <label>Kategorie w√§hlen:</label>
                <select id="taetigkeitHaupt" onchange="showTaetigkeiten()">
                    <option value="">-- Bitte w√§hlen --</option>
                    <option value="vorbereitung">üõ†Ô∏è Vorbereitung & Untergrund</option>
                    <option value="verlegung">üî® Fliesenverlegung</option>
                    <option value="verfugung">üß± Verfugung & Abdichtung</option>
                    <option value="sanierung">üîß Sanierung & Reparatur</option>
                    <option value="spezial">‚≠ê¬ê Spezialarbeiten</option>
                    <option value="abschluss">‚úÖ Abschlussarbeiten</option>
                </select>
                <div id="taetigkeitenChips" class="chips-container"></div>
                <button type="button" class="btn btn-success" onclick="addSelectedToForm()">‚ûï Zur Tabelle hinzuf√ºgen</button>
                <button type="button" class="btn btn-secondary" onclick="addTaetigkeitViaVoice()">üé§ Per Sprache hinzuf√ºgen</button>
                
                
            </div>
            
            <!-- MATERIAL HELPER -->
            <div class="helper-section">
                <h4>üì¶ Material</h4>
                <label>Menge:</label>
                <input type="number" id="materialMenge" min="0" step="1" placeholder="z.B. 5" style="width: 80px;">
                <label>Einheit:</label>
                <select id="materialEinheit" style="width: 120px;">
                    <option value="">--</option>
                    <option value="Kartons">Kartons</option>
                    <option value="Pakete">Pakete</option>
                    <option value="St√ºck">St√ºck</option>
                    <option value="m¬≤">m¬≤</option>
                    <option value="kg">kg</option>
                    <option value="Liter">Liter</option>
                    <option value="Sack">Sack</option>
                </select>
                <label>Laufmeter:</label>
                <input type="number" id="materialLaufmeter" min="0" step="0.1" placeholder="z.B. 15" style="width: 100px;">
                <label>Kategorie w√§hlen:</label>
                <select id="materialHaupt" onchange="showMaterial()">
                    <option value="">-- Bitte w√§hlen --</option>
                    <option value="fliesen">üß± Fliesen</option>
                    <option value="kleber">üß± Kleber & M√∂rtel</option>
                    <option value="fugen">‚¨ú Fugenmaterial</option>
                    <option value="abdichtung">üíß Abdichtung</option>
                    <option value="profile">üë§ Profile & Schienen</option>
                    <option value="sonstiges">üì¶ Sonstiges</option>
                </select>
                <div id="materialChips" class="chips-container"></div>
                <label>Zus√§tzliche Eingabe:</label>
                <textarea id="materialHelperText" placeholder="Material hier eingeben..."></textarea>
                <button type="button" class="btn btn-success" onclick="addMaterialToForm()">‚ûï √úbernehmen</button>
                <button type="button" class="btn btn-secondary" onclick="startVoiceInputHelper('materialHelperText')">üé§ Spracheingabe</button>
            </div>
            
            <!-- WERKZEUGE HELPER -->
            <div class="helper-section">
                <h4>üîß Werkzeuge & Maschinen</h4>
                <label>Kategorie w√§hlen:</label>
                <select id="werkzeugeHaupt" onchange="showWerkzeuge()">
                    <option value="">-- Bitte w√§hlen --</option>
                    <option value="schneiden">‚úÇÔ∏è Schneidwerkzeuge</option>
                    <option value="kleber">üî® Klebewerkzeuge</option>
                    <option value="fugen">üßΩ Fugenwerkzeuge</option>
                    <option value="maschinen">‚öôÔ∏è Maschinen</option>
                    <option value="messen">üìê Messger√§te</option>
                    <option value="handwerkzeug">üîß Handwerkzeuge</option>
                </select>
                <div id="werkzeugeChips" class="chips-container"></div>
                <label>Zus√§tzliche Eingabe:</label>
                <textarea id="werkzeugeHelperText" placeholder="Maschinen/Werkzeuge hier eingeben..."></textarea>
                <button type="button" class="btn btn-success" onclick="addWerkzeugeToForm()">‚ûï √úbernehmen</button>
                <button type="button" class="btn btn-secondary" onclick="startVoiceInputHelper('werkzeugeHelperText')">üé§ Spracheingabe</button>
            </div>
            
            <!-- PERSONAL -->
            <div class="helper-section">
                <h4>üë∑ Personal</h4>
                <label>Anzahl:</label>
                <input type="number" id="personalAnzahl" value="1" min="1" max="99" placeholder="1" style="width: 80px;">
                <label>Mitarbeiter-Typ:</label>
                <select id="personalTyp">
                    <option value="Vorarbeiter">Vorarbeiter</option>
                    <option value="Facharbeiter">Facharbeiter</option>
                    <option value="Fachhelfer">Fachhelfer</option>
                    <option value="Lehrling">Lehrling</option>
                </select>
                <label>Stunden:</label>
                <input type="number" id="personalStunden" step="0.5" min="0" placeholder="8.0">
                <button type="button" class="btn btn-secondary" onclick="addPersonal()">‚ûï Hinzuf√ºgen</button>
                <div id="personalListe" style="margin-top: 10px;"></div>
            </div>
            
            <!-- FAHRZEUGE -->
            <div class="helper-section">
                <h4>üöó Fahrzeuge</h4>
                <label>Anzahl:</label>
                <input type="number" id="fahrzeugAnzahl" value="1" min="1" max="99" placeholder="1" style="width: 80px;">
                <label>Fahrzeugtyp:</label>
                <select id="fahrzeugTyp">
                    <option value="PKW">PKW</option>
                    <option value="Transporter">Transporter</option>
                    <option value="LKW">LKW</option>
                    <option value="Anh√§nger">Anh√§nger</option>
                </select>
                <label>Kennzeichen:</label>
                <input type="text" id="fahrzeugKennzeichen" placeholder="z.B. S-AB 1234">
                <label>Kilometer:</label>
                <input type="number" id="fahrzeugKm" placeholder="z.B. 125">
                <button type="button" class="btn btn-secondary" onclick="addFahrzeug()">‚ûï Hinzuf√ºgen</button>
                <div id="fahrzeugListe" style="margin-top: 10px;"></div>
            </div>
            
            <!-- FOTOS -->
            <div class="helper-section">
                <h4>üì∑ Fotos</h4>
                <input type="file" id="photoInput" accept="image/*" capture="environment" multiple style="display: none;" onchange="handlePhotos(event)">
                <button type="button" class="btn btn-success" onclick="document.getElementById('photoInput').click()">üñº Fotos hinzuf√ºgen</button>
                <div id="photoGrid" class="photo-grid"></div>
            </div>
        </div>
        
        <!-- DAS EIGENTLICHE FORMULAR (EXAKTES ORIGINAL LAYOUT) -->
        <div class="rapport-container">
            <!-- HEADER -->
            <div class="rapport-header">
                <div class="rapport-logo">
                    <div class="logo-box">F</div>
                    <div class="company-text">
                        <div class="company-name">FLIESEN<span>UNGER</span></div>
                        <div class="company-name">S√úD!</div>
                    </div>
                </div>
                <div class="rapport-contact">
                    Tulpenallee 69<br>
                    71069 Sindelfingen<br>
                    Telefon: 07031/9219 9-0<br>
                    Fax: 07031/9219 9-10<br>
                    E-Mail: <a href="/cdn-cgi/l/email-protection#1a73747c755a7c76737f697f74376f747d7f6837696f7f7e347e7f"><span class="__cf_email__" data-cfemail="afc6c1c9c0efc9c3c6cadccac182dac1c8cadd82dcdacacb81cbca">[email&#160;protected]</span></a><br>
                    Website: www.fliesen-unger-sued.de
                </div>
            </div>
            
            <!-- RAPPORT NR -->
            <div class="rapport-nr-section">
                <div>
                    <div style="font-size: 11px; margin-bottom: 5px;">Projektnummer: <input type="text" id="projektnummer" placeholder="P-2024-001" style="border:none; border-bottom: 1px solid #000; background: transparent; width: 130px; font-size: 11px;"></div>
                    <div style="font-size: 11px;">Baustelle: <input type="text" id="baustelle" placeholder="z.B. Aldi Sindelfingen" style="border:none; border-bottom: 1px solid #000; background: transparent; width: 200px; font-size: 11px;"></div>
                    <input type="date" id="datum" style="display: none;">
                </div>
                <div class="rapport-nr-box">
                    RAPPORT Nr. <span id="rapportNummer">00001</span>
                </div>
                <div class="rapport-worker-box" style="display: flex; gap: 8px; align-items: flex-end;">
                    <div style="text-align: center;">
                        <div style="font-size: 9px; line-height: 1.2;">Vor-<br>arbeiter</div>
                        <div style="width: 18px; height: 18px; border: 2px solid #000; background: white; margin: 3px auto 0;"></div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 9px; line-height: 1.2;">Fach-<br>arbeiter</div>
                        <div style="width: 18px; height: 18px; border: 2px solid #000; background: white; margin: 3px auto 0;"></div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 9px; line-height: 1.2;">Lehrling<br>Helfer</div>
                        <div style="width: 18px; height: 18px; border: 2px solid #000; background: white; margin: 3px auto 0;"></div>
                    </div>
                </div>
            </div>
            
            <!-- HAUPTTABELLE -->
            <table class="rapport-table">
                <thead>
                    <tr>
                        <th class="pos-col">Pos.</th>
                        <th class="datum-col">Datum</th>
                        <th class="taetig-col">T√§tigkeit</th>
                        <th style="width: 60px;">Menge</th>
                        <th style="width: 80px;">Einheit</th>
                    </tr>
                </thead>
                <tbody id="taetigkeitenTable">
                    <!-- Zeilen werden dynamisch hinzugef√ºgt -->
                </tbody>
            </table>
            
            <!-- MATERIAL SECTION -->
            <div class="rapport-section">
                <div class="rapport-section-title" style="display: flex; justify-content: space-between; align-items: center;">
                    <span>Material:</span>
                    <button type="button" class="btn btn-secondary" onclick="startVoiceInput('materialText')" style="padding: 5px 10px; font-size: 12px;">üé§ Spracheingabe</button>
                </div>
                <textarea id="materialText" placeholder="Material hier eingeben oder oben ausw√§hlen..."></textarea>
            </div>
            
            <!-- PERSONAL SECTION -->
            <div class="rapport-section">
                <div class="rapport-section-title">Personal:</div>
                <div id="personalFormText" style="background: white; padding: 8px; min-height: 60px; font-size: 11px; border: none;"></div>
            </div>
            
            <!-- MASCHINEN SECTION -->
            <div class="rapport-section">
                <div class="rapport-section-title" style="display: flex; justify-content: space-between; align-items: center;">
                    <span>Maschinen:</span>
                    <button type="button" class="btn btn-secondary" onclick="startVoiceInput('maschinenText')" style="padding: 5px 10px; font-size: 12px;">üé§ Spracheingabe</button>
                </div>
                <textarea id="maschinenText" placeholder="Maschinen hier eingeben oder oben ausw√§hlen..."></textarea>
            </div>
            
            <!-- FOTOS IM FORMULAR -->
            <div id="photoSection" class="rapport-section hidden">
                <div class="rapport-section-title">Fotos:</div>
                <div id="formPhotoGrid" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px;"></div>
            </div>
            
            <!-- UNTERSCHRIFTEN -->
            <div class="rapport-signatures">
                <div class="signature-box">
                    <canvas id="signaturePad1" class="signature-pad"></canvas>
                    <button type="button" class="btn btn-secondary" onclick="clearSignature('signaturePad1')" style="width: 100%; margin-bottom: 10px;">üóëÔ∏è L√∂schen</button>
                    <div class="signature-label">
                        <span id="datumDisplay1">_____________</span>
                        <strong>Datum</strong>
                        <strong style="margin-top: 10px;">Fliesen Unger S√ºd GmbH</strong>
                    </div>
                </div>
                
                <div class="signature-box">
                    <canvas id="signaturePad2" class="signature-pad"></canvas>
                    <button type="button" class="btn btn-secondary" onclick="clearSignature('signaturePad2')" style="width: 100%; margin-bottom: 10px;">üóëÔ∏è L√∂schen</button>
                    <div class="signature-label">
                        <span id="datumDisplay2">_____________</span>
                        <strong>Datum</strong>
                        <strong style="margin-top: 10px;">Auftraggeber</strong>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ACTIONS -->
        <div class="actions-bar" style="max-width: 900px; margin: 0 auto;">
            <button type="button" class="btn btn-success" onclick="saveBericht()">üíæ Bericht speichern</button>
            <button type="button" class="btn btn-primary" onclick="downloadBerichtAsJSON()" style="margin-left: 10px;">üì• Als JSON herunterladen</button>
            <div style="margin-top: 10px;">
                <button type="button" class="btn btn-secondary" onclick="downloadAllBerichteAsBackup()">üíæ Alle Berichte sichern</button>
                <label for="importBackup" class="btn btn-secondary" style="margin-left: 10px; cursor: pointer;">üíæ Backup importieren
                    <input type="file" id="importBackup" accept=".json" onchange="importBerichteBackup(event)" style="display: none;">
                </label>
            </div>
            <div id="autoSaveIndicator" style="margin-top: 10px; font-size: 12px; color: #64748b; opacity: 0.5;">
                üíæ Auto-Save aktiv (alle 30 Sek.)
            </div>
            <button type="button" class="btn btn-primary" onclick="generatePDF()">üìÑ Als PDF herunterladen</button>
            <button type="button" class="btn btn-success" onclick="shareViaWhatsApp()" style="background: #25D366;">üì± Via WhatsApp teilen</button>
            <button type="button" class="btn btn-secondary" onclick="resetForm()">üîÑ Formular zur√ºcksetzen</button>
        </div>
    </div>
    
    <!-- TAB: LISTE -->
    <div class="tab-content" id="tab-liste">
        <div style="max-width: 900px; margin: 0 auto; background: white; padding: 15px; border-radius: 0 0 12px 12px;">
            <!-- Suchleiste -->
            <div style="margin-bottom: 15px;">
                <input type="text" id="searchBerichte" placeholder="üîç Berichte durchsuchen..." 
                    oninput="filterBerichte(this.value)"
                    style="width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 16px;">
            </div>
            <div class="berichte-liste" id="berichteListe"></div>
        </div>
    </div>
    
    <!-- TAB: PROJEKTE -->
    <div class="tab-content" id="tab-projekte">
        <div style="max-width: 900px; margin: 0 auto; background: white; padding: 20px; border-radius: 0 0 12px 12px;">
            <h2 style="color: #dc2626; margin-bottom: 20px;">üìÅ Meine Projekte/Baustellen</h2>
            
            <!-- Neues Projekt erstellen -->
            <div style="background: #f8fafc; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                <h4 style="margin-bottom: 10px;">‚ûï Neues Projekt anlegen</h4>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <input type="text" id="newProjektName" placeholder="Projektname (z.B. Aldi Sindelfingen)" 
                        style="flex: 2; min-width: 200px; padding: 10px; border: 2px solid #e2e8f0; border-radius: 8px;">
                    <input type="text" id="newProjektNr" placeholder="Projekt-Nr." 
                        style="flex: 1; min-width: 100px; padding: 10px; border: 2px solid #e2e8f0; border-radius: 8px;">
                    <button onclick="addProjekt()" 
                        style="padding: 10px 20px; background: #22c55e; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;">
                        ‚úÖ Anlegen
                    </button>
                </div>
            </div>
            
            <!-- Projektliste -->
            <div id="projektListe"></div>
        </div>
    </div>
    
    <!-- TAB: STATISTIKEN -->
    <div class="tab-content" id="tab-statistiken">
        <div style="max-width: 900px; margin: 0 auto; background: white; padding: 20px; border-radius: 0 0 12px 12px;">
            <h2 style="color: #dc2626; margin-bottom: 20px;">üìä Statistiken & Auswertung</h2>
            
            <!-- Zeitraum-Auswahl -->
            <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
                <button onclick="loadStats('woche')" class="stats-btn" id="stats-woche">Diese Woche</button>
                <button onclick="loadStats('monat')" class="stats-btn active" id="stats-monat">Dieser Monat</button>
                <button onclick="loadStats('jahr')" class="stats-btn" id="stats-jahr">Dieses Jahr</button>
                <button onclick="loadStats('gesamt')" class="stats-btn" id="stats-gesamt">Gesamt</button>
            </div>
            
            <!-- Statistik-Karten -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 25px;">
                <div class="stat-card" style="background: linear-gradient(135deg, #667eea, #764ba2);">
                    <div class="stat-icon">‚è±Ô∏è</div>
                    <div class="stat-value" id="statStunden">0</div>
                    <div class="stat-label">Arbeitsstunden</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #f093fb, #f5576c);">
                    <div class="stat-icon">üìã</div>
                    <div class="stat-value" id="statBerichte">0</div>
                    <div class="stat-label">Berichte</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #4facfe, #00f2fe);">
                    <div class="stat-icon">üèóÔ∏è</div>
                    <div class="stat-value" id="statProjekte">0</div>
                    <div class="stat-label">Baustellen</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #43e97b, #38f9d7);">
                    <div class="stat-icon">üöó</div>
                    <div class="stat-value" id="statKm">0</div>
                    <div class="stat-label">Kilometer</div>
                </div>
            </div>
            
            <!-- Top Baustellen -->
            <div style="background: #f8fafc; padding: 15px; border-radius: 10px;">
                <h4 style="margin-bottom: 15px;">üèÜ Top Baustellen (nach Stunden)</h4>
                <div id="topBaustellen"></div>
            </div>
        </div>
    </div>
    
    <!-- TAB: KALENDER -->
    <div class="tab-content" id="tab-kalender">
        <div style="max-width: 900px; margin: 0 auto; background: white; padding: 20px; border-radius: 0 0 12px 12px;">
            <h2 style="color: #dc2626; margin-bottom: 20px;">üìÖ Kalender</h2>
            
            <!-- Monat-Navigation -->
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <button onclick="changeMonth(-1)" style="padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer;">‚óÄÔ∏è Zur√ºck</button>
                <h3 id="kalenderMonat" style="color: #334155;"></h3>
                <button onclick="changeMonth(1)" style="padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer;">Vor ‚ñ∂Ô∏è</button>
            </div>
            
            <!-- Kalender-Grid -->
            <div id="kalenderGrid" style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px;"></div>
            
            <!-- Legende -->
            <div style="margin-top: 20px; display: flex; gap: 20px; flex-wrap: wrap; font-size: 14px;">
                <span>üìã = Bericht vorhanden</span>
                <span style="color: #22c55e;">‚óè Heute</span>
            </div>
        </div>
    </div>
    
    <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
        // ===== GLOBAL VARIABLES =====
        let selectedTaetigkeiten = [];
        let selectedMaterial = [];
        let selectedWerkzeuge = [];
        let personalListe = [];
        let fahrzeugListe = [];
        let photos = [];
        let taetigkeitenRowCounter = 1;
        
        // ===== BROWSER CAPABILITIES (Feature Detection statt Platform Detection) =====
        // v2.0: Erweitert um Capacitor-Erkennung f√ºr Native-App
        class BrowserCapabilities {
            constructor() {
                // Capacitor-Erkennung (Native App vs. Browser)
                this.isNativeApp = typeof window.Capacitor !== 'undefined' && 
                                   window.Capacitor.isNativePlatform && 
                                   window.Capacitor.isNativePlatform();
                
                // Protokoll-Erkennung
                this.protocol = this.detectProtocol();
                
                this.features = {
                    geolocation: 'geolocation' in navigator,
                    getUserMedia: !!(navigator.mediaDevices?.getUserMedia),
                    speechRecognition: !!(window.SpeechRecognition || window.webkitSpeechRecognition),
                    webShare: 'share' in navigator && 'canShare' in navigator,
                    permissionsAPI: 'permissions' in navigator,
                    isSecureContext: window.isSecureContext,
                    // v2.0: Native App hat immer alle Berechtigungen verf√ºgbar
                    canUseGPS: this.isNativeApp || window.isSecureContext,
                    canUseMicrophone: this.isNativeApp || window.isSecureContext,
                    canUseCamera: this.isNativeApp || window.isSecureContext
                };
                
                // Log f√ºr Debugging (v2.0 - verbesserte Ausgabe)
                console.log('üìä BrowserCapabilities initialisiert:');
                console.log('   ‚Üí Native App:', this.isNativeApp ? 'JA' : 'NEIN');
                console.log('   ‚Üí Protokoll:', this.protocol.type, this.protocol.secure ? '(sicher)' : '(unsicher)');
                console.log('   ‚Üí GPS verf√ºgbar:', this.features.canUseGPS ? '‚úÖ' : '‚ùå');
                console.log('   ‚Üí Mikrofon verf√ºgbar:', this.features.canUseMicrophone ? '‚úÖ' : '‚ùå');
                console.log('   ‚Üí Secure Context:', this.features.isSecureContext ? '‚úÖ' : '‚ùå');
            }
            
            // v2.0: Protokoll-Erkennung mit spezifischen Meldungen
            detectProtocol() {
                const href = window.location.href;
                const protocol = window.location.protocol;
                
                // Native App (Capacitor)
                if (this.isNativeApp) {
                    return {
                        type: 'capacitor',
                        secure: true,
                        name: 'Native App',
                        icon: 'üì±',
                        message: '‚úÖ Native App - Alle Funktionen verf√ºgbar!',
                        solution: null
                    };
                }
                
                // Content:// (Android Datei-Manager)
                if (href.startsWith('content://')) {
                    return {
                        type: 'content',
                        secure: false,
                        name: 'Android Content Provider',
                        icon: 'üì±',
                        message: 'Du √∂ffnest die Datei √ºber den Android Datei-Manager. GPS & Mikrofon sind BLOCKIERT!',
                        solution: '‚Üí L√∂sung: App als APK installieren (siehe CAPACITOR_SETUP.md)'
                    };
                }
                
                // File:// (lokale Datei)
                if (protocol === 'file:') {
                    return {
                        type: 'file',
                        secure: false,
                        name: 'Lokale Datei',
                        icon: 'üìÅ',
                        message: 'Du √∂ffnest die Datei lokal. Auf Android sind GPS & Mikrofon BLOCKIERT!',
                        solution: '‚Üí L√∂sung: App als APK installieren oder √ºber HTTPS √∂ffnen'
                    };
                }
                
                // HTTP (unsicher)
                if (protocol === 'http:') {
                    return {
                        type: 'http',
                        secure: false,
                        name: 'HTTP (unsicher)',
                        icon: '‚ö†Ô∏è',
                        message: 'HTTP ist nicht sicher. GPS & Mikrofon sind BLOCKIERT!',
                        solution: '‚Üí L√∂sung: Nutze HTTPS statt HTTP'
                    };
                }
                
                // HTTPS (sicher)
                if (protocol === 'https:') {
                    return {
                        type: 'https',
                        secure: true,
                        name: 'HTTPS (sicher)',
                        icon: 'üîí',
                        message: '‚úÖ HTTPS - Alle Browser-Funktionen verf√ºgbar!',
                        solution: null
                    };
                }
                
                // Localhost (Entwicklung)
                if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
                    return {
                        type: 'localhost',
                        secure: true,
                        name: 'Localhost',
                        icon: 'üíª',
                        message: '‚úÖ Localhost - Entwicklungsmodus aktiv',
                        solution: null
                    };
                }
                
                return {
                    type: 'unknown',
                    secure: false,
                    name: 'Unbekannt',
                    icon: '‚ùì',
                    message: 'Unbekanntes Protokoll',
                    solution: '‚Üí Bitte √ºber HTTPS √∂ffnen oder als APK installieren'
                };
            }
            
            async canShareFiles() {
                if (!this.features.webShare) return false;
                try {
                    const testFile = new File(['test'], 'test.pdf', { type: 'application/pdf' });
                    return navigator.canShare({ files: [testFile] });
                } catch {
                    return false;
                }
            }
            
            // v2.0: Status-Zusammenfassung f√ºr UI
            getStatusSummary() {
                if (this.isNativeApp) {
                    return {
                        status: 'optimal',
                        badge: 'üì± Native App',
                        color: '#10b981',
                        gps: '‚úÖ Verf√ºgbar',
                        speech: '‚úÖ Verf√ºgbar',
                        camera: '‚úÖ Verf√ºgbar'
                    };
                }
                
                if (this.protocol.secure) {
                    return {
                        status: 'good',
                        badge: this.protocol.icon + ' ' + this.protocol.name,
                        color: '#10b981',
                        gps: '‚úÖ Verf√ºgbar',
                        speech: '‚úÖ Verf√ºgbar',
                        camera: '‚úÖ Verf√ºgbar'
                    };
                }
                
                return {
                    status: 'limited',
                    badge: this.protocol.icon + ' ' + this.protocol.name,
                    color: '#f59e0b',
                    gps: '‚ö†Ô∏è Blockiert',
                    speech: '‚ö†Ô∏è Blockiert',
                    camera: '‚ö†Ô∏è Eingeschr√§nkt'
                };
            }
        }
        
        // Globale Instanz
        const browserCaps = new BrowserCapabilities();
        
        // ===== DATA =====
        const taetigkeitenData = {
            'vorbereitung': [
                'Untergrund pr√ºfen',
                'Untergrund reinigen',
                'Untergrund grundieren',
                'Untergrund spachteln',
                'Untergrund schleifen',
                'Estrich vorbereiten',
                'Alte Fliesen entfernen',
                'Putz entfernen',
                'Boden nivellieren',
                'Entkopplungsmatte verlegen'
            ],
            'verlegung': [
                'Fliesen zuschneiden',
                'Fliesen verlegen Wand',
                'Fliesen verlegen Boden',
                'Mosaikfliesen verlegen',
                'Gro√üformat verlegen',
                'Kleber auftragen',
                'Ausrichten mit Laser',
                'Fugenkreuze setzen',
                'Sockelfliesen setzen',
                'Dehnungsfugen einbauen'
            ],
            'verfugung': [
                'Fugenm√∂rtel anr√ºhren',
                'Fugen verf√ºllen',
                'Fugen abziehen',
                'Fugen gl√§tten',
                'Silikonfugen ziehen',
                'Fugenbreite pr√ºfen',
                '√úberschuss entfernen',
                'Fugen versiegeln',
                'Eckfugen bearbeiten',
                'Dehnfugen verf√ºllen'
            ],
            'sanierung': [
                'Schadensstelle freilegen',
                'Besch√§digte Fliesen ersetzen',
                'Risse sanieren',
                'Undichte Stellen abdichten',
                'Fugen erneuern',
                'Schimmel entfernen',
                'Feuchtigkeit beseitigen',
                'Untergrund reparieren',
                'Abdichtung erneuern',
                'Bestandsaufnahme durchf√ºhren'
            ],
            'spezial': [
                'Mosaik-Layout erstellen',
                'Naturstein verlegen',
                'Terrassenplatten verlegen',
                'Treppenstufen fliesen',
                'Nische auskleiden',
                'Bodenablauf einbauen',
                'Wandnische einbauen',
                'Sonderanfertigung einpassen',
                'Schwellenbereich bearbeiten',
                'Barrierefreier Zugang'
            ],
            'abschluss': [
                'Baustelle reinigen',
                'Schutzfolie anbringen',
                'Endkontrolle durchf√ºhren',
                '√úbergabe vorbereiten',
                'Dokumentation erstellen',
                'Material entsorgen',
                'Werkzeug reinigen',
                'Restmaterial verpacken',
                'M√§ngelliste erstellen',
                'Abnahmeprotokoll'
            ]
        };
        
        const materialData = {
            'fliesen': [
                'Wandfliesen 30x60cm',
                'Bodenfliesen 60x60cm',
                'Bodenfliesen 80x80cm',
                'Mosaikfliesen',
                'Gro√üformat 120x120cm',
                'Feinsteinzeug',
                'Natursteinfliesen',
                'Sockelfliesen',
                'Bord√ºren',
                'Dekorplatten'
            ],
            'kleber': [
                'Flexkleber',
                'Standardkleber',
                'D√ºnnbettm√∂rtel',
                'Natursteinm√∂rtel',
                'Schnellkleber',
                'Fliesenkleber au√üen',
                'Dispersionkleber',
                'Haftgrund',
                'Grundierung',
                'Ausgleichsmasse'
            ],
            'fugen': [
                'Fugenm√∂rtel grau',
                'Fugenm√∂rtel wei√ü',
                'Fugenm√∂rtel schwarz',
                'Flexfuge',
                'Epoxidharzfuge',
                'Silikon transparent',
                'Silikon sanit√§r',
                'Acrylfuge',
                'Dehnfugenmasse',
                'Fugenreiniger'
            ],
            'abdichtung': [
                'Dichtschl√§mme',
                'Fl√ºssigfolie',
                'Dichtband',
                'Abdichtungsbahn',
                'Wannenrandband',
                'Echdichtband',
                'Manschette',
                'Dichtfolie',
                'Grundierung',
                'Sperrgrund'
            ],
            'profile': [
                'Eckprofil Alu',
                'Abschlussprofil',
                '√úbergangsschiene',
                'Dehnfugenprofil',
                'Fliesenschiene',
                'Kantenschutz',
                'Trepenprofil',
                'Sockelprofil',
                'LED-Profil',
                'Quadratprofil'
            ],
            'sonstiges': [
                'Fliesenkreuze 3mm',
                'Fliesenkeile',
                'Nivelliersystem',
                'Fugenkratzer',
                'Reinigungsmittel',
                'Schwamm',
                'Eimer',
                'R√ºhrstab',
                'Zahnspachtel',
                'Gl√§ttekelle'
            ]
        };
        
        const werkzeugeData = {
            'schneiden': [
                'Fliesenschneider',
                'Nassschneider',
                'Winkelschleifer',
                'Bohrkrone',
                'Lochs√§ge',
                'Glasschneider',
                'Diamantscheibe',
                'Zange',
                'Schneidzange',
                'Fliesenbrechzange'
            ],
            'kleber': [
                'Zahnkelle 6mm',
                'Zahnkelle 8mm',
                'Zahnkelle 10mm',
                'Gl√§ttekelle',
                'Spachtel',
                'Kleberkamm',
                'R√ºhrquirl',
                'M√∂rteleimer',
                'Kelle',
                'Maurerkelle'
            ],
            'fugen': [
                'Fugenkratzer',
                'Fugengummi',
                'Fugenbrett',
                'Fugenschwamm',
                'Fuggl√§tter',
                'Silikonspritze',
                'Kartuschenpistole',
                'Fugengl√§tter',
                'Abzieher',
                'Fugenschaber'
            ],
            'maschinen': [
                'R√ºttelplatte',
                'Schleifmaschine',
                'Stemmhammer',
                'Bohrmaschine',
                'Akkuschrauber',
                'R√ºhrger√§t',
                'Absaugger√§t',
                'Staubsauger',
                'Flex',
                'Trennschleifer'
            ],
            'messen': [
                'Wasserwaage',
                'Laser',
                'Richtschnur',
                'Zollstock',
                'Winkelmesser',
                'Lot',
                'Schlagschnur',
                'Digitalmessger√§t',
                'Neigungsmesser',
                'Schieblehre'
            ],
            'handwerkzeug': [
                'Hammer',
                'Gummihammer',
                'Mei√üel',
                'Cutter',
                'Zange',
                'Schraubendreher',
                'Eimer',
                'Schwamm',
                'Besen',
                'Schaufel'
            ]
        };
        
        // ===== INITIALIZATION =====
        document.addEventListener('DOMContentLoaded', function() {
            // v1.14/v1.15: HTTPS WARNING BANNER & DEBUG INFO
            if (!window.isSecureContext) {
                // Zeige Warning Banner
                const banner = document.getElementById('httpsWarningBanner');
                if (banner) {
                    banner.style.display = 'flex';
                    document.getElementById('currentProtocol').textContent = window.location.protocol + '//' + window.location.hostname;
                }
                
                // Zeige Debug Info Box
                const debugBox = document.getElementById('debugInfoBox');
                if (debugBox) {
                    debugBox.style.display = 'block';
                    document.getElementById('debugProtocol').textContent = window.location.protocol + (window.location.protocol === 'http:' ? ' ‚ùå' : ' ‚úÖ');
                    document.getElementById('debugSecure').textContent = window.isSecureContext ? '‚úÖ JA' : '‚ùå NEIN';
                    document.getElementById('debugGPS').textContent = 'geolocation' in navigator ? '‚úÖ' : '‚ùå';
                    document.getElementById('debugSpeech').textContent = ('SpeechRecognition' in window || 'webkitSpeechRecognition' in window) ? '‚úÖ' : '‚ùå';
                    document.getElementById('debugBarcode').textContent = 'BarcodeDetector' in window ? '‚úÖ' : '‚ö†Ô∏è Fallback';
                }
                
                console.log('üõ†Ô∏è v1.14 Debug-Tools aktiviert:');
                console.log('   - HTTPS Warning Banner: ‚úÖ');
                console.log('   - Debug Info Box: ‚úÖ');
                console.log('   - Eruda Console: ‚úÖ (siehe Icon unten rechts)');
            }
            
            setupSignaturePads();
            // ANDROID FIX: GPS nur auf Button-Click, nicht automatisch!
            // getGPS(); // ENTFERNT - User muss Button klicken
            updateRapportNummer();
            
            const today = new Date();
            document.getElementById('datum').valueAsDate = today;
            
            // Update datum displays
            const dateStr = today.toLocaleDateString('de-DE');
            document.getElementById('datumDisplay1').textContent = dateStr;
            document.getElementById('datumDisplay2').textContent = dateStr;
            document.getElementById('datumDisplay2').textContent = dateStr;
            
            // Listen to datum changes
            document.getElementById('datum').addEventListener('change', function() {
                const date = new Date(this.value);
                const dateStr = date.toLocaleDateString('de-DE');
                document.getElementById('datumDisplay1').textContent = dateStr;
                document.getElementById('datumDisplay2').textContent = dateStr;
            });
            
            // Initialize Auto-Save
            restoreAutoSave();
            enableAutoSave();
            
        });
        
        // ===== TAB SWITCHING =====
        function switchToTab(tabName) {
            const tabs = document.querySelectorAll('.tab');
            const contents = document.querySelectorAll('.tab-content');
            
            tabs.forEach(tab => tab.classList.remove('active'));
            contents.forEach(content => content.classList.remove('active'));
            
            document.querySelector(`[onclick="switchToTab('${tabName}')"]`).classList.add('active');
            document.getElementById(`tab-${tabName}`).classList.add('active');
            
            if (tabName === 'liste') {
                loadBerichte();
            }
        }
        
        // ===== v1.15: IP-GEOLOCATION FALLBACK =====
        async function getIPLocation() {
            console.log('üîÑ GPS failed, trying IP-Geolocation fallback...');
            try {
                const response = await fetch('https://ipapi.co/json/');
                if (!response.ok) {
                    throw new Error('IP-Geolocation API Error');
                }
                const data = await response.json();
                
                console.log('‚úÖ IP-Geolocation erfolg reich:', {
                    city: data.city,
                    country: data.country_name,
                    lat: data.latitude,
                    lon: data.longitude
                });
                
                return {
                    source: 'ip',
                    lat: data.latitude,
                    lon: data.longitude,
                    accuracy: 20000, // ~20km Genauigkeit
                    city: data.city,
                    country: data.country_name
                };
            } catch (error) {
                console.error('‚ùå IP-Geolocation fehlgeschlagen:', error);
                return null;
            }
        }
        
        // ===== v1.15: GPS SOURCE INDICATOR =====
        function updateGPSSourceBadge(source, accuracy) {
            const statusEl = document.getElementById('gpsStatus');
            let badgeHTML = '';
            
            if (source === 'gps') {
                badgeHTML = `<span class="gps-source-badge source-gps"><span class="badge-icon">üìç</span> GPS High-Accuracy (¬±${Math.round(accuracy)}m)</span>`;
            } else if (source === 'ip') {
                badgeHTML = `<span class="gps-source-badge source-ip"><span class="badge-icon">üìç</span> IP-Standort (~20km Genauigkeit)</span>`;
            }
            
            // Append badge to status
            if (badgeHTML) {
                const currentHTML = statusEl.innerHTML.split('<span class="gps-source-badge')[0]; // Remove old badge
                statusEl.innerHTML = currentHTML + badgeHTML;
            }
        }
        
        // ===== GPS HIGH-ACCURACY (¬±5m) MIT MULTI-MESSUNG + v1.15 IP-FALLBACK =====
        async function getGPS() {
            const statusEl = document.getElementById('gpsStatus');
            statusEl.className = 'gps-status gps-loading';
            statusEl.innerHTML = 'üîÑ GPS wird erfasst (High-Accuracy)...';
            
            // Feature Detection
            if (!browserCaps.features.geolocation) {
                statusEl.className = 'gps-status gps-error';
                statusEl.innerHTML = '‚ùå GPS nicht verf√ºgbar in diesem Browser';
                showToast('Bitte GPS-Koordinaten manuell eingeben', 'info');
                return;
            }
            
            const measurements = [];
            const targetAccuracy = 20; // Target ¬±20m or better
            const maxMeasurements = 3;
            const timeout = 20000; // 20 seconds per measurement
            
            // Funktion f√ºr einzelne GPS-Messung
            const getSinglePosition = () => {
                return new Promise((resolve, reject) => {
                    navigator.geolocation.getCurrentPosition(
                        resolve,
                        reject,
                        {
                            enableHighAccuracy: true,
                            timeout: timeout,
                            maximumAge: 0
                        }
                    );
                });
            };
            
            try {
                // Sammle 3 Messungen
                for (let i = 0; i < maxMeasurements; i++) {
                    statusEl.innerHTML = `üîÑ GPS-Messung ${i + 1}/${maxMeasurements}...`;
                    
                    const position = await getSinglePosition();
                    const accuracy = position.coords.accuracy;
                    
                    measurements.push({
                        lat: position.coords.latitude,
                        lon: position.coords.longitude,
                        accuracy: accuracy
                    });
                    
                    statusEl.innerHTML = `üîÑ Messung ${i + 1}: ¬±${Math.round(accuracy)}m Genauigkeit`;
                    
                    // Stop early if we have excellent accuracy
                    if (accuracy <= targetAccuracy && i >= 1) {
                        break;
                    }
                    
                    // Short delay between measurements
                    if (i < maxMeasurements - 1) {
                        await new Promise(resolve => setTimeout(resolve, 1000));
                    }
                }
                
                // Calculate weighted average (better accuracy = higher weight)
                let totalWeight = 0;
                let weightedLat = 0;
                let weightedLon = 0;
                
                measurements.forEach(m => {
                    // Weight is inverse of accuracy (better accuracy = more weight)
                    const weight = 1 / m.accuracy;
                    totalWeight += weight;
                    weightedLat += m.lat * weight;
                    weightedLon += m.lon * weight;
                });
                
                const finalLat = (weightedLat / totalWeight).toFixed(6);
                const finalLon = (weightedLon / totalWeight).toFixed(6);
                const avgAccuracy = Math.round(
                    measurements.reduce((sum, m) => sum + m.accuracy, 0) / measurements.length
                );
                
                // Set values
                document.getElementById('gpsLat').value = finalLat;
                document.getElementById('gpsLon').value = finalLon;
                
                // Show success with accuracy
                statusEl.className = 'gps-status gps-success';
                statusEl.innerHTML = `‚úÖ GPS erfasst: ${finalLat}, ${finalLon} (¬±${avgAccuracy}m, ${measurements.length} Messungen)`;
                
                showToast(`GPS erfolgreich erfasst mit ¬±${avgAccuracy}m Genauigkeit`, 'success');
                
                // v1.15: Update GPS Source Badge
                updateGPSSourceBadge('gps', avgAccuracy);
                
            } catch (error) {
                // v1.15: Progressive GPS with IP-Fallback
                console.log('‚ùå GPS High-Accuracy fehlgeschlagen, versuche IP-Fallback...');
                console.error('GPS Error:', {
                    code: error.code,
                    message: error.message
                });
                
                statusEl.className = 'gps-status gps-loading';
                statusEl.innerHTML = 'üîÑ GPS nicht verf√ºgbar, verwende IP-Standort...';
                
                // Try IP-Geolocation Fallback
                const ipLocation = await getIPLocation();
                
                if (ipLocation) {
                    // Success: Use IP location
                    const finalLat = ipLocation.lat.toFixed(6);
                    const finalLon = ipLocation.lon.toFixed(6);
                    
                    document.getElementById('gpsLat').value = finalLat;
                    document.getElementById('gpsLon').value = finalLon;
                    
                    statusEl.className = 'gps-status gps-success';
                    statusEl.innerHTML = `‚úÖ Standort erfasst: ${finalLat}, ${finalLon} (via IP-Standort)`;
                    
                    if (ipLocation.city) {
                        statusEl.innerHTML += `<br><small>üìç ${ipLocation.city}, ${ipLocation.country}</small>`;
                    }
                    
                    showToast(`IP-Standort erfasst: ${ipLocation.city || 'Unbekannt'} (~20km Genauigkeit)`, 'success');
                    
                    // v1.15: Update GPS Source Badge
                    updateGPSSourceBadge('ip', ipLocation.accuracy);
                    
                    // Update map
                    updateMapMarker();
                    
                    // Reverse Geocoding
                    reverseGeocode(finalLat, finalLon);
                } else {
                    // Fallback also failed
                    statusEl.className = 'gps-status gps-error';
                    
                    let errorMsg = '';
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            errorMsg = 'GPS-Zugriff verweigert';
                            break;
                        case error.POSITION_UNAVAILABLE:
                            errorMsg = 'GPS-Position nicht verf√ºgbar';
                            break;
                        case error.TIMEOUT:
                            errorMsg = 'GPS-Anfrage Timeout';
                            break;
                        default:
                            errorMsg = 'GPS-Fehler';
                    }
                    
                    statusEl.innerHTML = `‚ùå ${errorMsg} & IP-Fallback fehlgeschlagen`;
                    showToast(errorMsg + ' - Bitte Koordinaten manuell eingeben', 'error');
                }
            }
        }
        
        // ===== PROJEKT INFO √úBERNEHMEN =====
        function copyProjektInfo() {
            const projektnummerHelper = document.getElementById('projektnummerHelper').value;
            const baustelleHelper = document.getElementById('baustelleHelper').value;
            
            document.getElementById('projektnummer').value = projektnummerHelper;
            document.getElementById('baustelle').value = baustelleHelper;
            
            showToast('Projekt-Informationen √ºbernommen', 'success');
        }
        
        // ===== v1.15: QR-CODE SCANNER =====
        let qrStream = null;
        let qrScanInterval = null;
        
        async function startQRScanner() {
            const overlay = document.getElementById('qrScannerOverlay');
            const video = document.getElementById('qrVideo');
            const canvas = document.getElementById('qrCanvas');
            const status = document.getElementById('scannerStatus');
            
            overlay.style.display = 'flex';
            status.textContent = 'üì∑ Kamera wird ge√∂ffnet...';
            
            try {
                // Request camera access
                qrStream = await navigator.mediaDevices.getUserMedia({
                    video: { facingMode: 'environment' } // Rear camera
                });
                
                video.srcObject = qrStream;
                await video.play();
                
                status.textContent = 'üì∑ Suche nach QR-Code...';
                
                // Set canvas size to match video
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                
                // Start scanning
                qrScanInterval = setInterval(() => {
                    scanQRCode(video, canvas, status);
                }, 300);
                
            } catch (error) {
                console.error('‚ùå QR-Scanner Error:', error);
                status.textContent = '‚ùå Kamera-Zugriff verweigert';
                showToast('Kamera-Zugriff ben√∂tigt f√ºr QR-Scanner', 'error');
                setTimeout(() => stopQRScanner(), 2000);
            }
        }
        
        function scanQRCode(video, canvas, status) {
            const ctx = canvas.getContext('2d');
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            
            // Try BarcodeDetector API first
            if ('BarcodeDetector' in window) {
                const barcodeDetector = new BarcodeDetector({ formats: ['qr_code'] });
                barcodeDetector.detect(imageData)
                    .then(barcodes => {
                        if (barcodes.length > 0) {
                            processQRCode(barcodes[0].rawValue, status);
                        }
                    })
                    .catch(err => console.error('BarcodeDetector error:', err));
            } else if (typeof jsQR !== 'undefined') {
                // Fallback to jsQR
                const code = jsQR(imageData.data, imageData.width, imageData.height);
                if (code) {
                    processQRCode(code.data, status);
                }
            }
        }
        
        function processQRCode(data, status) {
            console.log('‚úÖ QR-Code detected:', data);
            
            // Expected format: "lat,lon" or "lat, lon"
            const coords = data.trim().split(',').map(s => s.trim());
            
            if (coords.length === 2) {
                const lat = parseFloat(coords[0]);
                const lon = parseFloat(coords[1]);
                
                if (!isNaN(lat) && !isNaN(lon) && lat >= -90 && lat <= 90 && lon >= -180 && lon <= 180) {
                    // Valid coordinates
                    document.getElementById('gpsLat').value = lat.toFixed(6);
                    document.getElementById('gpsLon').value = lon.toFixed(6);
                    
                    const gpsStatus = document.getElementById('gpsStatus');
                    gpsStatus.className = 'gps-status gps-success';
                    gpsStatus.innerHTML = `‚úÖ QR-Code gescannt: ${lat.toFixed(6)}, ${lon.toFixed(6)}`;
                    
                    updateGPSSourceBadge('gps', 0); // QR is exact, 0m accuracy
                    updateMapMarker();
                    reverseGeocode(lat, lon);
                    
                    status.textContent = '‚úÖ QR-Code erfolgreich gescannt!';
                    showToast('QR-Code erfolgreich gescannt!', 'success');
                    
                    setTimeout(() => stopQRScanner(), 1000);
                } else {
                    status.textContent = '‚ùå Ung√ºltige Koordinaten im QR-Code';
                    showToast('QR-Code enth√§lt ung√ºltige Koordinaten', 'error');
                }
            } else {
                status.textContent = '‚ö†Ô∏è QR-Code Format nicht erkannt';
                showToast('QR-Code Format: "lat,lon" erwartet', 'info');
            }
        }
        
        function stopQRScanner() {
            const overlay = document.getElementById('qrScannerOverlay');
            overlay.style.display = 'none';
            
            if (qrScanInterval) {
                clearInterval(qrScanInterval);
                qrScanInterval = null;
            }
            
            if (qrStream) {
                qrStream.getTracks().forEach(track => track.stop());
                qrStream = null;
            }
        }
        
        // ===== v1.15: MEDIARECORDER AUDIO AUFNAHME =====
        let mediaRecorder = null;
        let audioChunks = [];
        let recordingStartTime = null;
        let recordingTimer = null;
        
        async function toggleAudioRecording() {
            if (mediaRecorder && mediaRecorder.state === 'recording') {
                // Stop recording
                stopAudioRecording();
            } else {
                // Start recording
                await startAudioRecording();
            }
        }
        
        async function startAudioRecording() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                
                // Create MediaRecorder
                const options = { mimeType: 'audio/webm;codecs=opus' };
                mediaRecorder = new MediaRecorder(stream, options);
                audioChunks = [];
                
                mediaRecorder.ondataavailable = (event) => {
                    if (event.data.size > 0) {
                        audioChunks.push(event.data);
                    }
                };
                
                mediaRecorder.onstop = () => {
                    const audioBlob = new Blob(audioChunks, { type: 'audio/webm;codecs=opus' });
                    downloadAudio(audioBlob);
                    
                    // Stop all tracks
                    stream.getTracks().forEach(track => track.stop());
                    
                    // Reset
                    audioChunks = [];
                    mediaRecorder = null;
                    
                    // Remove indicator
                    document.getElementById('audioRecordingIndicator').innerHTML = '';
                    
                    if (recordingTimer) {
                        clearInterval(recordingTimer);
                        recordingTimer = null;
                    }
                };
                
                // Start recording
                mediaRecorder.start();
                recordingStartTime = Date.now();
                
                // Show indicator
                updateRecordingIndicator();
                recordingTimer = setInterval(updateRecordingIndicator, 1000);
                
                showToast('üéôÔ∏è Audio-Aufnahme gestartet', 'success');
                
            } catch (error) {
                console.error('‚ùå MediaRecorder Error:', error);
                showToast('Mikrofon-Zugriff verweigert', 'error');
            }
        }
        
        function stopAudioRecording() {
            if (mediaRecorder && mediaRecorder.state === 'recording') {
                mediaRecorder.stop();
                showToast('‚úÖ Audio-Aufnahme gestoppt', 'success');
            }
        }
        
        function updateRecordingIndicator() {
            const elapsed = Math.floor((Date.now() - recordingStartTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            const timeStr = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            document.getElementById('audioRecordingIndicator').innerHTML = `
                <span class="audio-recording-indicator">
                    <span class="recording-dot"></span>
                    <span class="recording-time">${timeStr}</span>
                </span>
            `;
        }
        
        function downloadAudio(blob) {
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.style.display = 'none';
            a.href = url;
            a.download = `audio_${Date.now()}.webm`;
            document.body.appendChild(a);
            a.click();
            
            setTimeout(() => {
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }, 100);
            
            showToast('üì• Audio heruntergeladen', 'success');
        }
        
        // ===== v1.14/v1.15: HTTPS SETUP MODAL =====
        function showHTTPSSetupModal() {
            document.getElementById('httpsSetupModal').style.display = 'flex';
        }
        
        function closeHTTPSSetupModal() {
            document.getElementById('httpsSetupModal').style.display = 'none';
        }
        
        // ===== v1.14: DEBUG BOX =====
        function closeDebugBox() {
            document.getElementById('debugInfoBox').style.display = 'none';
        }
        
        // ===== DROPDOWNS =====
        function showTaetigkeiten() {
            const hauptkat = document.getElementById('taetigkeitHaupt').value;
            const container = document.getElementById('taetigkeitenChips');
            
            if (!hauptkat) {
                container.innerHTML = '';
                return;
            }
            
            container.innerHTML = '';
            
            taetigkeitenData[hauptkat].forEach(item => {
                const chip = document.createElement('div');
                chip.className = 'chip';
                if (selectedTaetigkeiten.includes(item)) {
                    chip.classList.add('selected');
                }
                chip.textContent = item;
                chip.onclick = function() {
                    toggleSelection(item, selectedTaetigkeiten, chip);
                };
                container.appendChild(chip);
            });
        }
        
        function showMaterial() {
            const hauptkat = document.getElementById('materialHaupt').value;
            const container = document.getElementById('materialChips');
            
            if (!hauptkat) {
                container.innerHTML = '';
                return;
            }
            
            container.innerHTML = '';
            
            materialData[hauptkat].forEach(item => {
                const chip = document.createElement('div');
                chip.className = 'chip';
                if (selectedMaterial.includes(item)) {
                    chip.classList.add('selected');
                }
                chip.textContent = item;
                chip.onclick = function() {
                    toggleSelection(item, selectedMaterial, chip);
                };
                container.appendChild(chip);
            });
        }
        
        function showWerkzeuge() {
            const hauptkat = document.getElementById('werkzeugeHaupt').value;
            const container = document.getElementById('werkzeugeChips');
            
            if (!hauptkat) {
                container.innerHTML = '';
                return;
            }
            
            container.innerHTML = '';
            
            werkzeugeData[hauptkat].forEach(item => {
                const chip = document.createElement('div');
                chip.className = 'chip';
                if (selectedWerkzeuge.includes(item)) {
                    chip.classList.add('selected');
                }
                chip.textContent = item;
                chip.onclick = function() {
                    toggleSelection(item, selectedWerkzeuge, chip);
                };
                container.appendChild(chip);
            });
        }
        
        function toggleSelection(item, array, chipElement) {
            const index = array.indexOf(item);
            if (index > -1) {
                array.splice(index, 1);
                chipElement.classList.remove('selected');
            } else {
                array.push(item);
                chipElement.classList.add('selected');
            }
        }
        
        // ===== ADD TO FORM =====
        function addSelectedToForm() {
            if (selectedTaetigkeiten.length === 0) {
                alert('‚ö†Ô∏è Bitte w√§hlen Sie mindestens eine T√§tigkeit aus!');
                return;
            }
            
            const tbody = document.getElementById('taetigkeitenTable');
            const datum = document.getElementById('datum').value;
            let position = document.getElementById('taetigkeitPosition').value.trim();
            const menge = document.getElementById('taetigkeitMenge').value.trim();
            const einheit = document.getElementById('taetigkeitEinheit').value;
            
            // Wenn keine Position eingegeben, automatisch hochz√§hlen
            if (!position) {
                position = taetigkeitenRowCounter.toString();
            }
            
            selectedTaetigkeiten.forEach(taetigkeit => {
                const row = document.createElement('tr');
                row.className = 'editable-row';
                row.innerHTML = `
                    <td contenteditable="true">${position}</td>
                    <td>${datum}</td>
                    <td contenteditable="true">${taetigkeit}</td>
                    <td contenteditable="true">${menge}</td>
                    <td contenteditable="true">${einheit}</td>
                `;
                tbody.appendChild(row);
                
                // Erh√∂he Counter nur wenn automatische Position verwendet wurde
                if (document.getElementById('taetigkeitPosition').value.trim() === '') {
                    taetigkeitenRowCounter++;
                }
            });
            
            // RESET nach Hinzuf√ºgen
            selectedTaetigkeiten = [];
            document.getElementById('taetigkeitenChips').innerHTML = '';
            document.getElementById('taetigkeitHaupt').value = '';
            document.getElementById('taetigkeitPosition').value = '';
            document.getElementById('taetigkeitMenge').value = '';
            document.getElementById('taetigkeitEinheit').value = '';
            
            showToast('T√§tigkeiten zur Tabelle hinzugef√ºgt', 'success');
        }
        
        function addMaterialToForm() {
            const textarea = document.getElementById('materialText');
            const helperText = document.getElementById('materialHelperText').value.trim();
            const menge = document.getElementById('materialMenge').value.trim();
            const einheit = document.getElementById('materialEinheit').value;
            const laufmeter = document.getElementById('materialLaufmeter').value.trim();
            
            // Sammle alle Eintr√§ge: Chips + Textarea
            let allItems = [];
            
            if (selectedMaterial.length > 0) {
                allItems = allItems.concat(selectedMaterial);
            }
            
            if (helperText) {
                allItems.push(helperText);
            }
            
            if (allItems.length === 0) {
                alert('‚ö†Ô∏è Bitte w√§hlen Sie Material aus oder geben Sie etwas ein!');
                return;
            }
            
            // F√ºge Menge/Einheit hinzu wenn vorhanden
            let prefix = '';
            if (menge && einheit) {
                prefix = `${menge} ${einheit} `;
            } else if (menge) {
                prefix = `${menge}x `;
            }
            
            // F√ºge Laufmeter als Suffix hinzu wenn vorhanden
            let suffix = '';
            if (laufmeter) {
                suffix = ` (${laufmeter} Laufmeter)`;
            }
            
            // F√ºge zum Formular hinzu
            const current = textarea.value.trim();
            const newItems = allItems.map(item => prefix + item + suffix).join('\n');
            
            if (current) {
                textarea.value = current + '\n' + newItems;
            } else {
                textarea.value = newItems;
            }
            
            // RESET nach √úbernehmen
            selectedMaterial = [];
            document.getElementById('materialChips').innerHTML = '';
            document.getElementById('materialHaupt').value = '';
            document.getElementById('materialHelperText').value = '';
            document.getElementById('materialMenge').value = '';
            document.getElementById('materialEinheit').value = '';
            document.getElementById('materialLaufmeter').value = '';
            
            showToast('Material √ºbernommen', 'success');
        }
        
        function addWerkzeugeToForm() {
            const textarea = document.getElementById('maschinenText');
            const helperText = document.getElementById('werkzeugeHelperText').value.trim();
            
            // Sammle alle Eintr√§ge: Chips + Textarea
            let allItems = [];
            
            if (selectedWerkzeuge.length > 0) {
                allItems = allItems.concat(selectedWerkzeuge);
            }
            
            if (helperText) {
                allItems.push(helperText);
            }
            
            if (allItems.length === 0) {
                alert('‚ö†Ô∏è Bitte w√§hlen Sie Werkzeuge aus oder geben Sie etwas ein!');
                return;
            }
            
            // F√ºge zum Formular hinzu
            const current = textarea.value.trim();
            const newItems = allItems.join('\n');
            
            if (current) {
                textarea.value = current + '\n' + newItems;
            } else {
                textarea.value = newItems;
            }
            
            // RESET nach √úbernehmen
            selectedWerkzeuge = [];
            document.getElementById('werkzeugeChips').innerHTML = '';
            document.getElementById('werkzeugeHaupt').value = '';
            document.getElementById('werkzeugeHelperText').value = '';
            
            showToast('Werkzeuge √ºbernommen', 'success');
        }
        
        // ===== PERSONAL =====
        function addPersonal() {
            const anzahl = parseInt(document.getElementById('personalAnzahl').value) || 1;
            const typ = document.getElementById('personalTyp').value;
            const stunden = parseFloat(document.getElementById('personalStunden').value) || 0;
            
            if (stunden === 0) {
                alert('‚ö†Ô∏è Bitte Stunden eingeben!');
                return;
            }
            
            personalListe.push({ anzahl, typ, stunden });
            updatePersonalListe();
            
            document.getElementById('personalAnzahl').value = '1';
            document.getElementById('personalStunden').value = '';
            showToast('Personal hinzugef√ºgt', 'success');
        }
        
        function updatePersonalListe() {
            const container = document.getElementById('personalListe');
            const formContainer = document.getElementById('personalFormText');
            
            if (personalListe.length === 0) {
                container.innerHTML = '';
                formContainer.innerHTML = '';
                return;
            }
            
            // Update Helper-Liste (oben)
            container.innerHTML = '<div style="margin-top: 10px; border: 2px solid #e2e8f0; border-radius: 6px; padding: 10px; background: #f8fafc;">';
            
            personalListe.forEach((person, index) => {
                const anzahlText = person.anzahl > 1 ? `${person.anzahl}x ` : '';
                container.innerHTML += `
                    <div style="display: flex; justify-content: space-between; padding: 6px; margin-bottom: 6px; background: white; border-radius: 4px;">
                        <span><strong>${anzahlText}${person.typ}</strong>: ${person.stunden}h</span>
                        <button class="btn btn-secondary" style="padding: 4px 10px; font-size: 12px; background: #ef4444;" onclick="removePersonal(${index})">üóëÔ∏è</button>
                    </div>
                `;
            });
            
            container.innerHTML += '</div>';
            
            // Update Formular (unten im gelben Rapport) - Format wie im Original mit Anzahl
            let formText = '';
            personalListe.forEach(person => {
                const anzahlText = person.anzahl > 1 ? `${person.anzahl}x ` : '';
                formText += `${anzahlText}${person.typ} √† ${person.stunden}h\n`;
            });
            formContainer.textContent = formText.trim();
        }
        
        function removePersonal(index) {
            personalListe.splice(index, 1);
            updatePersonalListe();
        }
        
        // ===== FAHRZEUGE =====
        function addFahrzeug() {
            const anzahl = parseInt(document.getElementById('fahrzeugAnzahl').value) || 1;
            const typ = document.getElementById('fahrzeugTyp').value;
            const kennzeichen = document.getElementById('fahrzeugKennzeichen').value.trim() || 'ohne Kennzeichen';
            const km = parseFloat(document.getElementById('fahrzeugKm').value) || 0;
            
            fahrzeugListe.push({ anzahl, typ, kennzeichen, km });
            updateFahrzeugListe();
            
            document.getElementById('fahrzeugAnzahl').value = '1';
            document.getElementById('fahrzeugKennzeichen').value = '';
            document.getElementById('fahrzeugKm').value = '';
            showToast('Fahrzeug hinzugef√ºgt', 'success');
        }
        
        function updateFahrzeugListe() {
            const container = document.getElementById('fahrzeugListe');
            if (fahrzeugListe.length === 0) {
                container.innerHTML = '';
                return;
            }
            
            container.innerHTML = '<div style="margin-top: 10px; border: 2px solid #e2e8f0; border-radius: 6px; padding: 10px; background: #f8fafc;">';
            
            fahrzeugListe.forEach((fz, index) => {
                const anzahlText = fz.anzahl > 1 ? `${fz.anzahl}x ` : '';
                container.innerHTML += `
                    <div style="display: flex; justify-content: space-between; padding: 6px; margin-bottom: 6px; background: white; border-radius: 4px;">
                        <span><strong>${anzahlText}${fz.typ}</strong>: ${fz.kennzeichen} - ${fz.km} km</span>
                        <button class="btn btn-secondary" style="padding: 4px 10px; font-size: 12px; background: #ef4444;" onclick="removeFahrzeug(${index})">üóëÔ∏è</button>
                    </div>
                `;
            });
            
            container.innerHTML += '</div>';
        }
        
        function removeFahrzeug(index) {
            fahrzeugListe.splice(index, 1);
            updateFahrzeugListe();
        }
        
        // ===== PHOTOS =====
        function handlePhotos(event) {
            const files = Array.from(event.target.files);
            
            files.forEach(file => {
                if (file.type.startsWith('image/')) {
                    compressImage(file, function(compressedDataUrl) {
                        photos.push(compressedDataUrl);
                        updatePhotoGrid();
                    });
                }
            });
            
            event.target.value = '';
        }
        
        function compressImage(file, callback) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    let width = img.width;
                    let height = img.height;
                    
                    const maxWidth = 1200;
                    const maxHeight = 900;
                    
                    if (width > maxWidth || height > maxHeight) {
                        if (width > height) {
                            height = height * (maxWidth / width);
                            width = maxWidth;
                        } else {
                            width = width * (maxHeight / height);
                            height = maxHeight;
                        }
                    }
                    
                    canvas.width = width;
                    canvas.height = height;
                    
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, width, height);
                    
                    const dataUrl = canvas.toDataURL('image/jpeg', 0.8);
                    callback(dataUrl);
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }
        
        function updatePhotoGrid() {
            const grid = document.getElementById('photoGrid');
            const formGrid = document.getElementById('formPhotoGrid');
            const section = document.getElementById('photoSection');
            
            if (photos.length === 0) {
                grid.innerHTML = '';
                formGrid.innerHTML = '';
                section.classList.add('hidden');
                return;
            }
            
            section.classList.remove('hidden');
            grid.innerHTML = '';
            formGrid.innerHTML = '';
            
            photos.forEach((photo, index) => {
                // Helper grid
                const item1 = document.createElement('div');
                item1.className = 'photo-item';
                item1.innerHTML = `
                    <img src="${photo}">
                    <button class="photo-delete" onclick="removePhoto(${index})">√ó</button>
                `;
                grid.appendChild(item1);
                
                // Form grid
                const item2 = document.createElement('img');
                item2.src = photo;
                item2.style.width = '100%';
                item2.style.height = '100px';
                item2.style.objectFit = 'cover';
                item2.style.border = '1px solid #000';
                formGrid.appendChild(item2);
            });
        }
        
        function removePhoto(index) {
            photos.splice(index, 1);
            updatePhotoGrid();
        }
        
        // ===== SIGNATURE =====
        function setupSignaturePads() {
            setupSinglePad('signaturePad1');
            setupSinglePad('signaturePad2');
        }
        
        function setupSinglePad(canvasId) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            
            canvas.width = canvas.offsetWidth;
            canvas.height = 120;
            
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 2;
            ctx.lineCap = 'round';
            
            let drawing = false;
            let lastX = 0;
            let lastY = 0;
            
            function startDraw(e) {
                drawing = true;
                const rect = canvas.getBoundingClientRect();
                lastX = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
                lastY = (e.touches ? e.touches[0].clientY : e.clientY) - rect.top;
            }
            
            function doDraw(e) {
                if (!drawing) return;
                e.preventDefault();
                
                const rect = canvas.getBoundingClientRect();
                const x = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
                const y = (e.touches ? e.touches[0].clientY : e.clientY) - rect.top;
                
                ctx.beginPath();
                ctx.moveTo(lastX, lastY);
                ctx.lineTo(x, y);
                ctx.stroke();
                
                lastX = x;
                lastY = y;
            }
            
            function stopDraw() {
                drawing = false;
            }
            
            canvas.addEventListener('mousedown', startDraw);
            canvas.addEventListener('mousemove', doDraw);
            canvas.addEventListener('mouseup', stopDraw);
            canvas.addEventListener('mouseout', stopDraw);
            
            canvas.addEventListener('touchstart', startDraw, { passive: false });
            canvas.addEventListener('touchmove', doDraw, { passive: false });
            canvas.addEventListener('touchend', stopDraw);
        }
        
        function clearSignature(canvasId) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            showToast('Unterschrift gel√∂scht', 'success');
        }
        
        // ===== RAPPORT NUMBER =====
        function updateRapportNummer() {
            const berichte = JSON.parse(localStorage.getItem('baustellenberichte') || '[]');
            const nextNr = (berichte.length + 1).toString().padStart(5, '0');
            document.getElementById('rapportNummer').textContent = nextNr;
        }
        
        // ===== SAVE =====
        function saveBericht() {
            const rapportNr = document.getElementById('rapportNummer').textContent;
            const datum = document.getElementById('datum').value;
            const projektnummer = document.getElementById('projektnummer').value;
            const baustelle = document.getElementById('baustelle').value;
            const gpsLat = document.getElementById('gpsLat').value;
            const gpsLon = document.getElementById('gpsLon').value;
            
            if (!baustelle) {
                alert('‚ö†Ô∏è Bitte Baustelle eingeben!');
                return;
            }
            
            // Collect all activities from table - v3.3 Ultra-Mega-DB fixed
            const tbody = document.getElementById('taetigkeitenTable');
            const rows = tbody.querySelectorAll('tr');
            const taetigkeiten = [];
            
            rows.forEach(row => {
                if (row.cells && row.cells.length >= 3) {
                    const cell = row.cells[2]; // Dritte Spalte = T√§tigkeit
                    const textarea = cell.querySelector('textarea');
                    const text = textarea ? textarea.value.trim() : cell.textContent.trim();
                    if (text && text !== 'T√§tigkeit') {
                        taetigkeiten.push(text);
                    }
                }
            });
            
            const canvas1 = document.getElementById('signaturePad1');
            const canvas2 = document.getElementById('signaturePad2');
            const signature1 = canvas1 ? canvas1.toDataURL('image/jpeg', 0.8) : '';
            const signature2 = canvas2 ? canvas2.toDataURL('image/jpeg', 0.8) : '';
            
            // v3.3 Ultra-Mega-DB: Berechne Gesamtstunden und km f√ºr Statistiken
            const gesamtStunden = personalListe.reduce((sum, p) => sum + (p.anzahl * p.stunden), 0);
            const gesamtKm = fahrzeugListe.reduce((sum, f) => sum + (f.anzahl * f.km), 0);
            
            const bericht = {
                rapportNr,
                datum,
                projektnummer,
                baustelle,
                gps: { lat: gpsLat, lon: gpsLon },
                taetigkeiten,
                material: document.getElementById('materialText').value,
                maschinen: document.getElementById('maschinenText').value,
                personal: [...personalListe],
                fahrzeuge: [...fahrzeugListe],
                photos: [...photos],
                signature1,
                signature2,
                stunden: gesamtStunden,
                km: gesamtKm,
                timestamp: new Date().toISOString()
            };
            
            const berichte = JSON.parse(localStorage.getItem('baustellenberichte') || '[]');
            berichte.push(bericht);
            localStorage.setItem('baustellenberichte', JSON.stringify(berichte));
            
            showToast('Bericht erfolgreich gespeichert!', 'success');
            resetForm();
            updateRapportNummer();
        }
        
        // ===== RESET =====
        function resetForm() {
            document.getElementById('baustelle').value = '';
            document.getElementById('materialText').value = '';
            document.getElementById('maschinenText').value = '';
            document.getElementById('personalFormText').textContent = '';
            
            // Reset table - l√∂she alle Zeilen
            const tbody = document.getElementById('taetigkeitenTable');
            while (tbody.rows.length > 0) {
                tbody.deleteRow(0);
            }
            taetigkeitenRowCounter = 1;
            
            selectedTaetigkeiten = [];
            selectedMaterial = [];
            selectedWerkzeuge = [];
            personalListe = [];
            fahrzeugListe = [];
            photos = [];
            
            updatePersonalListe();
            updateFahrzeugListe();
            updatePhotoGrid();
            
            clearSignature('signaturePad1');
            clearSignature('signaturePad2');
            
            document.getElementById('taetigkeitenChips').innerHTML = '';
            document.getElementById('materialChips').innerHTML = '';
            document.getElementById('werkzeugeChips').innerHTML = '';
            
            const today = new Date();
            document.getElementById('datum').valueAsDate = today;
            
            showToast('Formular zur√ºckgesetzt', 'success');
        }
        
        // ===== DOWNLOAD & EXPORT FUNKTIONEN =====
        // Download aktuellen Bericht als JSON
        function downloadBerichtAsJSON() {
            const rapportNr = document.getElementById('rapportNummer').textContent;
            const datum = document.getElementById('datum').value;
            const projektnummer = document.getElementById('projektnummer').value;
            const baustelle = document.getElementById('baustelle').value;
            const gpsLat = document.getElementById('gpsLat').value;
            const gpsLon = document.getElementById('gpsLon').value;
            
            if (!baustelle) {
                alert('‚ö†Ô∏è Bitte erst Baustelle eingeben!');
                return;
            }
            
            // Collect data
            const tbody = document.getElementById('taetigkeitenTable');
            const rows = tbody.querySelectorAll('tr');
            const taetigkeiten = [];
            
            rows.forEach(row => {
                const textarea = row.querySelector('textarea');
                const text = textarea ? textarea.value.trim() : row.cells[2].textContent.trim();
                if (text) {
                    taetigkeiten.push(text);
                }
            });
            
            const canvas1 = document.getElementById('signaturePad1');
            const canvas2 = document.getElementById('signaturePad2');
            const signature1 = canvas1 ? canvas1.toDataURL('image/jpeg', 0.8) : '';
            const signature2 = canvas2 ? canvas2.toDataURL('image/jpeg', 0.8) : '';
            
            const bericht = {
                rapportNr,
                datum,
                projektnummer,
                baustelle,
                gps: { lat: gpsLat, lon: gpsLon },
                taetigkeiten,
                material: document.getElementById('materialText').value,
                maschinen: document.getElementById('maschinenText').value,
                personal: [...personalListe],
                fahrzeuge: [...fahrzeugListe],
                photos: [...photos],
                signature1,
                signature2,
                stunden: personalListe.reduce((sum, p) => sum + (p.anzahl * p.stunden), 0),
                km: fahrzeugListe.reduce((sum, f) => sum + (f.anzahl * f.km), 0),
                timestamp: new Date().toISOString()
            };
            
            // Create download
            const dataStr = JSON.stringify(bericht, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `Baustellenbericht_${rapportNr}_${datum}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            showToast('üì• Bericht als JSON heruntergeladen!', 'success');
        }
        
        // Download alle Berichte als Backup
        function downloadAllBerichteAsBackup() {
            const berichte = JSON.parse(localStorage.getItem('baustellenberichte') || '[]');
            
            if (berichte.length === 0) {
                showToast('‚ö†Ô∏è Keine gespeicherten Berichte vorhanden', 'info');
                return;
            }
            
            const backup = {
                version: '1.11',
                exportDate: new Date().toISOString(),
                count: berichte.length,
                berichte: berichte
            };
            
            const dataStr = JSON.stringify(backup, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            const dateStr = new Date().toISOString().split('T')[0];
            link.download = `Baustellenberichte_Backup_${dateStr}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            showToast(`üì• ${berichte.length} Berichte als Backup heruntergeladen!`, 'success');
        }
        
        // Import Backup
        function importBerichteBackup(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const backup = JSON.parse(e.target.result);
                    
                    if (!backup.berichte || !Array.isArray(backup.berichte)) {
                        throw new Error('Ung√ºltiges Backup-Format');
                    }
                    
                    const confirmed = confirm(
                        `Backup mit ${backup.berichte.length} Berichten importieren?\n` +
                        `Export-Datum: ${new Date(backup.exportDate).toLocaleString()}\n\n` +
                        `‚ö†Ô∏è Dies √ºberschreibt alle aktuellen Berichte!`
                    );
                    
                    if (!confirmed) return;
                    
                    localStorage.setItem('baustellenberichte', JSON.stringify(backup.berichte));
                    showToast(`‚úÖ ${backup.berichte.length} Berichte importiert!`, 'success');
                    updateRapportNummer();
                    
                } catch (error) {
                    showToast('‚ùå Fehler beim Importieren: ' + error.message, 'error');
                }
            };
            reader.readAsText(file);
        }
        
        // AUTO-SAVE FUNKTION
        let autoSaveInterval = null;
        let lastAutoSaveData = '';
        
        function enableAutoSave() {
            // Auto-Save alle 30 Sekunden
            if (autoSaveInterval) {
                clearInterval(autoSaveInterval);
            }
            
            autoSaveInterval = setInterval(() => {
                const baustelle = document.getElementById('baustelle').value;
                if (!baustelle) return; // Nur speichern wenn Baustelle angegeben
                
                // Check if data has changed
                const currentData = JSON.stringify({
                    baustelle: document.getElementById('baustelle').value,
                    material: document.getElementById('materialText').value,
                    maschinen: document.getElementById('maschinenText').value
                });
                
                if (currentData === lastAutoSaveData) return;
                
                lastAutoSaveData = currentData;
                
                // Save to sessionStorage (temporary, lost on browser close)
                const autoSaveData = {
                    baustelle: document.getElementById('baustelle').value,
                    projektnummer: document.getElementById('projektnummer').value,
                    datum: document.getElementById('datum').value,
                    gpsLat: document.getElementById('gpsLat').value,
                    gpsLon: document.getElementById('gpsLon').value,
                    material: document.getElementById('materialText').value,
                    maschinen: document.getElementById('maschinenText').value,
                    timestamp: new Date().toISOString()
                };
                
                sessionStorage.setItem('baustellenbericht_autosave', JSON.stringify(autoSaveData));
                
                // Show subtle notification
                const indicator = document.getElementById('autoSaveIndicator');
                if (indicator) {
                    indicator.textContent = 'üíæ Auto-gespeichert um ' + new Date().toLocaleTimeString();
                    indicator.style.opacity = '1';
                    setTimeout(() => {
                        indicator.style.opacity = '0.5';
                    }, 2000);
                }
            }, 30000); // 30 seconds
        }
        
        // Restore auto-saved data on page load
        function restoreAutoSave() {
            const saved = sessionStorage.getItem('baustellenbericht_autosave');
            if (!saved) return;
            
            try {
                const data = JSON.parse(saved);
                const age = Date.now() - new Date(data.timestamp).getTime();
                
                // Only restore if less than 1 hour old
                if (age > 3600000) {
                    sessionStorage.removeItem('baustellenbericht_autosave');
                    return;
                }
                
                const confirmed = confirm(
                    'üíæ Auto-gespeicherte Daten gefunden!\n\n' +
                    `Baustelle: ${data.baustelle}\n` +
                    `Von: ${new Date(data.timestamp).toLocaleString()}\n\n` +
                    'M√∂chten Sie diese Daten wiederherstellen?'
                );
                
                if (confirmed) {
                    document.getElementById('baustelle').value = data.baustelle || '';
                    document.getElementById('projektnummer').value = data.projektnummer || '';
                    document.getElementById('datum').value = data.datum || '';
                    document.getElementById('gpsLat').value = data.gpsLat || '';
                    document.getElementById('gpsLon').value = data.gpsLon || '';
                    document.getElementById('materialText').value = data.material || '';
                    document.getElementById('maschinenText').value = data.maschinen || '';
                    
                    showToast('‚úÖ Auto-gespeicherte Daten wiederhergestellt!', 'success');
                }
                
                sessionStorage.removeItem('baustellenbericht_autosave');
            } catch (error) {
                console.error('Error restoring auto-save:', error);
            }
        }
        
        // ===== INTERAKTIVE KARTE MIT LEAFLET (OpenStreetMap) =====
        let map = null;
        let marker = null;
        
        function openMapPicker() {
            // Create modal for map
            const modalHTML = `
                <div id="mapModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10000; display: flex; align-items: center; justify-content: center;">
                    <div style="background: white; border-radius: 12px; width: 90%; max-width: 800px; max-height: 90%; overflow: hidden; box-shadow: 0 20px 60px rgba(0,0,0,0.5);">
                        <div style="padding: 20px; border-bottom: 2px solid #e5e7eb; display: flex; justify-content: space-between; align-items: center;">
                            <h3 style="margin: 0;">üìç Standort auf Karte w√§hlen</h3>
                            <button onclick="closeMapPicker()" style="background: #dc2626; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: bold;">‚úÖ‚Ä¢ Schlie√üen</button>
                        </div>
                        <div style="padding: 15px; background: #f3f4f6;">
                            <p style="margin: 0; font-size: 14px;">
                                <strong>Anleitung:</strong> Klicken Sie auf die Karte um den Standort zu w√§hlen. Die Adresse wird automatisch ermittelt und Sie k√∂nnen w√§hlen, welche Informationen √ºbernommen werden sollen (Gesch√§ft, Stra√üe, etc.).
                            </p>
                        </div>
                        <div id="map" style="height: 500px; width: 100%;"></div>
                        <div style="padding: 15px; background: #f9fafb; border-top: 1px solid #e5e7eb;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div id="mapCoords" style="font-size: 14px; color: #64748b;">
                                    Klicken Sie auf die Karte...
                                </div>
                                <button onclick="confirmMapSelection()" style="background: #10b981; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: bold;">
                                    ‚úÖ Standort √ºbernehmen
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            
            // Initialize map
            setTimeout(() => {
                // Get current coordinates or use default (Berlin)
                const currentLat = parseFloat(document.getElementById('gpsLat').value) || 52.5200;
                const currentLon = parseFloat(document.getElementById('gpsLon').value) || 13.4050;
                
                map = L.map('map').setView([currentLat, currentLon], 13);
                
                // Add OpenStreetMap tiles
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '¬© OpenStreetMap contributors',
                    maxZoom: 19
                }).addTo(map);
                
                // Add marker if coordinates exist
                if (document.getElementById('gpsLat').value) {
                    marker = L.marker([currentLat, currentLon]).addTo(map);
                    document.getElementById('mapCoords').innerHTML = `üìç Ausgew√§hlt: ${currentLat.toFixed(6)}, ${currentLon.toFixed(6)}`;
                }
                
                // Add click event
                map.on('click', async function(e) {
                    const lat = e.latlng.lat;
                    const lon = e.latlng.lng;
                    
                    // Remove old marker
                    if (marker) {
                        map.removeLayer(marker);
                    }
                    
                    // Add new marker
                    marker = L.marker([lat, lon]).addTo(map);
                    
                    // Update display with loading message
                    document.getElementById('mapCoords').innerHTML = `üìç ${lat.toFixed(6)}, ${lon.toFixed(6)} - <span style="color: #f59e0b;">‚è≥ Adresse wird geladen...</span>`;
                    
                    // Reverse Geocoding mit Nominatim
                    try {
                        const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}&zoom=18&addressdetails=1`, {
                            headers: {
                                'User-Agent': 'Baustellenbericht-App/1.12'
                            }
                        });
                        
                        if (!response.ok) throw new Error('Keine Internetverbindung');
                        
                        const data = await response.json();
                        
                        // Erstelle Auswahl-Optionen
                        const options = [];
                        
                        // Option 1: Vollst√§ndige Adresse
                        if (data.display_name) {
                            options.push({
                                label: 'üìç Vollst√§ndige Adresse',
                                value: data.display_name
                            });
                        }
                        
                        // Option 2: POI + Stra√üe (wenn POI vorhanden)
                        if (data.address) {
                            const addr = data.address;
                            let poiStreet = '';
                            
                            // POI Priorisierung: shop > supermarket > building > amenity
                            const poi = addr.shop || addr.supermarket || addr.building || addr.amenity || 
                                       addr.retail || addr.commercial || addr.office;
                            
                            if (poi && (addr.road || addr.street)) {
                                const street = addr.road || addr.street;
                                const houseNumber = addr.house_number || '';
                                poiStreet = poi + ', ' + street + (houseNumber ? ' ' + houseNumber : '');
                                options.push({
                                    label: 'üìç Gesch√§ft + Stra√üe',
                                    value: poiStreet
                                });
                            }
                            
                            // Option 3: Nur Stra√üe + Hausnummer
                            if (addr.road || addr.street) {
                                const street = addr.road || addr.street;
                                const houseNumber = addr.house_number || '';
                                const streetOnly = street + (houseNumber ? ' ' + houseNumber : '');
                                options.push({
                                    label: 'üìç Stra√üe + Hausnr.',
                                    value: streetOnly
                                });
                            }
                            
                            // Option 4: Nur Stadt/Ort
                            const city = addr.city || addr.town || addr.village || addr.hamlet;
                            if (city) {
                                options.push({
                                    label: 'üìçÔ∏è Nur Ort',
                                    value: city
                                });
                            }
                        }
                        
                        // Option 5: Nur Koordinaten (Fallback)
                        options.push({
                            label: 'üìç Nur Koordinaten',
                            value: `${lat.toFixed(6)}, ${lon.toFixed(6)}`
                        });
                        
                        // Zeige Auswahl-Dropdown
                        let optionsHTML = '<div style="margin-top: 10px;">';
                        optionsHTML += '<label style="display: block; margin-bottom: 5px; font-weight: bold; color: #374151;">Welche Information √ºbernehmen?</label>';
                        optionsHTML += '<select id="addressSelect" style="width: 100%; padding: 8px; border: 2px solid #d1d5db; border-radius: 6px; font-size: 14px;">';
                        options.forEach((opt, idx) => {
                            optionsHTML += `<option value="${idx}">${opt.label}: ${opt.value}</option>`;
                        });
                        optionsHTML += '</select>';
                        optionsHTML += '</div>';
                        
                        document.getElementById('mapCoords').innerHTML = `üìç ${lat.toFixed(6)}, ${lon.toFixed(6)}` + optionsHTML;
                        
                        // Speichere Optionen f√ºr confirmMapSelection
                        window.selectedLocationOptions = options;
                        
                    } catch (error) {
                        // Offline-Fallback: Nur Koordinaten
                        console.log('Reverse Geocoding fehlgeschlagen:', error);
                        document.getElementById('mapCoords').innerHTML = `üìç ${lat.toFixed(6)}, ${lon.toFixed(6)} <span style="color: #ef4444; font-size: 12px;">(Offline - nur Koordinaten)</span>`;
                        window.selectedLocationOptions = [{
                            label: 'üìç Koordinaten',
                            value: `${lat.toFixed(6)}, ${lon.toFixed(6)}`
                        }];
                    }
                });
            }, 100);
        }
        
        function confirmMapSelection() {
            if (!marker) {
                showToast('‚ö†Ô∏è Bitte erst einen Standort auf der Karte w√§hlen', 'warning');
                return;
            }
            
            const latlng = marker.getLatLng();
            document.getElementById('gpsLat').value = latlng.lat.toFixed(6);
            document.getElementById('gpsLon').value = latlng.lng.toFixed(6);
            
            // √úbernehme ausgew√§hlte Adress-Information ins Baustelle-Feld
            if (window.selectedLocationOptions) {
                const selectEl = document.getElementById('addressSelect');
                const selectedIdx = selectEl ? parseInt(selectEl.value) : 0;
                const selectedAddress = window.selectedLocationOptions[selectedIdx].value;
                
                // Baustelle-Feld finden
                const baustelleField = document.getElementById('baustelle');
                
                // Anh√§ngen an bestehenden Text (mit Komma wenn bereits Text vorhanden)
                if (baustelleField) {
                    const currentValue = baustelleField.value.trim();
                    if (currentValue) {
                        baustelleField.value = currentValue + ', ' + selectedAddress;
                    } else {
                        baustelleField.value = selectedAddress;
                    }
                    
                    showToast(`‚úÖ Adresse hinzugef√ºgt: ${selectedAddress}`, 'success');
                }
            }
            
            const statusEl = document.getElementById('gpsStatus');
            statusEl.className = 'gps-status gps-success';
            statusEl.innerHTML = `‚úÖ Standort von Karte √ºbernommen: ${latlng.lat.toFixed(6)}, ${latlng.lng.toFixed(6)}`;
            
            closeMapPicker();
        }
        
        function closeMapPicker() {
            const modal = document.getElementById('mapModal');
            if (modal) {
                if (map) {
                    map.remove();
                    map = null;
                }
                marker = null;
                modal.remove();
            }
        }
        
        // ===== WHATSAPP SHARE =====
        async function shareViaWhatsApp() {
            // PDF-Library Check
            if (typeof window.jspdf === 'undefined') {
                showToast('‚ö†Ô∏è PDF-Library wird geladen. Bitte in 2-3 Sekunden erneut versuchen.', 'error');
                return;
            }
            
            try {
                const doc = new jsPDF();
                
                // Header
                doc.setFillColor(220, 38, 38);
                doc.rect(0, 0, 210, 30, 'F');
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(24);
                doc.setFont(undefined, 'bold');
                doc.text('FLIESEN UNGER S√úD', 15, 18);
                doc.setFontSize(10);
                doc.setFont(undefined, 'normal');
                doc.text('Baustellenbericht', 15, 24);
                
                doc.setTextColor(0, 0, 0);
                
                // Rapport-Nummer
                const rapportNr = document.getElementById('rapportNummer').textContent;
                doc.setFontSize(14);
                doc.setFont(undefined, 'bold');
                doc.text(`Rapport Nr. ${rapportNr}`, 15, 40);
                
                // Projektnummer & Baustelle
                const projektnummer = document.getElementById('projektnummer').value;
                const baustelle = document.getElementById('baustelle').value;
                doc.setFontSize(11);
                doc.setFont(undefined, 'normal');
                let yPos = 48;
                if (projektnummer) {
                    doc.text(`Projektnummer: ${projektnummer}`, 15, yPos);
                    yPos += 6;
                }
                if (baustelle) {
                    doc.text(`Baustelle: ${baustelle}`, 15, yPos);
                    yPos += 6;
                }
                
                // Datum
                const datum = document.getElementById('datum').value;
                doc.text(`Datum: ${new Date(datum).toLocaleDateString('de-DE')}`, 15, yPos);
                yPos += 10;
                
                // Content
                const tbody = document.getElementById('taetigkeitenTable');
                const rows = tbody.querySelectorAll('tr');
                
                if (rows.length > 0) {
                    doc.setFontSize(11);
                    doc.setFont(undefined, 'bold');
                    doc.text('T√§tigkeiten:', 15, yPos);
                    yPos += 6;
                    doc.setFont(undefined, 'normal');
                    doc.setFontSize(10);
                    rows.forEach(row => {
                        const cells = row.cells;
                        if (cells.length >= 3) {
                            const pos = cells[0].textContent;
                            const taetigkeit = cells[2].textContent;
                            doc.text(`${pos}. ${taetigkeit}`, 20, yPos);
                            yPos += 5;
                        }
                    });
                    yPos += 3;
                }
                
                // Save PDF as Blob
                const pdfBlob = doc.output('blob');
                const fileName = `Baustellenbericht_${rapportNr}_${new Date().toISOString().split('T')[0]}.pdf`;
                
                // Feature Detection f√ºr Web Share API
                if (browserCaps.features.webShare) {
                    const canShareFiles = await browserCaps.canShareFiles();
                    
                    if (canShareFiles) {
                        const file = new File([pdfBlob], fileName, { type: 'application/pdf' });
                        
                        // Nochmal validieren (double-check)
                        if (navigator.canShare({ files: [file] })) {
                            try {
                                await navigator.share({
                                    files: [file],
                                    title: `Baustellenbericht ${rapportNr}`,
                                    text: `Baustellenbericht f√ºr ${baustelle || 'Baustelle'}`
                                });
                                showToast('‚úÖ PDF geteilt!', 'success');
                                return; // Erfolgreich geteilt, fertig!
                            } catch (error) {
                                if (error.name === 'AbortError') {
                                    showToast('‚ÑπÔ∏è Teilen abgebrochen', 'info');
                                    return;
                                }
                                console.warn('Share fehlgeschlagen, Fallback zu Download:', error);
                            }
                        }
                    }
                }
                
                // Fallback: Download PDF (funktioniert √ºberall!)
                const url = URL.createObjectURL(pdfBlob);
                const a = document.createElement('a');
                a.href = url;
                a.download = fileName;
                a.style.display = 'none';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showToast('‚¨õ‚Ä°Ô∏è PDF wird heruntergeladen', 'success');
                
            } catch (error) {
                console.error('WhatsApp Share Error:', error);
                showToast('‚ùå Fehler beim Erstellen des PDFs', 'error');
            }
        }
        
        // ===== PDF =====
        function generatePDF() {
            if (typeof window.jspdf === 'undefined') {
                alert('‚ö†Ô∏è PDF-Library wird geladen. Bitte in 2-3 Sekunden erneut versuchen.');
                return;
            }
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // v1.14: KOMPAKTES 1-SEITEN-PDF - checkPageBreak() ENTFERNT!
            // Alle Inhalte passen auf 1 Seite durch kleinere Schriften & Abst√§nde
            
            const rapportNr = document.getElementById('rapportNummer').textContent;
            const datum = document.getElementById('datum').value;
            const projektnummer = document.getElementById('projektnummer').value;
            const baustelle = document.getElementById('baustelle').value;
            
            // Header - KOMPAKT (v1.14)
            doc.setFillColor(220, 38, 38);
            doc.rect(15, 15, 50, 12, 'F');
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(14); // v1.14: 14 statt 16
            doc.setFont(undefined, 'bold');
            doc.text('FLIESEN', 20, 23);
            doc.text('UNGER S√úD', 20, 28);
            
            doc.setTextColor(0, 0, 0);
            doc.setFontSize(7); // v1.14: 7 statt 8
            doc.setFont(undefined, 'normal');
            doc.text('Tulpenallee 69, 71069 Sindelfingen', 150, 18);
            doc.text('Tel: 07031/9219 9-0', 150, 22);
            doc.text('info@fliesen-unger-sued.de', 150, 26);
            
            doc.setFontSize(11); // v1.14: 11 statt 14
            doc.setFont(undefined, 'bold');
            doc.text(`RAPPORT Nr. ${rapportNr}`, 140, 40);
            
            doc.setFontSize(9); // v1.14: 9 statt 10
            doc.text('Projektnummer:', 15, 50);
            doc.setFont(undefined, 'normal');
            doc.text(projektnummer || '-', 50, 50);
            
            doc.setFont(undefined, 'bold');
            doc.text('Baustelle:', 15, 56);
            doc.setFont(undefined, 'normal');
            doc.text(baustelle, 40, 56);
            
            doc.text('Datum:', 15, 62);
            doc.text(datum, 40, 62);
            
            let yPos = 71;
            
            // Activities
            const tbody = document.getElementById('taetigkeitenTable');
            const rows = tbody.querySelectorAll('tr');
            let hasTaetigkeiten = false;
            
            rows.forEach(row => {
                const textarea = row.querySelector('textarea');
                const text = textarea ? textarea.value.trim() : row.cells[2].textContent.trim();
                if (text) {
                    if (!hasTaetigkeiten) {
                        checkPageBreak();
                        doc.setFont(undefined, 'bold');
                        doc.text('T√§tigkeiten:', 15, yPos);
                        yPos += 6;
                        doc.setFont(undefined, 'normal');
                        doc.setFontSize(10);
                        hasTaetigkeiten = true;
                    }
                    checkPageBreak();
                    doc.text('‚Ä¢ ' + text, 20, yPos);
                    yPos += 5;
                }
            });
            
            if (hasTaetigkeiten) yPos += 3;
            
            // Material
            const material = document.getElementById('materialText').value.trim();
            if (material) {
                checkPageBreak();
                doc.setFontSize(11);
                doc.setFont(undefined, 'bold');
                doc.text('Material:', 15, yPos);
                yPos += 6;
                doc.setFont(undefined, 'normal');
                doc.setFontSize(10);
                material.split('\n').forEach(line => {
                    if (line.trim()) {
                        checkPageBreak();
                        doc.text('‚Ä¢ ' + line.trim(), 20, yPos);
                        yPos += 5;
                    }
                });
                yPos += 3;
            }
            
            // Maschinen
            const maschinen = document.getElementById('maschinenText').value.trim();
            if (maschinen) {
                checkPageBreak();
                doc.setFontSize(11);
                doc.setFont(undefined, 'bold');
                doc.text('Maschinen:', 15, yPos);
                yPos += 6;
                doc.setFont(undefined, 'normal');
                doc.setFontSize(10);
                maschinen.split('\n').forEach(line => {
                    if (line.trim()) {
                        checkPageBreak();
                        doc.text('‚Ä¢ ' + line.trim(), 20, yPos);
                        yPos += 5;
                    }
                });
                yPos += 3;
            }
            
            // Personal
            if (personalListe.length > 0) {
                checkPageBreak();
                doc.setFontSize(11);
                doc.setFont(undefined, 'bold');
                doc.text('Personal:', 15, yPos);
                yPos += 6;
                doc.setFont(undefined, 'normal');
                doc.setFontSize(10);
                personalListe.forEach(p => {
                    checkPageBreak();
                    const anzahlText = p.anzahl > 1 ? `${p.anzahl}x ` : '';
                    doc.text(`‚Ä¢ ${anzahlText}${p.typ}: ${p.stunden}h`, 20, yPos);
                    yPos += 5;
                });
                yPos += 3;
            }
            
            // Fahrzeuge
            if (fahrzeugListe.length > 0) {
                checkPageBreak();
                doc.setFontSize(11);
                doc.setFont(undefined, 'bold');
                doc.text('Fahrzeuge:', 15, yPos);
                yPos += 6;
                doc.setFont(undefined, 'normal');
                doc.setFontSize(10);
                fahrzeugListe.forEach(fz => {
                    checkPageBreak();
                    const anzahlText = fz.anzahl > 1 ? `${fz.anzahl}x ` : '';
                    doc.text(`‚Ä¢ ${anzahlText}${fz.typ}: ${fz.kennzeichen} - ${fz.km} km`, 20, yPos);
                    yPos += 5;
                });
                yPos += 3;
            }
            
            // GPS
            const gpsLat = document.getElementById('gpsLat').value;
            const gpsLon = document.getElementById('gpsLon').value;
            if (gpsLat && gpsLon) {
                checkPageBreak();
                doc.setFontSize(9);
                doc.text(`GPS: ${gpsLat}, ${gpsLon}`, 15, yPos);
                yPos += 5;
            }
            
            // Signatures
            doc.setFontSize(10);
            doc.setFont(undefined, 'bold');
            doc.text('Fliesen Unger S√ºd GmbH', 15, 270);
            const canvas1 = document.getElementById('signaturePad1');
            if (canvas1) {
                const sig1 = canvas1.toDataURL('image/jpeg', 0.8);
                doc.addImage(sig1, 'JPEG', 15, 275, 60, 15);
            }
            
            doc.text('Auftraggeber', 120, 270);
            const canvas2 = document.getElementById('signaturePad2');
            if (canvas2) {
                const sig2 = canvas2.toDataURL('image/jpeg', 0.8);
                doc.addImage(sig2, 'JPEG', 120, 275, 60, 15);
            }
            
            const filename = `Baustellenbericht_${rapportNr}_${baustelle.replace(/[^a-z0-9]/gi, '_')}.pdf`;
            doc.save(filename);
            
            showToast('PDF erfolgreich heruntergeladen!', 'success');
        }
        
        // ===== LISTE =====
        function loadBerichte() {
            const berichte = JSON.parse(localStorage.getItem('baustellenberichte') || '[]');
            const liste = document.getElementById('berichteListe');
            
            if (berichte.length === 0) {
                liste.innerHTML = '<p style="text-align: center; color: #64748b; padding: 40px;">Noch keine Berichte gespeichert.</p>';
                return;
            }
            
            liste.innerHTML = '';
            
            // WICHTIG: Kopie erstellen f√ºr reverse, nicht das Original ver√§ndern
            const berichteReversed = [...berichte].reverse();
            
            berichteReversed.forEach((bericht, index) => {
                const actualIndex = berichte.length - 1 - index;
                const div = document.createElement('div');
                div.className = 'bericht-card';
                
                div.innerHTML = `
                    <h3>Rapport ${bericht.rapportNr} - ${bericht.baustelle}</h3>
                    <p style="color: #64748b; margin: 8px 0;">
                        ${bericht.projektnummer ? `<strong>Projektnummer:</strong> ${bericht.projektnummer}<br>` : ''}
                        <strong>Datum:</strong> ${bericht.datum}<br>
                        <strong>T√§tigkeiten:</strong> ${bericht.taetigkeiten.length} Eintr√§ge<br>
                        ${bericht.personal.length > 0 ? `<strong>Personal:</strong> ${bericht.personal.length} Eintr√§ge<br>` : ''}
                        ${bericht.fahrzeuge.length > 0 ? `<strong>Fahrzeuge:</strong> ${bericht.fahrzeuge.length} Eintr√§ge<br>` : ''}
                        ${bericht.photos.length > 0 ? `<strong>Fotos:</strong> ${bericht.photos.length}<br>` : ''}
                    </p>
                    <div class="bericht-actions">
                        <button class="btn btn-primary" onclick="generatePDFFromList(${actualIndex})">üìÑ PDF</button>
                        <button class="btn btn-secondary" style="background: #ef4444;" onclick="if(confirm('Wirklich l√∂schen?')) deleteBericht(${actualIndex})">üóëÔ∏è L√∂schen</button>
                    </div>
                `;
                
                liste.appendChild(div);
            });
        }
        
        function deleteBericht(index) {
            const berichte = JSON.parse(localStorage.getItem('baustellenberichte') || '[]');
            berichte.splice(index, 1);
            localStorage.setItem('baustellenberichte', JSON.stringify(berichte));
            loadBerichte();
            showToast('Bericht gel√∂scht', 'success');
        }
        
        function generatePDFFromList(index) {
            const berichte = JSON.parse(localStorage.getItem('baustellenberichte') || '[]');
            const bericht = berichte[index];
            
            if (typeof window.jspdf === 'undefined') {
                alert('‚ö†Ô∏è PDF-Library wird geladen. Bitte in 2-3 Sekunden erneut versuchen.');
                return;
            }
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Hilfsfunktion f√ºr automatischen Seitenumbruch
            function checkPageBreak() {
                if (yPos > 270) {
                    doc.addPage();
                    yPos = 20;
                    return true;
                }
                return false;
            }
            
            // Header
            doc.setFillColor(220, 38, 38);
            doc.rect(15, 15, 50, 12, 'F');
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(16);
            doc.setFont(undefined, 'bold');
            doc.text('FLIESEN', 20, 23);
            doc.text('UNGER S√úD', 20, 28);
            
            doc.setTextColor(0, 0, 0);
            doc.setFontSize(8);
            doc.setFont(undefined, 'normal');
            doc.text('Tulpenallee 69, 71069 Sindelfingen', 150, 18);
            doc.text('Tel: 07031/9219 9-0', 150, 22);
            doc.text('info@fliesen-unger-sued.de', 150, 26);
            
            doc.setFontSize(14);
            doc.setFont(undefined, 'bold');
            doc.text(`RAPPORT Nr. ${bericht.rapportNr}`, 140, 40);
            
            doc.setFontSize(10);
            doc.text('Projektnummer:', 15, 50);
            doc.setFont(undefined, 'normal');
            doc.text(bericht.projektnummer || '-', 50, 50);
            
            doc.setFont(undefined, 'bold');
            doc.text('Baustelle:', 15, 56);
            doc.setFont(undefined, 'normal');
            doc.text(bericht.baustelle, 40, 56);
            
            doc.text('Datum:', 15, 62);
            doc.text(bericht.datum, 40, 62);
            
            let yPos = 71;
            
            if (bericht.taetigkeiten.length > 0) {
                checkPageBreak();
                doc.setFont(undefined, 'bold');
                doc.text('T√§tigkeiten:', 15, yPos);
                yPos += 6;
                doc.setFont(undefined, 'normal');
                doc.setFontSize(10);
                bericht.taetigkeiten.forEach(t => {
                    checkPageBreak();
                    doc.text('‚Ä¢ ' + t, 20, yPos);
                    yPos += 5;
                });
                yPos += 3;
            }
            
            if (bericht.material) {
                checkPageBreak();
                doc.setFontSize(11);
                doc.setFont(undefined, 'bold');
                doc.text('Material:', 15, yPos);
                yPos += 6;
                doc.setFont(undefined, 'normal');
                doc.setFontSize(10);
                bericht.material.split('\n').forEach(line => {
                    if (line.trim()) {
                        checkPageBreak();
                        doc.text('‚Ä¢ ' + line.trim(), 20, yPos);
                        yPos += 5;
                    }
                });
                yPos += 3;
            }
            
            if (bericht.maschinen) {
                checkPageBreak();
                doc.setFontSize(11);
                doc.setFont(undefined, 'bold');
                doc.text('Maschinen:', 15, yPos);
                yPos += 6;
                doc.setFont(undefined, 'normal');
                doc.setFontSize(10);
                bericht.maschinen.split('\n').forEach(line => {
                    if (line.trim()) {
                        checkPageBreak();
                        doc.text('‚Ä¢ ' + line.trim(), 20, yPos);
                        yPos += 5;
                    }
                });
                yPos += 3;
            }
            
            if (bericht.personal.length > 0) {
                checkPageBreak();
                doc.setFontSize(11);
                doc.setFont(undefined, 'bold');
                doc.text('Personal:', 15, yPos);
                yPos += 6;
                doc.setFont(undefined, 'normal');
                doc.setFontSize(10);
                bericht.personal.forEach(p => {
                    checkPageBreak();
                    const anzahlText = p.anzahl > 1 ? `${p.anzahl}x ` : '';
                    doc.text(`‚Ä¢ ${anzahlText}${p.typ}: ${p.stunden}h`, 20, yPos);
                    yPos += 5;
                });
                yPos += 3;
            }
            
            if (bericht.fahrzeuge.length > 0) {
                checkPageBreak();
                doc.setFontSize(11);
                doc.setFont(undefined, 'bold');
                doc.text('Fahrzeuge:', 15, yPos);
                yPos += 6;
                doc.setFont(undefined, 'normal');
                doc.setFontSize(10);
                bericht.fahrzeuge.forEach(fz => {
                    checkPageBreak();
                    const anzahlText = fz.anzahl > 1 ? `${fz.anzahl}x ` : '';
                    doc.text(`‚Ä¢ ${anzahlText}${fz.typ}: ${fz.kennzeichen} - ${fz.km} km`, 20, yPos);
                    yPos += 5;
                });
                yPos += 3;
            }
            
            if (bericht.gps.lat && bericht.gps.lon) {
                checkPageBreak();
                doc.setFontSize(9);
                doc.text(`GPS: ${bericht.gps.lat}, ${bericht.gps.lon}`, 15, yPos);
                yPos += 5;
            }
            
            doc.setFontSize(10);
            doc.setFont(undefined, 'bold');
            doc.text('Fliesen Unger S√ºd GmbH', 15, 270);
            if (bericht.signature1) {
                doc.addImage(bericht.signature1, 'JPEG', 15, 275, 60, 15);
            }
            
            doc.text('Auftraggeber', 120, 270);
            if (bericht.signature2) {
                doc.addImage(bericht.signature2, 'JPEG', 120, 275, 60, 15);
            }
            
            const filename = `Baustellenbericht_${bericht.rapportNr}_${bericht.baustelle.replace(/[^a-z0-9]/gi, '_')}.pdf`;
            doc.save(filename);
            
            showToast('PDF erfolgreich heruntergeladen!', 'success');
        }
        
        // ===== SPRACHEINGABE =====
        let currentRecognition = null;
        
        async function addTaetigkeitViaVoice() {
            // 1. Feature Detection (kein User-Agent Check!)
            if (!browserCaps.features.speechRecognition) {
                showToast('‚ö†Ô∏è Spracheingabe nicht verf√ºgbar in diesem Browser', 'error');
                return;
            }
            
            if (!browserCaps.features.isSecureContext) {
                showToast('‚ö†Ô∏è HTTPS erforderlich f√ºr Spracheingabe. Bitte √ºber HTTPS oder localhost √∂ffnen.', 'error');
                return;
            }
            
            // 2. Pre-Permission-Dialog zeigen (OHNE navigator.permissions.query!)
            const userConsent = await showMicrophonePermissionPriming();
            if (!userConsent) {
                showToast('‚ÑπÔ∏è Spracheingabe abgebrochen', 'info');
                return;
            }
            
            // 3. Jetzt Speech Recognition starten - Permission-Prompt kommt automatisch
            if (currentRecognition) {
                currentRecognition.stop();
            }
            
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            const recognition = new SpeechRecognition();
            currentRecognition = recognition;
            
            recognition.lang = 'de-DE';
            recognition.continuous = false;
            recognition.interimResults = false;
            recognition.maxAlternatives = 1;
            
            recognition.onstart = function() {
                showToast('üé§ Bitte jetzt sprechen...', 'success');
            };
            
            recognition.onresult = function(event) {
                const transcript = event.results[0][0].transcript;
                
                // v3.3 Ultra-Mega-DB: Zeige Textverbesserungs-Modal mit 5 Vorschl√§gen
                showTextVerbesserungModal(transcript, 'taetigkeit');
            };
            
            recognition.onerror = function(event) {
                let errorMsg = 'Spracheingabe-Fehler';
                
                switch(event.error) {
                    case 'no-speech':
                        errorMsg = 'Keine Sprache erkannt. Bitte erneut versuchen.';
                        break;
                    case 'audio-capture':
                        errorMsg = 'Kein Mikrofon gefunden';
                        break;
                    case 'not-allowed':
                        errorMsg = 'Mikrofon-Zugriff verweigert. Bitte in Browser-Einstellungen aktivieren.';
                        break;
                }
                
                showToast(errorMsg, 'error');
                currentRecognition = null;
            };
            
            recognition.onend = function() {
                currentRecognition = null;
            };
            
            try {
                recognition.start();
            } catch (e) {
                showToast('Fehler beim Starten der Spracheingabe', 'error');
                currentRecognition = null;
            }
        }
        
        async function startVoiceInput(targetId) {
            // 1. Feature Detection (kein User-Agent Check!)
            if (!browserCaps.features.speechRecognition) {
                showToast('‚ö†Ô∏è Spracheingabe nicht verf√ºgbar in diesem Browser', 'error');
                return;
            }
            
            if (!browserCaps.features.isSecureContext) {
                showToast('‚ö†Ô∏è HTTPS erforderlich f√ºr Spracheingabe. Bitte √ºber HTTPS oder localhost √∂ffnen.', 'error');
                return;
            }
            
            // 2. Pre-Permission-Dialog zeigen (OHNE navigator.permissions.query!)
            const userConsent = await showMicrophonePermissionPriming();
            if (!userConsent) {
                showToast('‚ÑπÔ∏è Spracheingabe abgebrochen', 'info');
                return;
            }
            
            // 3. Jetzt Speech Recognition starten - Permission-Prompt kommt automatisch
            if (currentRecognition) {
                currentRecognition.stop();
            }
            
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            const recognition = new SpeechRecognition();
            currentRecognition = recognition;
            
            recognition.lang = 'de-DE';
            recognition.continuous = false;
            recognition.interimResults = false;
            recognition.maxAlternatives = 1;
            
            const targetElement = document.getElementById(targetId);
            
            recognition.onstart = function() {
                showToast('üé§ Sprechen Sie jetzt...', 'success');
                targetElement.style.border = '2px solid #10b981';
            };
            
            recognition.onresult = function(event) {
                const transcript = event.results[0][0].transcript;
                
                // Append to existing text with a newline if there's already content
                if (targetElement.value.trim()) {
                    targetElement.value += '\n' + transcript;
                } else {
                    targetElement.value = transcript;
                }
                
                showToast('‚úÖ Text hinzugef√ºgt', 'success');
                targetElement.style.border = '';
            };
            
            recognition.onerror = function(event) {
                let errorMsg = 'Spracheingabe-Fehler';
                
                switch(event.error) {
                    case 'no-speech':
                        errorMsg = 'Keine Sprache erkannt. Bitte erneut versuchen.';
                        break;
                    case 'audio-capture':
                        errorMsg = 'Kein Mikrofon gefunden';
                        break;
                    case 'not-allowed':
                        errorMsg = 'Mikrofon-Zugriff verweigert. Bitte in Browser-Einstellungen aktivieren.';
                        break;
                }
                
                showToast(errorMsg, 'error');
                targetElement.style.border = '';
                currentRecognition = null;
            };
            
            recognition.onend = function() {
                targetElement.style.border = '';
                currentRecognition = null;
            };
            
            try {
                recognition.start();
            } catch (e) {
                showToast('Fehler beim Starten der Spracheingabe', 'error');
                currentRecognition = null;
            }
        }
        
        function startVoiceInputHelper(targetId) {
            // Diese Funktion ist f√ºr die Helper-Section Textareas
            startVoiceInput(targetId);
        }
        
        // ===== TOAST =====
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }
        
        
        // ===== MIKROFON PERMISSION POPUP =====
        
        // ===== PERMISSION PRIMING FUNKTIONEN =====
        // WICHTIG: navigator.permissions.query funktioniert NICHT zuverl√§ssig auf Android!
        // Daher nutzen wir direkten API-Aufruf mit Pre-Permission-Dialog
        
        // Permission Priming Modal zeigen
        function showMicrophonePermissionPriming() {
            return new Promise((resolve) => {
                const modal = document.getElementById('micPermissionModal');
                
                // Pr√ºfe ob HTTPS/localhost
                if (!browserCaps.features.isSecureContext) {
                    document.getElementById('httpsWarning').style.display = 'block';
                }
                
                modal.style.display = 'flex';
                
                // Tempor√§re Event Listener
                const allowBtn = modal.querySelector('.mic-modal-allow');
                const laterBtn = modal.querySelector('.mic-modal-later');
                
                const handleAllow = () => {
                    modal.style.display = 'none';
                    cleanup();
                    resolve(true); // User akzeptiert
                };
                
                const handleDecline = () => {
                    modal.style.display = 'none';
                    cleanup();
                    resolve(false); // User lehnt ab
                };
                
                const cleanup = () => {
                    allowBtn.removeEventListener('click', handleAllow);
                    laterBtn.removeEventListener('click', handleDecline);
                };
                
                allowBtn.addEventListener('click', handleAllow);
                laterBtn.addEventListener('click', handleDecline);
            });
        }
        
        function closeMicModal() {
            const modal = document.getElementById('micPermissionModal');
            modal.style.display = 'none';
        }
        
        async function allowMicrophone() {
            closeMicModal();
            
            if (!browserCaps.features.getUserMedia) {
                showToast('‚ùå Mikrofon nicht unterst√ºtzt in diesem Browser', 'error');
                return;
            }
            
            if (!browserCaps.features.isSecureContext) {
                showToast('‚ö†Ô∏è HTTPS erforderlich f√ºr Mikrofon-Zugriff', 'error');
                return;
            }
            
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                // Stoppe Stream sofort (wir brauchen nur Permission)
                stream.getTracks().forEach(track => track.stop());
                showToast('‚úÖ Mikrofon-Zugriff erlaubt!', 'success');
            } catch (err) {
                console.error('Mikrofon-Fehler:', err);
                
                let errorMsg = '‚ùå Mikrofon-Zugriff verweigert';
                
                if (err.name === 'NotAllowedError') {
                    errorMsg = '‚ùå Mikrofon-Zugriff verweigert. Bitte in Browser-Einstellungen aktivieren:\n\nChrome: Einstellungen ‚Üí Datenschutz ‚Üí Website-Einstellungen ‚Üí Mikrofon';
                } else if (err.name === 'NotFoundError') {
                    errorMsg = '‚ùå Kein Mikrofon gefunden. Bitte Mikrofon anschlie√üen.';
                } else if (err.name === 'NotReadableError') {
                    errorMsg = '‚ùå Mikrofon wird bereits verwendet. Bitte andere Apps schlie√üen.';
                } else if (err.name === 'SecurityError') {
                    errorMsg = '‚ö†Ô∏è HTTPS erforderlich! Mikrofon funktioniert nur √ºber HTTPS.';
                }
                
                showToast(errorMsg, 'error');
            }
        }
        
        // ===== HTTPS STARTUP CHECK =====
        window.addEventListener('load', () => {
            // Pr√ºfe ob sicherer Kontext
            if (!window.isSecureContext) {
                const protocol = window.location.protocol;
                const hostname = window.location.hostname;
                
                console.warn('‚ö†Ô∏è UNSICHERER KONTEXT!', protocol + '//' + hostname);
                
                // Zeige Setup-Modal
                showSetupModal();
                
                // Zeige gro√üe Warnung
                const warningDiv = document.createElement('div');
                warningDiv.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    background: #dc2626;
                    color: white;
                    padding: 15px;
                    z-index: 99998;
                    text-align: center;
                    font-weight: bold;
                    box-shadow: 0 4px 6px rgba(0,0,0,0.3);
                `;
                warningDiv.innerHTML = `
                    ‚ö†Ô∏è HTTPS ERFORDERLICH!<br>
                    <small>Mikrofon, GPS und Kamera funktionieren nur √ºber HTTPS oder file://</small>
                `;
                document.body.insertBefore(warningDiv, document.body.firstChild);
                
                showToast('‚ö†Ô∏è Diese App ben√∂tigt HTTPS! Bitte Setup-Assistent √∂ffnen.', 'error');
            } else {
                console.log('‚úÖ Sicherer Kontext erkannt:', window.location.protocol);
            }
            
            // Service Worker registrieren (f√ºr PWA und Offline-Funktionalit√§t)
            // Nur auf eigenem Server versuchen (nicht auf Test-Domains)
            const hostname = window.location.hostname;
            const isTestDomain = hostname.includes('claudeusercontent.com') || 
                                hostname.includes('github.io') ||
                                hostname === '' ||
                                window.location.protocol === 'about:';
            
            if ('serviceWorker' in navigator && window.isSecureContext && !isTestDomain) {
                navigator.serviceWorker.register('service-worker.js')
                    .then(registration => {
                        console.log('‚úÖ Service Worker registriert:', registration.scope);
                    })
                    .catch(error => {
                        console.log('‚ÑπÔ∏è Service Worker nicht verf√ºgbar (optional)');
                        // Kein Fehler anzeigen - optional Feature
                    });
                
                // PWA Install-Prompt Event
                let deferredPrompt;
                window.addEventListener('beforeinstallprompt', (e) => {
                    e.preventDefault();
                    deferredPrompt = e;
                    console.log('‚úÖ PWA kann installiert werden!');
                    
                    // Optional: Install-Button anzeigen
                    // showToast('üí° Tipp: Diese App kann auf dem Home-Screen installiert werden!', 'info');
                });
                
                window.addEventListener('appinstalled', () => {
                    console.log('‚úÖ PWA wurde auf dem Home-Screen installiert!');
                    deferredPrompt = null;
                });
            }
        });
        
        // ===== SETUP ASSISTANT FUNCTIONS =====
        let detectedLocalIP = null;
        
        function showSetupModal() {
            const modal = document.getElementById('setupModal');
            modal.classList.remove('hidden');
            
            // Zeige aktuelle URL
            document.getElementById('setupCurrentUrl').textContent = 
                `Aktuelle URL: ${window.location.protocol}//${window.location.host}`;
            
            // Erkenne lokale IP
            detectLocalIP();
        }
        
        function minimizeSetup() {
            document.getElementById('setupModal').classList.add('hidden');
            document.getElementById('setupReopenBtn').classList.remove('hidden');
        }
        
        function reopenSetup() {
            document.getElementById('setupModal').classList.remove('hidden');
            document.getElementById('setupReopenBtn').classList.add('hidden');
        }
        
        function showSetupTab(tabName) {
            // Alle Tabs deaktivieren
            document.querySelectorAll('.setup-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.setup-tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Aktiven Tab aktivieren
            event.target.classList.add('active');
            document.getElementById('setup-' + tabName).classList.add('active');
        }
        
        async function detectLocalIP() {
            try {
                // Methode 1: WebRTC
                const pc = new RTCPeerConnection({iceServers: []});
                pc.createDataChannel('');
                
                pc.createOffer().then(offer => pc.setLocalDescription(offer));
                
                pc.onicecandidate = (ice) => {
                    if (!ice || !ice.candidate || !ice.candidate.candidate) return;
                    
                    const ipRegex = /([0-9]{1,3}(\.[0-9]{1,3}){3})/;
                    const ipMatch = ipRegex.exec(ice.candidate.candidate);
                    
                    if (ipMatch && ipMatch[1]) {
                        const ip = ipMatch[1];
                        // Nur lokale IPs (192.168.x.x oder 10.x.x.x)
                        if (ip.startsWith('192.168.') || ip.startsWith('10.')) {
                            detectedLocalIP = ip;
                            updateIPDisplay(ip);
                            pc.close();
                        }
                    }
                };
                
                // Fallback nach 3 Sekunden
                setTimeout(() => {
                    if (!detectedLocalIP) {
                        updateIPDisplay('192.168.1.100');
                        showToast('‚ÑπÔ∏è IP konnte nicht automatisch erkannt werden. Bitte manuell pr√ºfen!', 'info');
                    }
                }, 3000);
                
            } catch (error) {
                console.error('IP-Erkennung fehlgeschlagen:', error);
                updateIPDisplay('192.168.1.100');
            }
        }
        
        function updateIPDisplay(ip) {
            // Aktualisiere alle IP-Anzeigen
            document.getElementById('detectedIP').textContent = ip;
            if (document.getElementById('detectedIP-mac')) {
                document.getElementById('detectedIP-mac').textContent = ip;
            }
            if (document.getElementById('detectedIP-linux')) {
                document.getElementById('detectedIP-linux').textContent = ip;
            }
            
            // Aktualisiere mkcert-Befehle
            const mkcertCmd = `mkcert localhost ${ip} 127.0.0.1 ::1`;
            document.getElementById('mkcertCommand').innerHTML = 
                mkcertCmd + `<button class="setup-copy-btn" onclick="copyToClipboard(this, '${mkcertCmd}')">üìã Kopieren</button>`;
            
            if (document.getElementById('mkcertCommandMac')) {
                document.getElementById('mkcertCommandMac').innerHTML = 
                    mkcertCmd + `<button class="setup-copy-btn" onclick="copyToClipboard(this, '${mkcertCmd}')">üìã Kopieren</button>`;
            }
            if (document.getElementById('mkcertCommandLinux')) {
                document.getElementById('mkcertCommandLinux').innerHTML = 
                    mkcertCmd + `<button class="setup-copy-btn" onclick="copyToClipboard(this, '${mkcertCmd}')">üìã Kopieren</button>`;
            }
            
            // Aktualisiere Android-URL
            const androidUrl = `https://${ip}:8000/baustellenbericht_v1_10.html`;
            document.getElementById('androidURL').textContent = androidUrl;
        }
        
        async function copyToClipboard(button, text) {
            try {
                await navigator.clipboard.writeText(text);
                const originalText = button.textContent;
                button.textContent = '‚úÖ Kopiert!';
                button.classList.add('copied');
                
                setTimeout(() => {
                    button.textContent = originalText;
                    button.classList.remove('copied');
                }, 2000);
                
                showToast('üìã In Zwischenablage kopiert!', 'success');
            } catch (error) {
                console.error('Kopieren fehlgeschlagen:', error);
                showToast('‚ùå Kopieren fehlgeschlagen. Bitte manuell kopieren.', 'error');
            }
        }
        
        function generateQRCode() {
            const ip = detectedLocalIP || '192.168.1.100';
            const url = `https://${ip}:8000/baustellenbericht_v1_10.html`;
            
            // Nutze Google Charts API f√ºr QR-Code
            const qrUrl = `https://chart.googleapis.com/chart?cht=qr&chs=200x200&chl=${encodeURIComponent(url)}`;
            
            const qrContainer = document.getElementById('qrCodeContainer');
            const qrCode = document.getElementById('qrCode');
            
            qrCode.innerHTML = `<img src="${qrUrl}" alt="QR Code">`;
            qrContainer.classList.remove('hidden');
            
            showToast('üì∑ QR-Code generiert! Jetzt mit Android-Kamera scannen.', 'success');
        }
        
        function testConnection() {
            const ip = detectedLocalIP || '192.168.1.100';
            const testUrl = `https://${ip}:8000`;
            
            showToast('üì∑ Teste Verbindung zu ' + testUrl + ' ...', 'info');
            
            // √ñffne in neuem Tab
            window.open(testUrl, '_blank');
            
            setTimeout(() => {
                if (confirm('Hat die Verbindung funktioniert? (Keine Sicherheitswarnung?)')) {
                    showToast('üéâ Perfekt! Das Setup funktioniert!', 'success');
                    minimizeSetup();
                } else {
                    showToast('‚ùå Bitte folge den Setup-Schritten nochmal genau.', 'error');
                }
            }, 3000);
        }
    </script>
    
    <!-- SETUP ASSISTANT MODAL -->
    <div id="setupModal" class="setup-modal hidden">
        <div class="setup-content">
            <div class="setup-header">
                <button class="setup-minimize-btn" onclick="minimizeSetup()">‚àí</button>
                <h2>üîí HTTPS Setup-Assistent</h2>
                <p>Mikrofon, GPS und Kamera ben√∂tigen HTTPS</p>
            </div>
            
            <div class="setup-body">
                <!-- Warnung -->
                <div class="setup-warning">
                    <strong>‚ö†Ô∏è Aktuelle Verbindung: UNSICHER</strong>
                    <span id="setupCurrentUrl"></span>
                </div>
                
                <!-- OS Tabs -->
                <div class="setup-tabs">
                    <button class="setup-tab active" onclick="showSetupTab('windows')">Windows</button>
                    <button class="setup-tab" onclick="showSetupTab('mac')">macOS</button>
                    <button class="setup-tab" onclick="showSetupTab('linux')">Linux</button>
                    <button class="setup-tab" onclick="showSetupTab('quick')">Schnelle Alternative</button>
                </div>
                
                <!-- WINDOWS TAB -->
                <div id="setup-windows" class="setup-tab-content active">
                    <!-- Schritt 1 -->
                    <div class="setup-step">
                        <div class="setup-step-header">
                            <div class="setup-step-number">1</div>
                            <div class="setup-step-title">mkcert installieren</div>
                        </div>
                        <div class="setup-step-content">
                            <p>PowerShell als Administrator √∂ffnen und ausf√ºhren:</p>
                            <div class="setup-command">choco install mkcert<button class="setup-copy-btn" onclick="copyToClipboard(this, 'choco install mkcert')">üìã Kopieren</button></div>
                            <div class="setup-info">
                                üí° <strong>Kein Chocolatey?</strong> Download: <a href="https://github.com/FiloSottile/mkcert/releases" target="_blank">github.com/FiloSottile/mkcert</a>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Schritt 2 -->
                    <div class="setup-step">
                        <div class="setup-step-header">
                            <div class="setup-step-number">2</div>
                            <div class="setup-step-title">Zertifikate erstellen</div>
                        </div>
                        <div class="setup-step-content">
                            <div class="setup-command">mkcert -install<button class="setup-copy-btn" onclick="copyToClipboard(this, 'mkcert -install')">üìã Kopieren</button></div>
                            <p style="margin: 15px 0;">Deine lokale IP-Adresse:</p>
                            <div class="setup-ip-box">
                                <strong>üìç Deine IP (automatisch erkannt):</strong>
                                <div class="ip-address" id="detectedIP">Wird erkannt...</div>
                            </div>
                            <p style="margin: 10px 0;">Zertifikat erstellen (mit deiner IP):</p>
                            <div class="setup-command" id="mkcertCommand">mkcert localhost 192.168.1.100 127.0.0.1 ::1<button class="setup-copy-btn" onclick="copyToClipboard(this, document.getElementById('mkcertCommand').textContent.trim())">üìã Kopieren</button></div>
                        </div>
                    </div>
                    
                    <!-- Schritt 3 -->
                    <div class="setup-step">
                        <div class="setup-step-header">
                            <div class="setup-step-number">3</div>
                            <div class="setup-step-title">HTTPS-Server starten</div>
                        </div>
                        <div class="setup-step-content">
                            <p>http-server installieren (einmalig):</p>
                            <div class="setup-command">npm install -g http-server<button class="setup-copy-btn" onclick="copyToClipboard(this, 'npm install -g http-server')">üìã Kopieren</button></div>
                            <p style="margin: 15px 0;">Server starten (im Projekt-Ordner):</p>
                            <div class="setup-command">http-server -S -C localhost+3.pem -K localhost+3-key.pem -p 8000 -c-1<button class="setup-copy-btn" onclick="copyToClipboard(this, 'http-server -S -C localhost+3.pem -K localhost+3-key.pem -p 8000 -c-1')">üìã Kopieren</button></div>
                            <p style="margin: 15px 0;">Firewall-Regel hinzuf√ºgen:</p>
                            <div class="setup-command">netsh advfirewall firewall add rule name="HTTP Server 8000" dir=in action=allow protocol=TCP localport=8000<button class="setup-copy-btn" onclick="copyToClipboard(this, 'netsh advfirewall firewall add rule name=\"HTTP Server 8000\" dir=in action=allow protocol=TCP localport=8000')">üìã Kopieren</button></div>
                        </div>
                    </div>
                    
                    <!-- Schritt 4 -->
                    <div class="setup-step">
                        <div class="setup-step-header">
                            <div class="setup-step-number">4</div>
                            <div class="setup-step-title">Auf Android installieren</div>
                        </div>
                        <div class="setup-step-content">
                            <p>Root-CA auf Android √ºbertragen:</p>
                            <div class="setup-command">mkcert -CAROOT<button class="setup-copy-btn" onclick="copyToClipboard(this, 'mkcert -CAROOT')">üìã Kopieren</button></div>
                            <div class="setup-info">
                                <strong>Datei rootCA.pem finden und per USB/Email/Cloud auf Android √ºbertragen</strong><br>
                                Dann: Einstellungen ‚Üí Sicherheit ‚Üí Verschl√ºsselung & Anmeldedaten ‚Üí CA-Zertifikat installieren
                            </div>
                        </div>
                    </div>
                    
                    <!-- Schritt 5 -->
                    <div class="setup-step">
                        <div class="setup-step-header">
                            <div class="setup-step-number">5</div>
                            <div class="setup-step-title">Auf Android √∂ffnen</div>
                        </div>
                        <div class="setup-step-content">
                            <div class="setup-ip-box">
                                <strong>üì± √ñffne auf Android:</strong>
                                <div class="ip-address" id="androidURL">https://192.168.1.100:8000</div>
                            </div>
                            <div id="qrCodeContainer" class="setup-qr hidden">
                                <p><strong>üì∑ QR-Code scannen:</strong></p>
                                <div id="qrCode"></div>
                            </div>
                            <button class="setup-btn setup-btn-primary" onclick="generateQRCode()" style="width: 100%;">
                                üì∑ QR-Code generieren
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- MAC TAB -->
                <div id="setup-mac" class="setup-tab-content">
                    <div class="setup-step">
                        <div class="setup-step-header">
                            <div class="setup-step-number">1</div>
                            <div class="setup-step-title">mkcert installieren</div>
                        </div>
                        <div class="setup-step-content">
                            <div class="setup-command">brew install mkcert<button class="setup-copy-btn" onclick="copyToClipboard(this, 'brew install mkcert')">üìã Kopieren</button></div>
                        </div>
                    </div>
                    
                    <div class="setup-step">
                        <div class="setup-step-header">
                            <div class="setup-step-number">2</div>
                            <div class="setup-step-title">IP-Adresse herausfinden</div>
                        </div>
                        <div class="setup-step-content">
                            <div class="setup-command">ifconfig | grep "inet "<button class="setup-copy-btn" onclick="copyToClipboard(this, 'ifconfig | grep \"inet \"')">üìã Kopieren</button></div>
                            <div class="setup-ip-box">
                                <strong>üìç Automatisch erkannt:</strong>
                                <div class="ip-address" id="detectedIP-mac">Wird erkannt...</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="setup-step">
                        <div class="setup-step-header">
                            <div class="setup-step-number">3</div>
                            <div class="setup-step-title">Zertifikate erstellen</div>
                        </div>
                        <div class="setup-step-content">
                            <div class="setup-command">mkcert -install<button class="setup-copy-btn" onclick="copyToClipboard(this, 'mkcert -install')">üìã Kopieren</button></div>
                            <div class="setup-command" id="mkcertCommandMac">mkcert localhost 192.168.1.100 127.0.0.1 ::1<button class="setup-copy-btn" onclick="copyToClipboard(this, document.getElementById('mkcertCommandMac').textContent.trim())">üìã Kopieren</button></div>
                        </div>
                    </div>
                    
                    <div class="setup-step">
                        <div class="setup-step-header">
                            <div class="setup-step-number">4</div>
                            <div class="setup-step-title">Server starten</div>
                        </div>
                        <div class="setup-step-content">
                            <div class="setup-command">npm install -g http-server<button class="setup-copy-btn" onclick="copyToClipboard(this, 'npm install -g http-server')">üìã Kopieren</button></div>
                            <div class="setup-command">http-server -S -C localhost+3.pem -K localhost+3-key.pem -p 8000 -c-1<button class="setup-copy-btn" onclick="copyToClipboard(this, 'http-server -S -C localhost+3.pem -K localhost+3-key.pem -p 8000 -c-1')">üìã Kopieren</button></div>
                        </div>
                    </div>
                    
                    <p style="margin-top: 20px;"><strong>Dann Schritte 4-5 von Windows-Tab folgen f√ºr Android-Installation</strong></p>
                </div>
                
                <!-- LINUX TAB -->
                <div id="setup-linux" class="setup-tab-content">
                    <div class="setup-step">
                        <div class="setup-step-header">
                            <div class="setup-step-number">1</div>
                            <div class="setup-step-title">mkcert installieren</div>
                        </div>
                        <div class="setup-step-content">
                            <div class="setup-command">sudo apt install libnss3-tools
wget https://github.com/FiloSottile/mkcert/releases/latest/download/mkcert-v1.4.4-linux-amd64
chmod +x mkcert-v1.4.4-linux-amd64
sudo mv mkcert-v1.4.4-linux-amd64 /usr/local/bin/mkcert<button class="setup-copy-btn" onclick="copyToClipboard(this, 'sudo apt install libnss3-tools\nwget https://github.com/FiloSottile/mkcert/releases/latest/download/mkcert-v1.4.4-linux-amd64\nchmod +x mkcert-v1.4.4-linux-amd64\nsudo mv mkcert-v1.4.4-linux-amd64 /usr/local/bin/mkcert')">üìã Kopieren</button></div>
                        </div>
                    </div>
                    
                    <div class="setup-step">
                        <div class="setup-step-header">
                            <div class="setup-step-number">2</div>
                            <div class="setup-step-title">IP-Adresse herausfinden</div>
                        </div>
                        <div class="setup-step-content">
                            <div class="setup-command">hostname -I<button class="setup-copy-btn" onclick="copyToClipboard(this, 'hostname -I')">üìã Kopieren</button></div>
                            <div class="setup-ip-box">
                                <strong>üìç Automatisch erkannt:</strong>
                                <div class="ip-address" id="detectedIP-linux">Wird erkannt...</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="setup-step">
                        <div class="setup-step-header">
                            <div class="setup-step-number">3</div>
                            <div class="setup-step-title">Zertifikate erstellen</div>
                        </div>
                        <div class="setup-step-content">
                            <div class="setup-command">mkcert -install<button class="setup-copy-btn" onclick="copyToClipboard(this, 'mkcert -install')">üìã Kopieren</button></div>
                            <div class="setup-command" id="mkcertCommandLinux">mkcert localhost 192.168.1.100 127.0.0.1 ::1<button class="setup-copy-btn" onclick="copyToClipboard(this, document.getElementById('mkcertCommandLinux').textContent.trim())">üìã Kopieren</button></div>
                        </div>
                    </div>
                    
                    <div class="setup-step">
                        <div class="setup-step-header">
                            <div class="setup-step-number">4</div>
                            <div class="setup-step-title">Server starten</div>
                        </div>
                        <div class="setup-step-content">
                            <div class="setup-command">npm install -g http-server<button class="setup-copy-btn" onclick="copyToClipboard(this, 'npm install -g http-server')">üìã Kopieren</button></div>
                            <div class="setup-command">http-server -S -C localhost+3.pem -K localhost+3-key.pem -p 8000 -c-1<button class="setup-copy-btn" onclick="copyToClipboard(this, 'http-server -S -C localhost+3.pem -K localhost+3-key.pem -p 8000 -c-1')">üìã Kopieren</button></div>
                        </div>
                    </div>
                    
                    <p style="margin-top: 20px;"><strong>Dann Schritte 4-5 von Windows-Tab folgen f√ºr Android-Installation</strong></p>
                </div>
                
                <!-- QUICK TAB -->
                <div id="setup-quick" class="setup-tab-content">
                    <div class="setup-file-note">
                        <strong>üí° Schnellste L√∂sung: file:// Protokoll</strong><br>
                        Die App kann auch direkt vom Ger√§t-Speicher ge√∂ffnet werden!
                    </div>
                    
                    <div class="setup-step">
                        <div class="setup-step-header">
                            <div class="setup-step-number">1</div>
                            <div class="setup-step-title">Datei auf Android √ºbertragen</div>
                        </div>
                        <div class="setup-step-content">
                            <p>√úbertrage <code>baustellenbericht_v1_10.html</code> auf dein Android-Ger√§t:</p>
                            <ul style="margin: 10px 0; padding-left: 20px;">
                                <li>Per USB-Kabel in Download-Ordner</li>
                                <li>Per Email als Anhang</li>
                                <li>Via Google Drive / Dropbox</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="setup-step">
                        <div class="setup-step-header">
                            <div class="setup-step-number">2</div>
                            <div class="setup-step-title">Datei √∂ffnen</div>
                        </div>
                        <div class="setup-step-content">
                            <p>√ñffne die Datei in Chrome:</p>
                            <div class="setup-info">
                                Datei-Manager ‚Üí Downloads ‚Üí baustellenbericht_v1_10.html ‚Üí Mit Chrome √∂ffnen
                            </div>
                            <div class="setup-success">
                                ‚úÖ Mikrofon, GPS und Kamera funktionieren √ºber file://!
                            </div>
                        </div>
                    </div>
                    
                    <div class="setup-step">
                        <div class="setup-step-header">
                            <div class="setup-step-number">3</div>
                            <div class="setup-step-title">Einschr√§nkungen beachten</div>
                        </div>
                        <div class="setup-step-content">
                            <p>‚ö†Ô∏è √úber file:// funktioniert NICHT:</p>
                            <ul style="margin: 10px 0; padding-left: 20px;">
                                <li>Service Worker (Offline-Modus)</li>
                                <li>PWA-Installation</li>
                                <li>Einige Browser-Caching-Features</li>
                            </ul>
                            <p><strong>Aber:</strong> Alle Hauptfunktionen (Mikrofon, GPS, Kamera, PDF-Export) funktionieren! ‚úÖ</p>
                        </div>
                    </div>
                    
                    <hr style="margin: 20px 0;">
                    
                    <div class="setup-file-note" style="background: #e0f2fe; border-color: #0ea5e9;">
                        <strong>üöÄ Alternative: ngrok (f√ºr schnelles Testing)</strong><br>
                        Kein mkcert-Setup n√∂tig, funktioniert sofort!
                    </div>
                    
                    <div class="setup-step">
                        <div class="setup-step-header">
                            <div class="setup-step-number">A</div>
                            <div class="setup-step-title">ngrok installieren</div>
                        </div>
                        <div class="setup-step-content">
                            <p>Download: <a href="https://ngrok.com/download" target="_blank">ngrok.com/download</a></p>
                            <div class="setup-command">ngrok authtoken DEIN_TOKEN<button class="setup-copy-btn" onclick="copyToClipboard(this, 'ngrok authtoken DEIN_TOKEN')">üìã Kopieren</button></div>
                        </div>
                    </div>
                    
                    <div class="setup-step">
                        <div class="setup-step-header">
                            <div class="setup-step-number">B</div>
                            <div class="setup-step-title">Server starten</div>
                        </div>
                        <div class="setup-step-content">
                            <div class="setup-command">python -m http.server 8000<button class="setup-copy-btn" onclick="copyToClipboard(this, 'python -m http.server 8000')">üìã Kopieren</button></div>
                            <p style="margin: 10px 0;">In anderem Terminal:</p>
                            <div class="setup-command">ngrok http 8000<button class="setup-copy-btn" onclick="copyToClipboard(this, 'ngrok http 8000')">üìã Kopieren</button></div>
                            <div class="setup-success">
                                ‚úÖ ngrok gibt dir eine https:// URL die von √ºberall funktioniert!
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Actions -->
                <div class="setup-actions">
                    <button class="setup-btn setup-btn-secondary" onclick="minimizeSetup()">Sp√§ter einrichten</button>
                    <button class="setup-btn setup-btn-primary" onclick="testConnection()">‚úÖ Verbindung testen</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- REOPEN BUTTON -->
    <button id="setupReopenBtn" class="setup-reopen-btn hidden" onclick="reopenSetup()">
        ‚ö†Ô∏è HTTPS Setup
    </button>
    
    <!-- v1.15: QR-SCANNER OVERLAY -->
    <div id="qrScannerOverlay" class="qr-scanner-overlay" style="display: none;">
        <div class="scanner-header">
            <div class="scanner-title">üì∑ QR-Code Scanner</div>
            <div class="scanner-instructions">Halte den QR-Code in den gr√ºnen Rahmen</div>
        </div>
        <div class="scanner-video-container">
            <video id="qrVideo" autoplay playsinline></video>
            <canvas id="qrCanvas" style="display: none;"></canvas>
            <div class="scanner-target-box">
                <div class="scanner-corners">
                    <div class="corner top-left"></div>
                    <div class="corner top-right"></div>
                    <div class="corner bottom-left"></div>
                    <div class="corner bottom-right"></div>
                </div>
            </div>
        </div>
        <div id="scannerStatus" class="scanner-status">üì∑ Suche nach QR-Code...</div>
        <div class="scanner-buttons">
            <button class="btn-scanner btn-scanner-close" onclick="stopQRScanner()">‚ùå Abbrechen</button>
        </div>
    </div>
    
    <!-- v1.14/v1.15: HTTPS SETUP MODAL -->
    <div id="httpsSetupModal" class="https-setup-modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">üîí HTTPS SETUP-ANLEITUNG</div>
                <div class="modal-subtitle">GPS & Spracheingabe auf Android Chrome aktivieren</div>
            </div>
            <div class="modal-body">
                <!-- ANDROID QUICK FIX -->
                <div class="setup-section">
                    <div class="setup-section-title">
                        üì± F√úR ANDROID: SCHNELLSTE L√ñSUNG
                        <span class="setup-section-time">‚ö° 1 Minute</span>
                    </div>
                    <div class="setup-steps">
                        <div class="setup-step">
                            <span class="setup-step-number">1</span>
                            App-Datei auf Handy √ºbertragen (USB, WhatsApp, etc.)
                        </div>
                        <div class="setup-step">
                            <span class="setup-step-number">2</span>
                            Mit Chrome √∂ffnen: <code>file:///storage/emulated/0/Download/baustellenbericht_v1_15.html</code>
                        </div>
                        <div class="setup-step">
                            <span class="setup-step-number">3</span>
                            ‚úÖ GPS & Sprache funktionieren sofort!
                        </div>
                    </div>
                    <div class="setup-note">
                        <strong>üí° Tipp:</strong> Lesezeichen erstellen f√ºr schnellen Zugriff!
                    </div>
                </div>
                
                <!-- NGROK -->
                <div class="setup-section">
                    <div class="setup-section-title">
                        üöÄ OPTION 1: NGROK
                        <span class="setup-section-time">‚è±Ô∏è 5 Minuten</span>
                    </div>
                    <div class="setup-steps">
                        <div class="setup-step">
                            <span class="setup-step-number">1</span>
                            ngrok installieren: <a href="https://ngrok.com/download" target="_blank">https://ngrok.com/download</a>
                        </div>
                        <div class="setup-step">
                            <span class="setup-step-number">2</span>
                            Python-Server starten:
                            <div class="setup-code">python -m http.server 8000</div>
                        </div>
                        <div class="setup-step">
                            <span class="setup-step-number">3</span>
                            ngrok starten (neues Terminal):
                            <div class="setup-code">ngrok http 8000</div>
                        </div>
                        <div class="setup-step">
                            <span class="setup-step-number">4</span>
                            URL am Handy √∂ffnen: <code>https://abc123.ngrok-free.app/baustellenbericht_v1_15.html</code>
                        </div>
                    </div>
                    <div class="setup-note">
                        <strong>‚úÖ Vorteil:</strong> Sofort verf√ºgbar, keine Account-Erstellung n√∂tig
                    </div>
                </div>
                
                <!-- GITHUB PAGES -->
                <div class="setup-section">
                    <div class="setup-section-title">
                        üì¶ OPTION 2: GITHUB PAGES
                        <span class="setup-section-time">‚è±Ô∏è 10 Minuten</span>
                    </div>
                    <div class="setup-steps">
                        <div class="setup-step">
                            <span class="setup-step-number">1</span>
                            GitHub Account erstellen (kostenlos): <a href="https://github.com" target="_blank">github.com</a>
                        </div>
                        <div class="setup-step">
                            <span class="setup-step-number">2</span>
                            Neues Repository: "baustellenbericht"
                        </div>
                        <div class="setup-step">
                            <span class="setup-step-number">3</span>
                            Datei hochladen (baustellenbericht_v1_15.html)
                        </div>
                        <div class="setup-step">
                            <span class="setup-step-number">4</span>
                            Settings ‚Üí Pages ‚Üí Source: main branch ‚Üí Save
                        </div>
                        <div class="setup-step">
                            <span class="setup-step-number">5</span>
                            URL: <code>https://DEIN-USERNAME.github.io/baustellenbericht/</code>
                        </div>
                    </div>
                    <div class="setup-note">
                        <strong>‚úÖ Vorteil:</strong> Permanent verf√ºgbar, kostenlos, keine laufenden Kosten
                    </div>
                </div>
                
                <!-- MKCERT -->
                <div class="setup-section">
                    <div class="setup-section-title">
                        ‚öô OPTION 3: MKCERT (F√úR ENTWICKLUNG)
                        <span class="setup-section-time">‚è±Ô∏è 15 Minuten</span>
                    </div>
                    <div class="setup-steps">
                        <div class="setup-step">
                            <span class="setup-step-number">1</span>
                            mkcert installieren:
                            <div class="setup-code"># Windows
choco install mkcert

# Mac
brew install mkcert</div>
                        </div>
                        <div class="setup-step">
                            <span class="setup-step-number">2</span>
                            Root CA installieren:
                            <div class="setup-code">mkcert -install</div>
                        </div>
                        <div class="setup-step">
                            <span class="setup-step-number">3</span>
                            Zertifikat erstellen:
                            <div class="setup-code">mkcert localhost 127.0.0.1 192.168.1.XXX</div>
                        </div>
                        <div class="setup-step">
                            <span class="setup-step-number">4</span>
                            HTTPS-Server starten:
                            <div class="setup-code">python -m http.server 8000 \
  --cert localhost+2.pem \
  --key localhost+2-key.pem</div>
                        </div>
                        <div class="setup-step">
                            <span class="setup-step-number">5</span>
                            √ñffnen: <code>https://192.168.1.XXX:8000</code>
                        </div>
                    </div>
                    <div class="setup-note">
                        <strong>‚ö†Ô∏è Hinweis:</strong> Nur f√ºr lokale Entwicklung, Zertifikat auf Handy installieren n√∂tig
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-modal btn-modal-close" onclick="closeHTTPSSetupModal()">Schlie√üen</button>
            </div>
        </div>
    </div>
    
    <!-- ===== v2.0: CAPACITOR NATIVE APP INTEGRATION ===== -->
    <script>
        // ===== v2.0: CAPACITOR INTEGRATION =====
        // Dieser Block erweitert die bestehenden Funktionen f√ºr Native-App-Nutzung
        
        (function() {
            'use strict';
            
            // Warte auf DOM und pr√ºfe dann Capacitor
            document.addEventListener('DOMContentLoaded', function() {
                // Timeout um sicherzustellen dass Capacitor geladen ist
                setTimeout(initCapacitorFeatures, 500);
            });
            
            async function initCapacitorFeatures() {
                const isNative = typeof window.Capacitor !== 'undefined' && 
                                 window.Capacitor.isNativePlatform && 
                                 window.Capacitor.isNativePlatform();
                
                console.log('üöÄ v2.0 Capacitor Init:', isNative ? 'NATIVE APP' : 'BROWSER');
                
                if (!isNative) {
                    // Browser-Modus: Zeige Status-Banner wenn nicht sicher
                    showBrowserStatusBanner();
                    return;
                }
                
                // === NATIVE APP MODUS ===
                console.log('üì± Native App erkannt - Aktiviere erweiterte Features');
                
                // Status-Banner aktualisieren
                showNativeAppBanner();
                
                // Alle Berechtigungen automatisch anfordern
                await requestAllPermissions();
            }
            
            // === BROWSER STATUS BANNER ===
            function showBrowserStatusBanner() {
                const protocol = browserCaps.protocol;
                
                // Nur Banner zeigen wenn nicht sicher
                if (protocol.secure) {
                    console.log('‚úÖ Sicherer Kontext - alle Features verf√ºgbar');
                    return;
                }
                
                // Warning Banner erstellen
                const banner = document.createElement('div');
                banner.id = 'v2StatusBanner';
                banner.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
                    color: white;
                    padding: 12px 20px;
                    text-align: center;
                    z-index: 10000;
                    font-family: Arial, sans-serif;
                    box-shadow: 0 2px 10px rgba(0,0,0,0.3);
                `;
                
                banner.innerHTML = `
                    <div style="max-width: 900px; margin: 0 auto;">
                        <strong>${protocol.icon} ${protocol.name}</strong>
                        <span style="margin-left: 10px;">${protocol.message}</span>
                        ${protocol.solution ? `<br><span style="font-size: 12px; opacity: 0.9;">${protocol.solution}</span>` : ''}
                        <button onclick="this.parentElement.parentElement.remove()" 
                                style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); 
                                       background: none; border: none; color: white; font-size: 20px; cursor: pointer;">
                            ‚úï
                        </button>
                    </div>
                `;
                
                document.body.insertBefore(banner, document.body.firstChild);
                
                // Body-Padding anpassen
                document.body.style.paddingTop = (banner.offsetHeight + 20) + 'px';
            }
            
            // === NATIVE APP BANNER ===
            function showNativeAppBanner() {
                const banner = document.createElement('div');
                banner.id = 'v2StatusBanner';
                banner.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
                    color: white;
                    padding: 8px 20px;
                    text-align: center;
                    z-index: 10000;
                    font-family: Arial, sans-serif;
                    box-shadow: 0 2px 10px rgba(0,0,0,0.3);
                `;
                
                banner.innerHTML = `
                    <div style="max-width: 900px; margin: 0 auto;">
                        <strong>üì± Native App</strong>
                        <span style="margin-left: 10px;">‚úÖ Alle Funktionen verf√ºgbar!</span>
                        <button onclick="this.parentElement.parentElement.style.display='none'; document.body.style.paddingTop='20px';" 
                                style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); 
                                       background: none; border: none; color: white; font-size: 16px; cursor: pointer;">
                            ‚úï
                        </button>
                    </div>
                `;
                
                document.body.insertBefore(banner, document.body.firstChild);
                document.body.style.paddingTop = (banner.offsetHeight + 20) + 'px';
                
                // Auto-hide nach 3 Sekunden
                setTimeout(() => {
                    if (banner.parentElement) {
                        banner.style.transition = 'opacity 0.5s';
                        banner.style.opacity = '0';
                        setTimeout(() => {
                            banner.remove();
                            document.body.style.paddingTop = '20px';
                        }, 500);
                    }
                }, 3000);
            }
            
            // === ALLE BERECHTIGUNGEN ANFORDERN ===
            async function requestAllPermissions() {
                console.log('üîê Fordere alle Berechtigungen an...');
                
                const results = {
                    gps: 'pending',
                    camera: 'pending',
                    microphone: 'pending'
                };
                
                // GPS Permission
                if (window.Capacitor.Plugins.Geolocation) {
                    try {
                        const gpsStatus = await window.Capacitor.Plugins.Geolocation.requestPermissions();
                        results.gps = gpsStatus.location;
                        console.log('üìç GPS Permission:', results.gps);
                    } catch (e) {
                        console.error('GPS Permission Error:', e);
                        results.gps = 'error';
                    }
                }
                
                // Camera Permission (wenn Plugin verf√ºgbar)
                if (window.Capacitor.Plugins.Camera) {
                    try {
                        const camStatus = await window.Capacitor.Plugins.Camera.requestPermissions();
                        results.camera = camStatus.camera;
                        console.log('üì∑ Camera Permission:', results.camera);
                    } catch (e) {
                        console.error('Camera Permission Error:', e);
                        results.camera = 'error';
                    }
                }
                
                // Speech Recognition Permission (Community Plugin)
                if (window.Capacitor.Plugins.SpeechRecognition) {
                    try {
                        const speechStatus = await window.Capacitor.Plugins.SpeechRecognition.requestPermissions();
                        results.microphone = speechStatus.speechRecognition;
                        console.log('üé§ Speech Permission:', results.microphone);
                    } catch (e) {
                        console.error('Speech Permission Error:', e);
                        results.microphone = 'error';
                    }
                }
                
                console.log('üîê Permission Results:', results);
                
                // Zeige Toast mit Ergebnis
                const granted = Object.values(results).filter(r => r === 'granted').length;
                const total = Object.values(results).filter(r => r !== 'pending').length;
                
                if (granted === total && total > 0) {
                    showToast(`‚úÖ Alle ${granted} Berechtigungen erteilt!`, 'success');
                } else if (granted > 0) {
                    showToast(`‚ö†Ô∏è ${granted}/${total} Berechtigungen erteilt`, 'info');
                }
                
                return results;
            }
            
            // === NATIVE GPS FUNKTION (Override) ===
            // Diese Funktion wird aufgerufen wenn Capacitor GPS Plugin verf√ºgbar ist
            window.getGPSNative = async function() {
                if (!window.Capacitor || !window.Capacitor.Plugins.Geolocation) {
                    console.log('‚ùå Capacitor Geolocation Plugin nicht verf√ºgbar');
                    return null;
                }
                
                try {
                    // Permission anfordern falls noch nicht erteilt
                    await window.Capacitor.Plugins.Geolocation.requestPermissions();
                    
                    // Position holen
                    const position = await window.Capacitor.Plugins.Geolocation.getCurrentPosition({
                        enableHighAccuracy: true,
                        timeout: 20000,
                        maximumAge: 0
                    });
                    
                    return {
                        lat: position.coords.latitude,
                        lon: position.coords.longitude,
                        accuracy: position.coords.accuracy,
                        source: 'native'
                    };
                } catch (error) {
                    console.error('‚ùå Native GPS Error:', error);
                    return null;
                }
            };
            
            // === NATIVE SPEECH RECOGNITION (Override) ===
            window.startSpeechNative = async function(callback) {
                if (!window.Capacitor || !window.Capacitor.Plugins.SpeechRecognition) {
                    console.log('‚ùå Capacitor Speech Recognition Plugin nicht verf√ºgbar');
                    return false;
                }
                
                try {
                    // Permission anfordern
                    const permStatus = await window.Capacitor.Plugins.SpeechRecognition.requestPermissions();
                    
                    if (permStatus.speechRecognition !== 'granted') {
                        showToast('‚ö†Ô∏è Mikrofon-Berechtigung ben√∂tigt', 'error');
                        return false;
                    }
                    
                    // Verf√ºgbarkeit pr√ºfen
                    const available = await window.Capacitor.Plugins.SpeechRecognition.available();
                    if (!available.available) {
                        showToast('‚ö†Ô∏è Spracherkennung nicht verf√ºgbar auf diesem Ger√§t', 'error');
                        return false;
                    }
                    
                    showToast('üé§ Sprechen Sie jetzt...', 'success');
                    
                    // Listener f√ºr Ergebnisse
                    await window.Capacitor.Plugins.SpeechRecognition.addListener('partialResults', (data) => {
                        if (data.matches && data.matches.length > 0) {
                            callback(data.matches[0]);
                        }
                    });
                    
                    // Starten
                    await window.Capacitor.Plugins.SpeechRecognition.start({
                        language: 'de-DE',
                        maxResults: 1,
                        popup: false,
                        partialResults: true
                    });
                    
                    return true;
                } catch (error) {
                    console.error('‚ùå Native Speech Error:', error);
                    showToast('‚ùå Spracherkennung fehlgeschlagen', 'error');
                    return false;
                }
            };
            
            window.stopSpeechNative = async function() {
                if (window.Capacitor && window.Capacitor.Plugins.SpeechRecognition) {
                    try {
                        await window.Capacitor.Plugins.SpeechRecognition.stop();
                    } catch (e) {
                        console.log('Speech stop error:', e);
                    }
                }
            };
            
            // === DEBUG INFO UPDATE ===
            // Aktualisiere Debug-Box f√ºr v2.0
            function updateDebugInfoV2() {
                const debugBox = document.getElementById('debugInfoBox');
                if (!debugBox) return;
                
                const isNative = browserCaps.isNativeApp;
                const protocol = browserCaps.protocol;
                
                // Finde die Debug-Elemente und aktualisiere sie
                const gpsEl = document.getElementById('debugGPS');
                const speechEl = document.getElementById('debugSpeech');
                
                if (isNative) {
                    if (gpsEl) gpsEl.textContent = '‚úÖ (Native)';
                    if (speechEl) speechEl.textContent = '‚úÖ (Native)';
                } else if (protocol.secure) {
                    if (gpsEl) gpsEl.textContent = '‚úÖ';
                    if (speechEl) speechEl.textContent = '‚úÖ';
                } else {
                    if (gpsEl) gpsEl.textContent = '‚ö†Ô∏è blockiert';
                    if (speechEl) speechEl.textContent = '‚ö†Ô∏è blockiert';
                }
            }
            
            // Debug-Info nach kurzer Verz√∂gerung aktualisieren
            setTimeout(updateDebugInfoV2, 1000);
            
        })();
        
        console.log('‚úÖ v3.3 Ultra-Mega-DB Alle Features geladen');
        
        // ===== V3.0 NEUE FUNKTIONEN =====
        
        // Stoppuhr-Variablen
        let stoppuhrRunning = false;
        let stoppuhrSeconds = 0;
        let stoppuhrInterval = null;
        
        // Stoppuhr starten/stoppen
        function toggleStoppuhr() {
            const btn = document.getElementById('stoppuhrStart');
            if (stoppuhrRunning) {
                // Stoppen
                clearInterval(stoppuhrInterval);
                stoppuhrRunning = false;
                btn.textContent = '‚ñ∂Ô∏è Start';
                btn.classList.remove('stop');
                btn.classList.add('start');
            } else {
                // Starten
                stoppuhrInterval = setInterval(() => {
                    stoppuhrSeconds++;
                    updateStoppuhrDisplay();
                }, 1000);
                stoppuhrRunning = true;
                btn.textContent = '‚èπÔ∏è Stop';
                btn.classList.remove('start');
                btn.classList.add('stop');
            }
        }
        
        function updateStoppuhrDisplay() {
            const h = Math.floor(stoppuhrSeconds / 3600);
            const m = Math.floor((stoppuhrSeconds % 3600) / 60);
            const s = stoppuhrSeconds % 60;
            document.getElementById('stoppuhrDisplay').textContent = 
                `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
        }
        
        function resetStoppuhr() {
            clearInterval(stoppuhrInterval);
            stoppuhrRunning = false;
            stoppuhrSeconds = 0;
            updateStoppuhrDisplay();
            const btn = document.getElementById('stoppuhrStart');
            btn.textContent = '‚ñ∂Ô∏è Start';
            btn.classList.remove('stop');
            btn.classList.add('start');
        }
        
        function stoppuhrUebernehmen() {
            const hours = (stoppuhrSeconds / 3600).toFixed(2);
            // Finde Arbeitszeit-Feld und f√ºlle es aus
            const stundenInput = document.getElementById('personalStunden');
            if (stundenInput) {
                stundenInput.value = hours;
                showToast(`‚è±Ô∏è ${hours} Stunden √ºbernommen!`, 'success');
            } else {
                showToast(`‚è±Ô∏è Gestoppte Zeit: ${hours} Stunden`, 'info');
            }
        }
        
        // Wetter laden
        async function loadWetter() {
            try {
                const lat = document.getElementById('gpsLat')?.value;
                const lon = document.getElementById('gpsLon')?.value;
                
                if (!lat || !lon) {
                    // Fallback: IP-basiert
                    const ipRes = await fetch('https://ipapi.co/json/');
                    const ipData = await ipRes.json();
                    updateWetterUI(ipData.city || 'Unbekannt', 15, 'Standort wird ermittelt...');
                    return;
                }
                
                // Open-Meteo API (kostenlos, kein API-Key)
                const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,weather_code`);
                const data = await res.json();
                
                const temp = Math.round(data.current.temperature_2m);
                const code = data.current.weather_code;
                const desc = getWetterBeschreibung(code);
                const icon = getWetterIcon(code);
                
                document.getElementById('wetterIcon').textContent = icon;
                document.getElementById('wetterTemp').textContent = temp + '¬∞C';
                document.getElementById('wetterDesc').textContent = desc;
                
                // Pr√ºfe auf Schlechtwetter
                if (code >= 61) { // Regen/Schnee
                    document.getElementById('wetterWidget').classList.add('wetter-warning');
                    document.getElementById('wetterDesc').textContent = '‚ö†Ô∏è ' + desc + ' - Schlechtwetter!';
                }
            } catch (e) {
                console.log('Wetter-Fehler:', e);
            }
        }
        
        function getWetterIcon(code) {
            if (code === 0) return '‚òÄÔ∏è';
            if (code <= 3) return 'üå§Ô∏è';
            if (code <= 48) return '‚òÅÔ∏è';
            if (code <= 57) return 'üåßÔ∏è';
            if (code <= 67) return 'üåßÔ∏è';
            if (code <= 77) return '‚ùÑÔ∏è';
            if (code <= 82) return 'üåßÔ∏è';
            if (code >= 95) return '‚õàÔ∏è';
            return 'üå§Ô∏è';
        }
        
        function getWetterBeschreibung(code) {
            if (code === 0) return 'Klar';
            if (code <= 3) return 'Teilweise bew√∂lkt';
            if (code <= 48) return 'Bew√∂lkt/Nebel';
            if (code <= 57) return 'Nieselregen';
            if (code <= 67) return 'Regen';
            if (code <= 77) return 'Schnee';
            if (code <= 82) return 'Starkregen';
            if (code >= 95) return 'Gewitter';
            return 'Wechselhaft';
        }
        
        // Navigation zur Baustelle
        function navigateToBaustelle() {
            const lat = document.getElementById('gpsLat')?.value;
            const lon = document.getElementById('gpsLon')?.value;
            const baustelle = document.getElementById('baustelleHelper')?.value || '';
            
            if (lat && lon) {
                window.open(`https://www.google.com/maps/dir/?api=1&destination=${lat},${lon}`, '_blank');
            } else if (baustelle) {
                window.open(`https://www.google.com/maps/search/${encodeURIComponent(baustelle)}`, '_blank');
            } else {
                showToast('‚ùå Bitte erst GPS erfassen oder Baustelle eingeben', 'error');
            }
        }
        
        // Schnellfoto
        function schnellFoto() {
            document.getElementById('photoInput')?.click();
        }
        
        // B√ºro anrufen
        function callBuero() {
            window.location.href = 'tel:+4971123456789'; // Anpassen!
            showToast('üìû Rufe B√ºro an...', 'info');
        }
        
        // Abwesenheit melden
        function showAbwesenheit() {
            const choice = prompt('Abwesenheit melden:\\n1 = Urlaub\\n2 = Krank\\n3 = Schlechtwetter\\n4 = Feiertag');
            if (choice) {
                const types = ['', 'Urlaub', 'Krank', 'Schlechtwetter', 'Feiertag'];
                const type = types[parseInt(choice)] || 'Sonstige';
                
                // Speichere Abwesenheit
                const abwesenheiten = JSON.parse(localStorage.getItem('abwesenheiten') || '[]');
                abwesenheiten.push({
                    datum: new Date().toISOString().split('T')[0],
                    typ: type
                });
                localStorage.setItem('abwesenheiten', JSON.stringify(abwesenheiten));
                
                showToast(`üìù ${type} f√ºr heute eingetragen`, 'success');
            }
        }
        
        // Vorlagen
        function loadVorlage(vorlage) {
            if (!vorlage) return;
            
            const vorlagen = {
                'fliesen-standard': {
                    taetigkeiten: ['Fliesen verlegen', 'Fugenmasse aufbringen'],
                    material: ['Fliesen', 'Fliesenkleber', 'Fugenmasse'],
                    werkzeuge: ['Fliesenschneider', 'Zahnspachtel', 'Wasserwaage']
                },
                'fliesen-bad': {
                    taetigkeiten: ['Fliesen verlegen', 'Abdichtung', 'Fugenmasse aufbringen', 'Silikon'],
                    material: ['Fliesen', 'Fliesenkleber', 'Dichtfolie', 'Fugenmasse', 'Silikon'],
                    werkzeuge: ['Fliesenschneider', 'Zahnspachtel', 'Wasserwaage', 'Silikonpresse']
                },
                'fliesen-kueche': {
                    taetigkeiten: ['Fliesenspiegel setzen', 'Fliesen verlegen'],
                    material: ['Wandfliesen', 'Fliesenkleber', 'Fugenmasse'],
                    werkzeuge: ['Fliesenschneider', 'Zahnspachtel']
                },
                'fliesen-boden': {
                    taetigkeiten: ['Bodenfliesen verlegen', 'Nivellieren'],
                    material: ['Bodenfliesen', 'Flexkleber', 'Nivelliermasse'],
                    werkzeuge: ['Fliesenschneider', 'Nivelliersystem', 'Gummihammer']
                },
                'fliesen-wand': {
                    taetigkeiten: ['Wandfliesen verlegen'],
                    material: ['Wandfliesen', 'Fliesenkleber'],
                    werkzeuge: ['Fliesenschneider', 'Zahnspachtel', 'Wasserwaage']
                },
                'naturstein': {
                    taetigkeiten: ['Naturstein verlegen', 'Impr√§gnieren'],
                    material: ['Naturstein', 'Natursteinkleber', 'Impr√§gnierung'],
                    werkzeuge: ['Steintrennmaschine', 'Zahnspachtel']
                },
                'reparatur': {
                    taetigkeiten: ['Fliesen austauschen', 'Ausbesserung'],
                    material: ['Ersatzfliesen', 'Fliesenkleber', 'Fugenmasse'],
                    werkzeuge: ['Mei√üel', 'Hammer', 'Fliesenschneider']
                },
                'aufmass': {
                    taetigkeiten: ['Aufma√ü nehmen', 'Bestandsaufnahme'],
                    material: [],
                    werkzeuge: ['Laser-Entfernungsmesser', 'Zollstock']
                }
            };
            
            const v = vorlagen[vorlage];
            if (v) {
                showToast(`üìã Vorlage "${vorlage}" geladen!`, 'success');
                // Hier k√∂nnten die Werte in die Felder √ºbernommen werden
            }
            
            document.getElementById('vorlageSelect').value = '';
        }
        
        // Projekte verwalten
        function addProjekt() {
            const name = document.getElementById('newProjektName')?.value?.trim();
            const nr = document.getElementById('newProjektNr')?.value?.trim();
            
            if (!name) {
                showToast('‚ùå Bitte Projektname eingeben', 'error');
                return;
            }
            
            const projekte = JSON.parse(localStorage.getItem('projekte') || '[]');
            projekte.push({
                id: Date.now(),
                name: name,
                nr: nr || 'P-' + Date.now(),
                erstelltAm: new Date().toISOString(),
                aktiv: true
            });
            localStorage.setItem('projekte', JSON.stringify(projekte));
            
            document.getElementById('newProjektName').value = '';
            document.getElementById('newProjektNr').value = '';
            
            loadProjekte();
            showToast(`‚úÖ Projekt "${name}" angelegt!`, 'success');
        }
        
        function loadProjekte() {
            const container = document.getElementById('projektListe');
            if (!container) return;
            
            const projekte = JSON.parse(localStorage.getItem('projekte') || '[]');
            
            if (projekte.length === 0) {
                container.innerHTML = '<p style="color: #64748b; text-align: center; padding: 40px;">Noch keine Projekte angelegt.</p>';
                return;
            }
            
            container.innerHTML = projekte.map(p => `
                <div class="projekt-card ${p.aktiv ? 'aktiv' : ''}">
                    <div class="projekt-info">
                        <h4>${p.aktiv ? 'üèóÔ∏è' : '‚úÖ'} ${p.name}</h4>
                        <span>${p.nr} | Erstellt: ${new Date(p.erstelltAm).toLocaleDateString('de-DE')}</span>
                    </div>
                    <div class="projekt-actions">
                        <button onclick="selectProjekt('${p.id}')" style="background: #22c55e; color: white;">Ausw√§hlen</button>
                        <button onclick="deleteProjekt('${p.id}')" style="background: #ef4444; color: white;">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
        }
        
        function selectProjekt(id) {
            const projekte = JSON.parse(localStorage.getItem('projekte') || '[]');
            const projekt = projekte.find(p => p.id == id);
            if (projekt) {
                document.getElementById('projektnummerHelper').value = projekt.nr;
                document.getElementById('baustelleHelper').value = projekt.name;
                switchToTab('neu');
                showToast(`üìÅ Projekt "${projekt.name}" ausgew√§hlt`, 'success');
            }
        }
        
        function deleteProjekt(id) {
            if (!confirm('Projekt wirklich l√∂schen?')) return;
            let projekte = JSON.parse(localStorage.getItem('projekte') || '[]');
            projekte = projekte.filter(p => p.id != id);
            localStorage.setItem('projekte', JSON.stringify(projekte));
            loadProjekte();
            showToast('üóëÔ∏è Projekt gel√∂scht', 'info');
        }
        
        // Statistiken
        function loadStats(zeitraum) {
            // Button-Status aktualisieren
            document.querySelectorAll('.stats-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById('stats-' + zeitraum)?.classList.add('active');
            
            const berichte = JSON.parse(localStorage.getItem('baustellenberichte') || '[]');
            const now = new Date();
            
            // Zeitraum filtern
            let filtered = berichte;
            if (zeitraum === 'woche') {
                const weekAgo = new Date(now - 7 * 24 * 60 * 60 * 1000);
                filtered = berichte.filter(b => new Date(b.timestamp) >= weekAgo);
            } else if (zeitraum === 'monat') {
                filtered = berichte.filter(b => {
                    const d = new Date(b.timestamp);
                    return d.getMonth() === now.getMonth() && d.getFullYear() === now.getFullYear();
                });
            } else if (zeitraum === 'jahr') {
                filtered = berichte.filter(b => new Date(b.timestamp).getFullYear() === now.getFullYear());
            }
            
            // Statistiken berechnen
            let totalStunden = 0;
            let totalKm = 0;
            const baustellen = new Set();
            
            filtered.forEach(b => {
                // Versuche Stunden aus verschiedenen Feldern zu extrahieren
                const stunden = parseFloat(b.arbeitszeit || b.stunden || 0);
                totalStunden += isNaN(stunden) ? 0 : stunden;
                
                const km = parseFloat(b.km || 0);
                totalKm += isNaN(km) ? 0 : km;
                
                if (b.baustelle) baustellen.add(b.baustelle);
            });
            
            // UI aktualisieren
            document.getElementById('statStunden').textContent = totalStunden.toFixed(1);
            document.getElementById('statBerichte').textContent = filtered.length;
            document.getElementById('statProjekte').textContent = baustellen.size;
            document.getElementById('statKm').textContent = totalKm.toFixed(0);
            
            // Top Baustellen
            const baustellenStats = {};
            filtered.forEach(b => {
                if (b.baustelle) {
                    baustellenStats[b.baustelle] = (baustellenStats[b.baustelle] || 0) + parseFloat(b.stunden || 8);
                }
            });
            
            const topContainer = document.getElementById('topBaustellen');
            if (topContainer) {
                const sorted = Object.entries(baustellenStats).sort((a, b) => b[1] - a[1]).slice(0, 5);
                const maxHours = sorted[0]?.[1] || 1;
                
                topContainer.innerHTML = sorted.length ? sorted.map((item, i) => `
                    <div class="top-baustelle-bar">
                        <span class="rank">#${i + 1}</span>
                        <span class="name">${item[0]}</span>
                        <span class="hours">${item[1].toFixed(1)}h</span>
                        <div class="bar" style="width: ${(item[1] / maxHours * 100)}px;"></div>
                    </div>
                `).join('') : '<p style="color: #64748b;">Keine Daten vorhanden</p>';
            }
        }
        
        // Kalender
        let currentKalenderDate = new Date();
        
        function renderKalender() {
            const grid = document.getElementById('kalenderGrid');
            if (!grid) return;
            
            const year = currentKalenderDate.getFullYear();
            const month = currentKalenderDate.getMonth();
            
            // Monat-Anzeige aktualisieren
            const monthNames = ['Januar', 'Februar', 'M√§rz', 'April', 'Mai', 'Juni', 
                               'Juli', 'August', 'September', 'Oktober', 'November', 'Dezember'];
            document.getElementById('kalenderMonat').textContent = `${monthNames[month]} ${year}`;
            
            // Berichte f√ºr diesen Monat holen
            const berichte = JSON.parse(localStorage.getItem('baustellenberichte') || '[]');
            const berichtDaten = new Set();
            berichte.forEach(b => {
                const d = new Date(b.timestamp);
                if (d.getMonth() === month && d.getFullYear() === year) {
                    berichtDaten.add(d.getDate());
                }
            });
            
            // Kalender-Header (Wochentage)
            const weekDays = ['Mo', 'Di', 'Mi', 'Do', 'Fr', 'Sa', 'So'];
            let html = weekDays.map(d => `<div class="kalender-header">${d}</div>`).join('');
            
            // Erster Tag des Monats
            const firstDay = new Date(year, month, 1);
            let startDay = firstDay.getDay() - 1; // Montag = 0
            if (startDay < 0) startDay = 6;
            
            // Leere Felder vor dem 1.
            for (let i = 0; i < startDay; i++) {
                html += '<div class="kalender-tag leer"></div>';
            }
            
            // Tage des Monats
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const today = new Date();
            
            for (let day = 1; day <= daysInMonth; day++) {
                const isToday = day === today.getDate() && month === today.getMonth() && year === today.getFullYear();
                const hatBericht = berichtDaten.has(day);
                
                html += `<div class="kalender-tag ${isToday ? 'heute' : ''} ${hatBericht ? 'hat-bericht' : ''}" 
                         onclick="showKalenderTag(${year}, ${month}, ${day})">
                         ${day}
                         </div>`;
            }
            
            grid.innerHTML = html;
        }
        
        function changeMonth(delta) {
            currentKalenderDate.setMonth(currentKalenderDate.getMonth() + delta);
            renderKalender();
        }
        
        function showKalenderTag(year, month, day) {
            const berichte = JSON.parse(localStorage.getItem('baustellenberichte') || '[]');
            const tagesBerichte = berichte.filter(b => {
                const d = new Date(b.timestamp);
                return d.getDate() === day && d.getMonth() === month && d.getFullYear() === year;
            });
            
            if (tagesBerichte.length > 0) {
                alert(`${day}.${month + 1}.${year}:\\n${tagesBerichte.length} Bericht(e) vorhanden`);
            }
        }
        
        // Suche in Berichten
        function filterBerichte(query) {
            const container = document.getElementById('berichteListe');
            const berichte = JSON.parse(localStorage.getItem('baustellenberichte') || '[]');
            
            const filtered = query ? berichte.filter(b => {
                const searchStr = JSON.stringify(b).toLowerCase();
                return searchStr.includes(query.toLowerCase());
            }) : berichte;
            
            // Hier m√ºsste die existierende loadBerichteList-Funktion mit gefilterten Daten aufgerufen werden
            // F√ºr jetzt nur die Anzahl anzeigen
            if (query && filtered.length !== berichte.length) {
                showToast(`üîç ${filtered.length} von ${berichte.length} Berichten`, 'info');
            }
        }
        
        // Dark Mode
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('darkMode', isDark);
            document.querySelector('.dark-mode-toggle').textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
        }
        
        // Dark Mode beim Laden pr√ºfen
        if (localStorage.getItem('darkMode') === 'true') {
            document.body.classList.add('dark-mode');
        }
        
        // Tab-Switching erweitern f√ºr neue Tabs
        const originalSwitchToTab = window.switchToTab;
        window.switchToTab = function(tabName) {
            // Original-Funktion aufrufen wenn vorhanden
            if (typeof originalSwitchToTab === 'function') {
                originalSwitchToTab(tabName);
            }
            
            // Alle Tabs deaktivieren
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            // Aktiven Tab und Content aktivieren
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(t => {
                if (t.textContent.toLowerCase().includes(tabName.substring(0, 3)) || 
                    t.onclick?.toString().includes(tabName)) {
                    t.classList.add('active');
                }
            });
            
            const content = document.getElementById('tab-' + tabName);
            if (content) content.classList.add('active');
            
            // Spezielle Initialisierungen
            if (tabName === 'projekte') loadProjekte();
            if (tabName === 'statistiken') loadStats('monat');
            if (tabName === 'kalender') renderKalender();
        };
        
        // Beim Laden initialisieren
        document.addEventListener('DOMContentLoaded', function() {
            loadWetter();
            
            // Dark Mode Button
            if (!document.querySelector('.dark-mode-toggle')) {
                const btn = document.createElement('button');
                btn.className = 'dark-mode-toggle';
                btn.textContent = localStorage.getItem('darkMode') === 'true' ? '‚òÄÔ∏è' : 'üåô';
                btn.onclick = toggleDarkMode;
                document.body.appendChild(btn);
            }
        });
        
        // ===== v3.3 Ultra-Mega-DB: INTELLIGENTES TEXTVERBESSERUNGS-SYSTEM =====
        // Kombiniert: Gro√üe lokale Datenbank + Kostenlose KI (Puter.js) + Stundenerkennung
        
        // ===== RIESIGE LOKALE DATENBANK F√úR FLIESENLEGER =====
        // ===== ULTRA-MEGA-DATENBANK v3.3 =====
        // 648 Autokorrekturen + 599 Formulierungen
        const baustellenDatenbank = {
            
            // === AUTOKORREKTUR (648 Eintr√§ge) ===
            autokorrektur: {
                // --- Fliesen & Platten (80+) ---
                'fliessen': 'Fliesen', 'flie√üen': 'Fliesen', 'fliesen': 'Fliesen',
                'fliese': 'Fliese', 'flies': 'Fliese', 'fliesse': 'Fliese',
                'bodenfliessen': 'Bodenfliesen', 'bodenflie√üen': 'Bodenfliesen',
                'wandfliessen': 'Wandfliesen', 'wandflie√üen': 'Wandfliesen',
                'mosaikfliessen': 'Mosaikfliesen', 'mosaikflie√üen': 'Mosaikfliesen',
                'feinsteinzeug': 'Feinsteinzeug', 'feinstein': 'Feinsteinzeug',
                'steinzeug': 'Steinzeug', 'steingut': 'Steingut',
                'naturstein': 'Naturstein', 'natur stein': 'Naturstein',
                'marmor': 'Marmor', 'marmorplatte': 'Marmorplatte',
                'granit': 'Granit', 'granitplatte': 'Granitplatte',
                'schiefer': 'Schiefer', 'schieferplatte': 'Schieferplatte',
                'travertin': 'Travertin', 'travertinplatte': 'Travertinplatte',
                'terrakotta': 'Terrakotta', 'terracotta': 'Terrakotta',
                'cotto': 'Cotto', 'cottofliese': 'Cottofliese',
                'klinker': 'Klinker', 'klinkerfliese': 'Klinkerfliese',
                'spaltplatte': 'Spaltplatte', 'spaltplatten': 'Spaltplatten',
                'riemchen': 'Riemchen', 'klinkerriemchen': 'Klinkerriemchen',
                'gro√üformat': 'Gro√üformat', 'grossformat': 'Gro√üformat',
                'gro√üformatfliese': 'Gro√üformatfliese', 'xxl fliese': 'XXL-Fliese',
                'rektifiziert': 'rektifiziert', 'rectifiziert': 'rektifiziert',
                'kalibriert': 'kalibriert', 'kallibriert': 'kalibriert',
                'glasiert': 'glasiert', 'glasur': 'Glasur',
                'unglasiert': 'unglasiert', 'matt': 'matt',
                'poliert': 'poliert', 'gl√§nzend': 'gl√§nzend',
                'rutschhemmend': 'rutschhemmend', 'rutschfest': 'rutschfest',
                'r9': 'R9', 'r10': 'R10', 'r11': 'R11', 'r12': 'R12', 'r13': 'R13',
                'trittsicher': 'trittsicher', 'rutschklasse': 'Rutschklasse',
                'abriebklasse': 'Abriebklasse', 'pei': 'PEI',
                'frostfest': 'frostfest', 'frostsicher': 'frostsicher',
                'frostbest√§ndig': 'frostbest√§ndig', 'aussenbereich': 'Au√üenbereich',
                'innenbereich': 'Innenbereich', 'nasszelle': 'Nasszelle',
                'feuchtraum': 'Feuchtraum', 'nassraum': 'Nassraum',
                'sockel': 'Sockel', 'sockelfliese': 'Sockelfliese',
                'bord√ºre': 'Bord√ºre', 'borduere': 'Bord√ºre',
                'dekorfliese': 'Dekorfliese', 'dekor': 'Dekor',
                'einleger': 'Einleger', 'flieseneinleger': 'Flieseneinleger',
                'mosaik': 'Mosaik', 'mosaikplatte': 'Mosaikplatte',
                'glasmosaik': 'Glasmosaik', 'natursteinmosaik': 'Natursteinmosaik',
                'holzoptik': 'Holzoptik', 'holzfliese': 'Holzfliese',
                'betonoptik': 'Betonoptik', 'steinoptik': 'Steinoptik',
                'marmoroptik': 'Marmoroptik', 'schieferoptik': 'Schieferoptik',
                
                // --- Verlegung & Verlegetechniken (100+) ---
                'ferlegung': 'Verlegung', 'verlegund': 'Verlegung', 'verlegung': 'Verlegung',
                'ferlegt': 'verlegt', 'verlegt': 'verlegt', 'verleg': 'verlegt',
                'verlegen': 'verlegen', 'ferleg': 'verlegen',
                'd√ºnnbett': 'D√ºnnbett', 'd√ºnnbet': 'D√ºnnbett', 'duennbett': 'D√ºnnbett',
                'd√ºnnbettverfahren': 'D√ºnnbettverfahren', 'd√ºnnbettm√∂rtel': 'D√ºnnbettm√∂rtel',
                'mittelbett': 'Mittelbett', 'mittelbettverfahren': 'Mittelbettverfahren',
                'mittelbettm√∂rtel': 'Mittelbettm√∂rtel', 'mittelbet': 'Mittelbett',
                'dickbett': 'Dickbett', 'dickbettverfahren': 'Dickbettverfahren',
                'dickbettm√∂rtel': 'Dickbettm√∂rtel', 'dickbet': 'Dickbett',
                'buttering': 'Buttering', 'floating': 'Floating',
                'buttering floating': 'Buttering-Floating', 'kombiniert': 'kombiniert',
                'halbverband': 'Halbverband', 'halb verband': 'Halbverband',
                'drittelverband': 'Drittelverband', 'drittel verband': 'Drittelverband',
                'viertelverband': 'Viertelverband', 'viertel verband': 'Viertelverband',
                'kreuzfuge': 'Kreuzfuge', 'kreuz fuge': 'Kreuzfuge',
                'parallelverband': 'Parallelverband', 'parallel verband': 'Parallelverband',
                'diagonalverlegung': 'Diagonalverlegung', 'diagonal': 'diagonal',
                'fischgr√§t': 'Fischgr√§t', 'fischgr√§te': 'Fischgr√§t',
                'fischgraet': 'Fischgr√§t', 'fischgrat': 'Fischgr√§t',
                'r√∂mischer verband': 'R√∂mischer Verband', 'roemischer verband': 'R√∂mischer Verband',
                'wilder verband': 'Wilder Verband', 'wildverband': 'Wildverband',
                'bahnenverlegung': 'Bahnenverlegung', 'bahnen': 'Bahnen',
                'modulverlegung': 'Modulverlegung', 'modular': 'modular',
                'vollfl√§chig': 'vollfl√§chig', 'vollflaechig': 'vollfl√§chig',
                'teilfl√§che': 'Teilfl√§che', 'teilflaeche': 'Teilfl√§che',
                'punktuell': 'punktuell', 'punkt f√ºr punkt': 'punktuell',
                'einbettung': 'Einbettung', 'eingebettet': 'eingebettet',
                'verklebt': 'verklebt', 'geklebt': 'geklebt',
                'verklebung': 'Verklebung', 'klebung': 'Klebung',
                'ansetzen': 'ansetzen', 'angesetzt': 'angesetzt',
                'ansetzarbeiten': 'Ansetzarbeiten', 'ansatztechnik': 'Ansatztechnik',
                'entkopplungsmatte': 'Entkopplungsmatte', 'entkopplung': 'Entkopplung',
                'entkopplungsbahn': 'Entkopplungsbahn', 'ditra': 'DITRA',
                'trittschalld√§mmung': 'Trittschalld√§mmung', 'trittschall': 'Trittschall',
                'w√§rmed√§mmung': 'W√§rmed√§mmung', 'd√§mmung': 'D√§mmung',
                'fu√übodenheizung': 'Fu√übodenheizung', 'fussbodenheizung': 'Fu√übodenheizung',
                'heizestrich': 'Heizestrich', 'heiz estrich': 'Heizestrich',
                'aufheizprotokoll': 'Aufheizprotokoll', 'belegreife': 'Belegreife',
                'restfeuchte': 'Restfeuchte', 'cm messung': 'CM-Messung',
                'cm wert': 'CM-Wert', 'feuchtemessung': 'Feuchtemessung',
                
                // --- Fugen & Verfugung (80+) ---
                'fugen': 'Fugen', 'fuggen': 'Fugen', 'fuge': 'Fuge',
                'verfugen': 'verfugen', 'verfugt': 'verfugt', 'ferfugt': 'verfugt',
                'verfugung': 'Verfugung', 'ferfugung': 'Verfugung',
                'fugenm√∂rtel': 'Fugenm√∂rtel', 'fugenmoertel': 'Fugenm√∂rtel',
                'fugenmasse': 'Fugenmasse', 'fugen masse': 'Fugenmasse',
                'flexfuge': 'Flexfuge', 'flex fuge': 'Flexfuge',
                'flexfugenm√∂rtel': 'Flexfugenm√∂rtel', 'flexfugenmoertel': 'Flexfugenm√∂rtel',
                'zementfuge': 'Zementfuge', 'zement fuge': 'Zementfuge',
                'epoxidfuge': 'Epoxidfuge', 'epoxid fuge': 'Epoxidfuge',
                'epoxidharz': 'Epoxidharz', 'epoxy': 'Epoxid',
                'reaktionsharz': 'Reaktionsharz', 'reaktionsharzfuge': 'Reaktionsharzfuge',
                'fugenbrett': 'Fugenbrett', 'fugen brett': 'Fugenbrett',
                'fugengummi': 'Fugengummi', 'fugen gummi': 'Fugengummi',
                'fugenschwamm': 'Fugenschwamm', 'fugen schwamm': 'Fugenschwamm',
                'fugenbreite': 'Fugenbreite', 'fugen breite': 'Fugenbreite',
                'schmale fuge': 'schmale Fuge', 'breite fuge': 'breite Fuge',
                'fugenbild': 'Fugenbild', 'fugen bild': 'Fugenbild',
                'eingeschl√§mmt': 'eingeschl√§mmt', 'einschlaemmt': 'eingeschl√§mmt',
                'ausgewaschen': 'ausgewaschen', 'aus gewaschen': 'ausgewaschen',
                'diagonal gewaschen': 'diagonal gewaschen', 'fugenreinigung': 'Fugenreinigung',
                'randfuge': 'Randfuge', 'rand fuge': 'Randfuge',
                'anschlussfuge': 'Anschlussfuge', 'anschluss fuge': 'Anschlussfuge',
                'bewegungsfuge': 'Bewegungsfuge', 'bewegungs fuge': 'Bewegungsfuge',
                'dehnfuge': 'Dehnfuge', 'dehn fuge': 'Dehnfuge',
                'dehnungsfuge': 'Dehnungsfuge', 'dehnungs fuge': 'Dehnungsfuge',
                'wartungsfuge': 'Wartungsfuge', 'wartungs fuge': 'Wartungsfuge',
                'schattenfuge': 'Schattenfuge', 'schatten fuge': 'Schattenfuge',
                'feldbegrenzung': 'Feldbegrenzung', 'feld begrenzung': 'Feldbegrenzung',
                'fugenkreuz': 'Fugenkreuz', 'fugen kreuz': 'Fugenkreuz',
                'fugenkeile': 'Fugenkeile', 'fugen keile': 'Fugenkeile',
                'nivelliersystem': 'Nivelliersystem', 'nivellier system': 'Nivelliersystem',
                'fliesenlaschen': 'Fliesenlaschen', 'fliesen laschen': 'Fliesenlaschen',
                'fliesenkeile': 'Fliesenkeile', 'fliesen keile': 'Fliesenkeile',
                
                // --- Grundierung & Voranstrich (50+) ---
                'grundirung': 'Grundierung', 'grundierung': 'Grundierung',
                'grundiert': 'grundiert', 'grundirt': 'grundiert',
                'grundieren': 'grundieren', 'grundiren': 'grundieren',
                'tiefengrund': 'Tiefengrund', 'tiefen grund': 'Tiefengrund',
                'tiefgrund': 'Tiefgrund', 'tief grund': 'Tiefgrund',
                'haftgrund': 'Haftgrund', 'haft grund': 'Haftgrund',
                'haftbr√ºcke': 'Haftbr√ºcke', 'haft br√ºcke': 'Haftbr√ºcke',
                'haftbruecke': 'Haftbr√ºcke', 'haftanstrich': 'Haftanstrich',
                'voranstrich': 'Voranstrich', 'vor anstrich': 'Voranstrich',
                'sperrgrund': 'Sperrgrund', 'sperr grund': 'Sperrgrund',
                'sperrgrundierung': 'Sperrgrundierung', 'absperrung': 'Absperrung',
                'isoliergrund': 'Isoliergrund', 'isolier grund': 'Isoliergrund',
                'kontaktgrund': 'Kontaktgrund', 'kontakt grund': 'Kontaktgrund',
                'betonkontakt': 'Betonkontakt', 'beton kontakt': 'Betonkontakt',
                'quarzsand': 'Quarzsand', 'quarz sand': 'Quarzsand',
                'aufbrennsperre': 'Aufbrennsperre', 'aufbrenn sperre': 'Aufbrennsperre',
                'trocknen': 'trocknen', 'getrocknet': 'getrocknet',
                'trocknungszeit': 'Trocknungszeit', 'abl√ºftzeit': 'Abl√ºftzeit',
                'staubbindend': 'staubbindend', 'staub bindend': 'staubbindend',
                'saugf√§hig': 'saugf√§hig', 'saug f√§hig': 'saugf√§hig',
                'saugend': 'saugend', 'nicht saugend': 'nicht saugend',
                'verd√ºnnt': 'verd√ºnnt', 'unverd√ºnnt': 'unverd√ºnnt',
                'aufgetragen': 'aufgetragen', 'aufgestrichen': 'aufgestrichen',
                'aufgerollt': 'aufgerollt', 'eingearbeitet': 'eingearbeitet',
                
                // --- Abdichtung (80+) ---
                'abdichtung': 'Abdichtung', 'abdichtun': 'Abdichtung',
                'abgedichtet': 'abgedichtet', 'abgedichted': 'abgedichtet',
                'abdichten': 'abdichten', 'dichten': 'dichten',
                'dichtband': 'Dichtband', 'dicht band': 'Dichtband',
                'dichtbahn': 'Dichtbahn', 'dicht bahn': 'Dichtbahn',
                'dichtmanschette': 'Dichtmanschette', 'dicht manschette': 'Dichtmanschette',
                'dichtecke': 'Dichtecke', 'dicht ecke': 'Dichtecke',
                'innenecke': 'Innenecke', 'innen ecke': 'Innenecke',
                'au√üenecke': 'Au√üenecke', 'aussenecke': 'Au√üenecke',
                'aussen ecke': 'Au√üenecke', 'rohrdurchf√ºhrung': 'Rohrdurchf√ºhrung',
                'verbundabdichtung': 'Verbundabdichtung', 'verbund abdichtung': 'Verbundabdichtung',
                'fl√ºssigfolie': 'Fl√ºssigfolie', 'fluessigfolie': 'Fl√ºssigfolie',
                'dichtschl√§mme': 'Dichtschl√§mme', 'dichtschlaemme': 'Dichtschl√§mme',
                'reaktivabdichtung': 'Reaktivabdichtung', 'reaktiv abdichtung': 'Reaktivabdichtung',
                'bitumen': 'Bitumen', 'bitumenanstrich': 'Bitumenanstrich',
                'bitumenbahn': 'Bitumenbahn', 'bitumen bahn': 'Bitumenbahn',
                'schwei√übahn': 'Schwei√übahn', 'schweissbahn': 'Schwei√übahn',
                'kaltselbstklebend': 'kaltselbstklebend', 'kalt selbstklebend': 'kaltselbstklebend',
                'wassersperre': 'Wassersperre', 'wasser sperre': 'Wassersperre',
                'wasserundurchl√§ssig': 'wasserundurchl√§ssig', 'wasserdicht': 'wasserdicht',
                'wasserbest√§ndig': 'wasserbest√§ndig', 'wasser best√§ndig': 'wasserbest√§ndig',
                'druckwasser': 'Druckwasser', 'druck wasser': 'Druckwasser',
                'spritzwasser': 'Spritzwasser', 'spritz wasser': 'Spritzwasser',
                'nassbereiche': 'Nassbereiche', 'nass bereiche': 'Nassbereiche',
                'duschbereich': 'Duschbereich', 'dusch bereich': 'Duschbereich',
                'wannenbereich': 'Wannenbereich', 'wannen bereich': 'Wannenbereich',
                'bodengleich': 'bodengleich', 'boden gleich': 'bodengleich',
                'barrierefrei': 'barrierefrei', 'barriere frei': 'barrierefrei',
                'gef√§lleestrich': 'Gef√§lleestrich', 'gef√§lle estrich': 'Gef√§lleestrich',
                'gefaelleestrich': 'Gef√§lleestrich', 'gef√§lle': 'Gef√§lle',
                'gefaelle': 'Gef√§lle', 'ablauf': 'Ablauf',
                'duschrinne': 'Duschrinne', 'dusch rinne': 'Duschrinne',
                'bodenablauf': 'Bodenablauf', 'boden ablauf': 'Bodenablauf',
                'punktablauf': 'Punktablauf', 'punkt ablauf': 'Punktablauf',
                'linienablauf': 'Linienablauf', 'linien ablauf': 'Linienablauf',
                'din 18534': 'DIN 18534', 'din18534': 'DIN 18534',
                'wassereinwirkungsklasse': 'Wassereinwirkungsklasse', 'w0': 'W0',
                'w1': 'W1', 'w2': 'W2', 'w3': 'W3',
                'w0-i': 'W0-I', 'w1-i': 'W1-I', 'w2-i': 'W2-I', 'w3-i': 'W3-I',
                
                // --- Untergrund & Estrich (80+) ---
                'estrich': 'Estrich', 'esstrich': 'Estrich', 'estrich': 'Estrich',
                'untergrund': 'Untergrund', 'unter grund': 'Untergrund',
                'unterboden': 'Unterboden', 'unter boden': 'Unterboden',
                'untergrundvorbereitung': 'Untergrundvorbereitung', 'untergrund vorbereitung': 'Untergrundvorbereitung',
                'zementestrich': 'Zementestrich', 'zement estrich': 'Zementestrich',
                'calciumsulfatestrich': 'Calciumsulfatestrich', 'calcium sulfat estrich': 'Calciumsulfatestrich',
                'anhydritestrich': 'Anhydritestrich', 'anhydrit estrich': 'Anhydritestrich',
                'gussasphalt': 'Gussasphalt', 'guss asphalt': 'Gussasphalt',
                'trockenestrich': 'Trockenestrich', 'trocken estrich': 'Trockenestrich',
                'flie√üestrich': 'Flie√üestrich', 'fliess estrich': 'Flie√üestrich',
                'schnellestrich': 'Schnellestrich', 'schnell estrich': 'Schnellestrich',
                'ct': 'CT', 'ca': 'CA', 'as': 'AS', 'sr': 'SR',
                'estrichdicke': 'Estrichdicke', 'estrich dicke': 'Estrichdicke',
                'estrichfl√§che': 'Estrichfl√§che', 'estrich fl√§che': 'Estrichfl√§che',
                'estrichfeld': 'Estrichfeld', 'estrich feld': 'Estrichfeld',
                'randd√§mmstreifen': 'Randd√§mmstreifen', 'rand d√§mmstreifen': 'Randd√§mmstreifen',
                'd√§mmschicht': 'D√§mmschicht', 'd√§mm schicht': 'D√§mmschicht',
                'ausgleichsmasse': 'Ausgleichsmasse', 'ausgleichs masse': 'Ausgleichsmasse',
                'nivelliermasse': 'Nivelliermasse', 'nivellier masse': 'Nivelliermasse',
                'selbstverlaufend': 'selbstverlaufend', 'selbst verlaufend': 'selbstverlaufend',
                'selbstnivellierend': 'selbstnivellierend', 'selbst nivellierend': 'selbstnivellierend',
                'spachtelmasse': 'Spachtelmasse', 'spachtel masse': 'Spachtelmasse',
                'ausgleichsspachtel': 'Ausgleichsspachtel', 'ausgleichs spachtel': 'Ausgleichsspachtel',
                'reparaturm√∂rtel': 'Reparaturm√∂rtel', 'reparatur m√∂rtel': 'Reparaturm√∂rtel',
                'reprofilierung': 'Reprofilierung', 'repro filierung': 'Reprofilierung',
                'altbelag': 'Altbelag', 'alt belag': 'Altbelag',
                'altkleber': 'Altkleber', 'alt kleber': 'Altkleber',
                'kleberreste': 'Kleberreste', 'kleber reste': 'Kleberreste',
                'schleifen': 'schleifen', 'geschliffen': 'geschliffen',
                'anschleifen': 'anschleifen', 'angeschliffen': 'angeschliffen',
                'kugelstrahlen': 'kugelstrahlen', 'kugelgestrahlt': 'kugelgestrahlt',
                'fr√§sen': 'fr√§sen', 'gefr√§st': 'gefr√§st',
                'absaugen': 'absaugen', 'abgesaugt': 'abgesaugt',
                'reinigen': 'reinigen', 'gereinigt': 'gereinigt',
                'saugen': 'saugen', 'entstaubt': 'entstaubt',
                'tragf√§hig': 'tragf√§hig', 'trag f√§hig': 'tragf√§hig',
                'belastbar': 'belastbar', 'druckfest': 'druckfest',
                'zugfest': 'zugfest', 'rissfrei': 'rissfrei',
                'rissarm': 'rissarm', 'schwundrisse': 'Schwundrisse',
                'schwindrisse': 'Schwindrisse', 'riss√ºberbr√ºckend': 'riss√ºberbr√ºckend',
                
                // --- Kleber & M√∂rtel (60+) ---
                'fliesenkleber': 'Fliesenkleber', 'fliesen kleber': 'Fliesenkleber',
                'flexkleber': 'Flexkleber', 'flex kleber': 'Flexkleber',
                'dispersionskleber': 'Dispersionskleber', 'dispersions kleber': 'Dispersionskleber',
                'zementkleber': 'Zementkleber', 'zement kleber': 'Zementkleber',
                'reaktionsharzkleber': 'Reaktionsharzkleber', 'reaktionsharz kleber': 'Reaktionsharzkleber',
                'natursteinkleber': 'Natursteinkleber', 'naturstein kleber': 'Natursteinkleber',
                'schnellkleber': 'Schnellkleber', 'schnell kleber': 'Schnellkleber',
                'c1': 'C1', 'c2': 'C2', 'c2te': 'C2TE', 'c2tes1': 'C2TES1',
                's1': 'S1', 's2': 'S2', 'te': 'TE', 'f': 'F',
                'standfest': 'standfest', 'stand fest': 'standfest',
                'thixotrop': 'thixotrop', 'standsicher': 'standsicher',
                'verformbar': 'verformbar', 'hochflexibel': 'hochflexibel',
                'spachtel': 'Spachtel', 'schpachtel': 'Spachtel',
                'spachteln': 'spachteln', 'gespachtelt': 'gespachtelt',
                'aufziehen': 'aufziehen', 'aufgezogen': 'aufgezogen',
                'ausk√§mmen': 'ausk√§mmen', 'ausgek√§mmt': 'ausgek√§mmt',
                'eindr√ºcken': 'eindr√ºcken', 'eingedr√ºckt': 'eingedr√ºckt',
                'andr√ºcken': 'andr√ºcken', 'angedr√ºckt': 'angedr√ºckt',
                'einklopfen': 'einklopfen', 'eingeklopft': 'eingeklopft',
                'hohlraumfrei': 'hohlraumfrei', 'hohlraum frei': 'hohlraumfrei',
                'vollsatt': 'vollsatt', 'satt': 'satt',
                'benetzung': 'Benetzung', 'kontaktfl√§che': 'Kontaktfl√§che',
                'topfzeit': 'Topfzeit', 'verarbeitungszeit': 'Verarbeitungszeit',
                'offene zeit': 'offene Zeit', 'hautbildung': 'Hautbildung',
                'korrigierbar': 'korrigierbar', 'korrigierzeit': 'Korrigierzeit',
                'anmischen': 'anmischen', 'angemischt': 'angemischt',
                'r√ºhren': 'r√ºhren', 'ger√ºhrt': 'ger√ºhrt',
                'reifen': 'reifen', 'reifezeit': 'Reifezeit',
                'sumpfzeit': 'Sumpfzeit', 'quellen': 'quellen',
                
                // --- Silikon & Dichtstoffe (40+) ---
                'silikon': 'Silikon', 'silikoon': 'Silikon', 'silicon': 'Silikon',
                'silikonfuge': 'Silikonfuge', 'silikon fuge': 'Silikonfuge',
                'sanit√§rsilikon': 'Sanit√§rsilikon', 'sanitaersilikon': 'Sanit√§rsilikon',
                'natursteinsilikon': 'Natursteinsilikon', 'naturstein silikon': 'Natursteinsilikon',
                'neutralsilikon': 'Neutralsilikon', 'neutral silikon': 'Neutralsilikon',
                'acetatsilikon': 'Acetatsilikon', 'acetat silikon': 'Acetatsilikon',
                'fungizid': 'fungizid', 'schimmelresistent': 'schimmelresistent',
                'schimmelhemmend': 'schimmelhemmend', 'pilzhemmend': 'pilzhemmend',
                'acryl': 'Acryl', 'acrylfuge': 'Acrylfuge',
                'ms polymer': 'MS-Polymer', 'hybrid': 'Hybrid',
                'polyurethan': 'Polyurethan', 'pu': 'PU',
                'kartusche': 'Kartusche', 'kartuschen': 'Kartuschen',
                'schlauchbeutel': 'Schlauchbeutel', 'schlauch beutel': 'Schlauchbeutel',
                'kartuschenpresse': 'Kartuschenpresse', 'kartuschen presse': 'Kartuschenpresse',
                'silikonpresse': 'Silikonpresse', 'silikon presse': 'Silikonpresse',
                'fugengl√§tter': 'Fugengl√§tter', 'fugen gl√§tter': 'Fugengl√§tter',
                'abziehmittel': 'Abziehmittel', 'abzieh mittel': 'Abziehmittel',
                'gl√§ttmittel': 'Gl√§ttmittel', 'gl√§tt mittel': 'Gl√§ttmittel',
                'hinterf√ºllmaterial': 'Hinterf√ºllmaterial', 'hinterfuellmaterial': 'Hinterf√ºllmaterial',
                'rundschnur': 'Rundschnur', 'rund schnur': 'Rundschnur',
                'pe schnur': 'PE-Schnur', 'hinterf√ºllschnur': 'Hinterf√ºllschnur',
                'primer': 'Primer', 'silikonprimer': 'Silikonprimer',
                'haftverbesserer': 'Haftverbesserer', 'haft verbesserer': 'Haftverbesserer',
                
                // --- Werkzeuge (100+) ---
                'fliesenschneider': 'Fliesenschneider', 'fliesen schneider': 'Fliesenschneider',
                'nassschneider': 'Nassschneider', 'nass schneider': 'Nassschneider',
                'schneidmaschine': 'Schneidmaschine', 'schneid maschine': 'Schneidmaschine',
                'winkelschleifer': 'Winkelschleifer', 'winkel schleifer': 'Winkelschleifer',
                'flex': 'Flex', 'trennschleifer': 'Trennschleifer',
                'diamantscheibe': 'Diamantscheibe', 'diamant scheibe': 'Diamantscheibe',
                'diamanttrennscheibe': 'Diamanttrennscheibe', 'trennscheibe': 'Trennscheibe',
                'bohrkrone': 'Bohrkrone', 'bohr krone': 'Bohrkrone',
                'diamantbohrkrone': 'Diamantbohrkrone', 'diamant bohrkrone': 'Diamantbohrkrone',
                'lochs√§ge': 'Lochs√§ge', 'loch s√§ge': 'Lochs√§ge',
                'lochschneider': 'Lochschneider', 'loch schneider': 'Lochschneider',
                'papageienschnabel': 'Papageienschnabel', 'fliesenzange': 'Fliesenzange',
                'fliesenknipser': 'Fliesenknipser', 'fliesen knipser': 'Fliesenknipser',
                'brechzange': 'Brechzange', 'brech zange': 'Brechzange',
                'zahnspachtel': 'Zahnspachtel', 'zahn spachtel': 'Zahnspachtel',
                'zahnkelle': 'Zahnkelle', 'zahn kelle': 'Zahnkelle',
                'zahnung': 'Zahnung', 'zahnh√∂he': 'Zahnh√∂he',
                '6mm zahnung': '6mm Zahnung', '8mm zahnung': '8mm Zahnung',
                '10mm zahnung': '10mm Zahnung', '12mm zahnung': '12mm Zahnung',
                'gl√§ttekelle': 'Gl√§ttekelle', 'glaettekelle': 'Gl√§ttekelle',
                'gl√§ttkelle': 'Gl√§ttkelle', 'glaettkelle': 'Gl√§ttkelle',
                'traufel': 'Traufel', 'venezianerkelle': 'Venezianerkelle',
                'gummikelle': 'Gummikelle', 'gummi kelle': 'Gummikelle',
                'reibebrett': 'Reibebrett', 'reibe brett': 'Reibebrett',
                'schwammbrett': 'Schwammbrett', 'schwamm brett': 'Schwammbrett',
                'filzbrett': 'Filzbrett', 'filz brett': 'Filzbrett',
                'wasserwaage': 'Wasserwaage', 'wasser waage': 'Wasserwaage',
                'richtlatte': 'Richtlatte', 'richt latte': 'Richtlatte',
                'lasernivellier': 'Lasernivellier', 'laser nivellier': 'Lasernivellier',
                'kreuzlaser': 'Kreuzlaser', 'kreuz laser': 'Kreuzlaser',
                'linienlaser': 'Linienlaser', 'linien laser': 'Linienlaser',
                'rotationslaser': 'Rotationslaser', 'rotations laser': 'Rotationslaser',
                'empf√§nger': 'Empf√§nger', 'laserempf√§nger': 'Laserempf√§nger',
                'stativ': 'Stativ', 'laserstativ': 'Laserstativ',
                'messrad': 'Messrad', 'mess rad': 'Messrad',
                'zollstock': 'Zollstock', 'gliederma√üstab': 'Gliederma√üstab',
                'bandma√ü': 'Bandma√ü', 'ma√üband': 'Ma√üband',
                'massband': 'Ma√üband', 'rollmeter': 'Rollmeter',
                'winkelmesser': 'Winkelmesser', 'winkel messer': 'Winkelmesser',
                'schmiege': 'Schmiege', 'winkellehre': 'Winkellehre',
                'r√ºhrwerk': 'R√ºhrwerk', 'ruehrwerk': 'R√ºhrwerk',
                'r√ºhrquirl': 'R√ºhrquirl', 'ruehrquirl': 'R√ºhrquirl',
                'mischmaschine': 'Mischmaschine', 'misch maschine': 'Mischmaschine',
                'm√∂rtelmischer': 'M√∂rtelmischer', 'moertelmischer': 'M√∂rtelmischer',
                'gummihammer': 'Gummihammer', 'gummi hammer': 'Gummihammer',
                'schonhammer': 'Schonhammer', 'schon hammer': 'Schonhammer',
                'fliesenhammer': 'Fliesenhammer', 'fliesen hammer': 'Fliesenhammer',
                'saugheber': 'Saugheber', 'saug heber': 'Saugheber',
                'vakuumsauger': 'Vakuumsauger', 'vakuum sauger': 'Vakuumsauger',
                'plattenheber': 'Plattenheber', 'platten heber': 'Plattenheber',
                'fliesenwaschset': 'Fliesenwaschset', 'waschset': 'Waschset',
                'waschboy': 'Waschboy', 'wash boy': 'Waschboy',
                'fugenw√§sche': 'Fugenw√§sche', 'fugen w√§sche': 'Fugenw√§sche',
                'reinigungsschwamm': 'Reinigungsschwamm', 'reinigungs schwamm': 'Reinigungsschwamm',
                'fliesenwaschbrett': 'Fliesenwaschbrett', 'waschbrett': 'Waschbrett',
                
                // --- R√§ume & Bereiche (60+) ---
                'badezimmer': 'Badezimmer', 'bad': 'Bad',
                'k√ºche': 'K√ºche', 'kuche': 'K√ºche', 'kueche': 'K√ºche',
                'terrasse': 'Terrasse', 'terase': 'Terrasse', 'terasse': 'Terrasse',
                'balkon': 'Balkon', 'balkong': 'Balkon',
                'dusche': 'Dusche', 'duschbereich': 'Duschbereich',
                'wc': 'WC', 'toilette': 'Toilette', 'g√§ste wc': 'G√§ste-WC',
                'gaeste wc': 'G√§ste-WC', 'g√§stebad': 'G√§stebad',
                'flur': 'Flur', 'diele': 'Diele', 'eingangsbereich': 'Eingangsbereich',
                'wohnzimmer': 'Wohnzimmer', 'wohn zimmer': 'Wohnzimmer',
                'schlafzimmer': 'Schlafzimmer', 'schlaf zimmer': 'Schlafzimmer',
                'esszimmer': 'Esszimmer', 'ess zimmer': 'Esszimmer',
                'kinderzimmer': 'Kinderzimmer', 'kinder zimmer': 'Kinderzimmer',
                'arbeitszimmer': 'Arbeitszimmer', 'arbeits zimmer': 'Arbeitszimmer',
                'b√ºro': 'B√ºro', 'buero': 'B√ºro',
                'keller': 'Keller', 'kellerraum': 'Kellerraum',
                'garage': 'Garage', 'carport': 'Carport',
                'hauswirtschaftsraum': 'Hauswirtschaftsraum', 'hwp': 'HWR',
                'hwr': 'HWR', 'abstellraum': 'Abstellraum',
                'technikraum': 'Technikraum', 'technik raum': 'Technikraum',
                'heizungsraum': 'Heizungsraum', 'heizungs raum': 'Heizungsraum',
                'treppenhaus': 'Treppenhaus', 'treppen haus': 'Treppenhaus',
                'treppe': 'Treppe', 'stufe': 'Stufe', 'stufen': 'Stufen',
                'podest': 'Podest', 'treppenpodest': 'Treppenpodest',
                'wintergarten': 'Wintergarten', 'winter garten': 'Wintergarten',
                'schwimmbad': 'Schwimmbad', 'schwimm bad': 'Schwimmbad',
                'pool': 'Pool', 'poolbereich': 'Poolbereich',
                'poolumgang': 'Poolumgang', 'poolumrandung': 'Poolumrandung',
                'sauna': 'Sauna', 'saunabereich': 'Saunabereich',
                'wellnessbereich': 'Wellnessbereich', 'wellness bereich': 'Wellnessbereich',
                'spa': 'Spa', 'spabereich': 'Spa-Bereich',
                'empfang': 'Empfang', 'empfangsbereich': 'Empfangsbereich',
                'rezeption': 'Rezeption', 'foyer': 'Foyer',
                'verkaufsraum': 'Verkaufsraum', 'verkaufs raum': 'Verkaufsraum',
                'ladenfl√§che': 'Ladenfl√§che', 'ladenflaeche': 'Ladenfl√§che',
                'gewerbe': 'Gewerbe', 'gewerbefl√§che': 'Gewerbefl√§che',
                'praxis': 'Praxis', 'arztpraxis': 'Arztpraxis',
                'restaurant': 'Restaurant', 'gastronomie': 'Gastronomie',
                'gro√ük√ºche': 'Gro√ük√ºche', 'grosskueche': 'Gro√ük√ºche',
                'produktionshalle': 'Produktionshalle', 'produktions halle': 'Produktionshalle',
                'lagerhalle': 'Lagerhalle', 'lager halle': 'Lagerhalle',
                
                // --- T√§tigkeiten & Aktionen (120+) ---
                'abgestemmt': 'abgestemmt', 'abgestemt': 'abgestemmt',
                'abgerissen': 'abgerissen', 'abriss': 'Abriss',
                'abgebrochen': 'abgebrochen', 'abbruch': 'Abbruch',
                'entfernt': 'entfernt', 'entfernen': 'entfernen',
                'demontiert': 'demontiert', 'demontage': 'Demontage',
                'ausgebaut': 'ausgebaut', 'ausbau': 'Ausbau',
                'r√ºckbau': 'R√ºckbau', 'rueckbau': 'R√ºckbau',
                'r√ºckgebaut': 'r√ºckgebaut', 'rueckgebaut': 'r√ºckgebaut',
                'vorbereitet': 'vorbereitet', 'vorbereitung': 'Vorbereitung',
                'vorarbeiten': 'Vorarbeiten', 'vor arbeiten': 'Vorarbeiten',
                'grundiert': 'grundiert', 'grundieren': 'grundieren',
                'gespachtelt': 'gespachtelt', 'spachteln': 'spachteln',
                'ausgeglichen': 'ausgeglichen', 'ausgleichen': 'ausgleichen',
                'nivelliert': 'nivelliert', 'nivellieren': 'nivellieren',
                'abgedichtet': 'abgedichtet', 'abdichten': 'abdichten',
                'geschnitten': 'geschnitten', 'schneiden': 'schneiden',
                'zugeschnitten': 'zugeschnitten', 'zuschnitt': 'Zuschnitt',
                'angepasst': 'angepasst', 'anpassen': 'anpassen',
                'verlegt': 'verlegt', 'verlegen': 'verlegen',
                'geklebt': 'geklebt', 'kleben': 'kleben',
                'angesetzt': 'angesetzt', 'ansetzen': 'ansetzen',
                'verfugt': 'verfugt', 'verfugen': 'verfugen',
                'versiegelt': 'versiegelt', 'versiegeln': 'versiegeln',
                'impr√§gniert': 'impr√§gniert', 'impraegniert': 'impr√§gniert',
                'impr√§gnieren': 'impr√§gnieren', 'impraegnieren': 'impr√§gnieren',
                'gereinigt': 'gereinigt', 'reinigen': 'reinigen',
                'ges√§ubert': 'ges√§ubert', 's√§ubern': 's√§ubern',
                'abgesaugt': 'abgesaugt', 'absaugen': 'absaugen',
                'ausgemessen': 'ausgemessen', 'ausmessen': 'ausmessen',
                'aufgemessen': 'aufgemessen', 'aufmessen': 'aufmessen',
                'aufgeteilt': 'aufgeteilt', 'aufteilen': 'aufteilen',
                'eingemessen': 'eingemessen', 'einmessen': 'einmessen',
                'angezeichnet': 'angezeichnet', 'anzeichnen': 'anzeichnen',
                'markiert': 'markiert', 'markieren': 'markieren',
                'ausgerichtet': 'ausgerichtet', 'ausrichten': 'ausrichten',
                'eingebaut': 'eingebaut', 'einbauen': 'einbauen',
                'montiert': 'montiert', 'montieren': 'montieren',
                'befestigt': 'befestigt', 'befestigen': 'befestigen',
                'verankert': 'verankert', 'verankern': 'verankern',
                'verd√ºbelt': 'verd√ºbelt', 'verduebelt': 'verd√ºbelt',
                'verschraubt': 'verschraubt', 'verschrauben': 'verschrauben',
                'verklebt': 'verklebt', 'verkleben': 'verkleben',
                'abgeklebt': 'abgeklebt', 'abkleben': 'abkleben',
                'abgedeckt': 'abgedeckt', 'abdecken': 'abdecken',
                'gesch√ºtzt': 'gesch√ºtzt', 'schuetzen': 'sch√ºtzen',
                'fertiggestellt': 'fertiggestellt', 'fertigstellen': 'fertigstellen',
                'abgeschlossen': 'abgeschlossen', 'abschlie√üen': 'abschlie√üen',
                '√ºbergeben': '√ºbergeben', 'uebergeben': '√ºbergeben',
                'dokumentiert': 'dokumentiert', 'dokumentieren': 'dokumentieren',
                'protokolliert': 'protokolliert', 'protokollieren': 'protokollieren',
                'kontrolliert': 'kontrolliert', 'kontrollieren': 'kontrollieren',
                'gepr√ºft': 'gepr√ºft', 'geprueft': 'gepr√ºft',
                'gemessen': 'gemessen', 'messen': 'messen',
                'besichtigt': 'besichtigt', 'besichtigen': 'besichtigen',
                'aufgenommen': 'aufgenommen', 'aufnehmen': 'aufnehmen',
                'begutachtet': 'begutachtet', 'begutachten': 'begutachten',
                'beurteilt': 'beurteilt', 'beurteilen': 'beurteilen',
                'bewertet': 'bewertet', 'bewerten': 'bewerten',
                
                // --- Zahlen & Einheiten (50+) ---
                'quadratmeter': 'Quadratmeter', 'qm': 'qm', 'm¬≤': 'm¬≤', 'm2': 'm¬≤',
                'laufmeter': 'Laufmeter', 'lfm': 'lfm', 'lfdm': 'lfdm',
                'st√ºck': 'St√ºck', 'stueck': 'St√ºck', 'stk': 'Stk.',
                'stunden': 'Stunden', 'stunde': 'Stunde', 'std': 'Std.',
                'minuten': 'Minuten', 'minute': 'Minute', 'min': 'Min.',
                'meter': 'Meter', 'zentimeter': 'Zentimeter', 'cm': 'cm',
                'millimeter': 'Millimeter', 'mm': 'mm',
                'kilogramm': 'Kilogramm', 'kg': 'kg',
                'gramm': 'Gramm', 'g': 'g',
                'liter': 'Liter', 'l': 'l',
                'eimer': 'Eimer', 'sack': 'Sack', 's√§cke': 'S√§cke',
                'palette': 'Palette', 'paletten': 'Paletten',
                'karton': 'Karton', 'kartons': 'Kartons',
                'packung': 'Packung', 'paket': 'Paket',
                'rolle': 'Rolle', 'rollen': 'Rollen',
                'einhalb': 'einhalb', 'anderthalb': 'anderthalb',
                'zweieinhalb': 'zweieinhalb', 'dreieinhalb': 'dreieinhalb',
                'viereinhalb': 'viereinhalb', 'f√ºnfeinhalb': 'f√ºnfeinhalb',
                'fuenfeinhalb': 'f√ºnfeinhalb', 'einviertel': 'einviertel',
                'dreiviertel': 'dreiviertel', 'ca': 'ca.', 'circa': 'ca.',
                'etwa': 'etwa', 'ungef√§hr': 'ungef√§hr', 'ungefaehr': 'ungef√§hr',
                
                // --- Spracherkennung-Fehler (100+) ---
                'flie√üe': 'Fliese', 'fliesse': 'Fliese',
                'flies verlegt': 'Fliesen verlegt', 'fliessen verlegt': 'Fliesen verlegt',
                'die flie√üen': 'die Fliesen', 'flie√üen leg': 'Fliesen leg',
                'f√ºgen': 'Fugen', 'fuken': 'Fugen',
                'fer fugt': 'verfugt', 'ver fugt': 'verfugt',
                'grundi rung': 'Grundierung', 'grund ierung': 'Grundierung',
                'ab dichtung': 'Abdichtung', 'abdichtunk': 'Abdichtung',
                'est rich': 'Estrich', 'estrisch': 'Estrich',
                'spachte ln': 'spachteln', 'schpachtel': 'Spachtel',
                'silikohn': 'Silikon', 'sillikonn': 'Silikon',
                'dehnungs fuge': 'Dehnungsfuge', 'dehnungsfuche': 'Dehnungsfuge',
                'nasschnei der': 'Nassschneider', 'nass schneider': 'Nassschneider',
                'winkelsleifer': 'Winkelschleifer', 'winkel schlefer': 'Winkelschleifer',
                'flegs': 'Flex', 'fleks': 'Flex',
                'waserwaage': 'Wasserwaage', 'wasser wage': 'Wasserwaage',
                'kreuz laser': 'Kreuzlaser', 'kreuzlazer': 'Kreuzlaser',
                'bade zimmer': 'Badezimmer', 'baad': 'Bad',
                'k√ºsche': 'K√ºche', 'k√ºhche': 'K√ºche',
                'terassse': 'Terrasse', 'terrasse': 'Terrasse',
                'dussche': 'Dusche', 'dushce': 'Dusche',
                'abge stemmt': 'abgestemmt', 'abgest√§mmt': 'abgestemmt',
                'abgeri ssen': 'abgerissen', 'ab gerissen': 'abgerissen',
                'vor bereitet': 'vorbereitet', 'forberreitet': 'vorbereitet',
                'grund iert': 'grundiert', 'grundirt': 'grundiert',
                'abge dichtet': 'abgedichtet', 'ab gedichtet': 'abgedichtet',
                'ge schnitten': 'geschnitten', 'geschnieten': 'geschnitten',
                'gerei nigt': 'gereinigt', 'gereinicht': 'gereinigt',
                'quadrad meter': 'Quadratmeter', 'quadratme ter': 'Quadratmeter',
                'qwadratmeter': 'Quadratmeter', 'quadratmete': 'Quadratmeter',
                '1 stunde': '1 Stunde', '2 stunden': '2 Stunden',
                '3 stunden': '3 Stunden', '4 stunden': '4 Stunden',
                '5 stunden': '5 Stunden', '6 stunden': '6 Stunden',
                '7 stunden': '7 Stunden', '8 stunden': '8 Stunden',
                'halb e stunde': 'halbe Stunde', 'eine halbe stunde': 'eine halbe Stunde',
                'einein halb stunden': 'eineinhalb Stunden',
                'eins komma f√ºnf stunden': '1,5 Stunden',
                'zwei komma f√ºnf stunden': '2,5 Stunden',
                'fliesn': 'Fliesen', 'flisen': 'Fliesen',
                'bodenflies': 'Bodenfliesen', 'wandflies': 'Wandfliesen',
                'fertigestellt': 'fertiggestellt', 'fertig gestelt': 'fertiggestellt',
                'abgeschlo√üen': 'abgeschlossen', 'abgeschlosen': 'abgeschlossen',
                
                // --- Marken & Hersteller ---
                'mapei': 'Mapei', 'kerakoll': 'Kerakoll',
                'sopro': 'Sopro', 'lugato': 'Lugato',
                'pci': 'PCI', 'sakret': 'Sakret',
                'sch√∂nox': 'Sch√∂nox', 'schoenox': 'Sch√∂nox',
                'botament': 'Botament', 'ceresit': 'Ceresit',
                'sika': 'Sika', 'ardex': 'Ardex',
                'weber': 'Weber', 'knauf': 'Knauf',
                'rako': 'Rako', 'villeroy': 'Villeroy',
                'agrob buchtal': 'Agrob Buchtal', 'steuler': 'Steuler',
                'deutsche steinzeug': 'Deutsche Steinzeug',
                
                // --- Baustelle & Organisation ---
                'baustelle': 'Baustelle', 'bau stelle': 'Baustelle',
                'bauvorhaben': 'Bauvorhaben', 'bau vorhaben': 'Bauvorhaben',
                'bauherr': 'Bauherr', 'bau herr': 'Bauherr',
                'auftraggeber': 'Auftraggeber', 'auftrag geber': 'Auftraggeber',
                'bauleiter': 'Bauleiter', 'bau leiter': 'Bauleiter',
                'baustelleneinrichtung': 'Baustelleneinrichtung',
                'baustellenreinigung': 'Baustellenreinigung',
                'bauendreinigung': 'Bauendreinigung', 'bau endreinigung': 'Bauendreinigung',
                'besenrein': 'besenrein', 'besen rein': 'besenrein',
                'staubfrei': 'staubfrei', 'staub frei': 'staubfrei',
                '√ºbergabe': '√úbergabe', 'uebergabe': '√úbergabe',
                'abnahme': 'Abnahme', 'ab nahme': 'Abnahme',
                'aufma√ü': 'Aufma√ü', 'aufmass': 'Aufma√ü',
                'rapport': 'Rapport', 'raport': 'Rapport',
                'tagesbericht': 'Tagesbericht', 'tages bericht': 'Tagesbericht',
                'wochenbericht': 'Wochenbericht', 'wochen bericht': 'Wochenbericht',
                'regiearbeit': 'Regiearbeit', 'regie arbeit': 'Regiearbeit',
                'regiestunden': 'Regiestunden', 'regie stunden': 'Regiestunden',
                'nacharbeit': 'Nacharbeit', 'nach arbeit': 'Nacharbeit',
                'm√§ngelbeseitigung': 'M√§ngelbeseitigung', 'maengelbeseitigung': 'M√§ngelbeseitigung',
                'nachbesserung': 'Nachbesserung', 'nach besserung': 'Nachbesserung',
                'gew√§hrleistung': 'Gew√§hrleistung', 'gewaehrleistung': 'Gew√§hrleistung'
            },
            
            // === PROFESSIONELLE FORMULIERUNGEN (599 Eintr√§ge) ===
            formulierungen: {
                'fliesen': [
                    'Fliesen fachgerecht im D√ºnnbettverfahren verlegt',
                    'Fliesenbelag nach Herstellervorgaben verlegt',
                    'Wandfliesen im Verbund mit Kreuzfuge gesetzt',
                    'Bodenfliesen mit Nivellierung verlegt',
                    'Gro√üformatfliesen fachgerecht verlegt',
                    'Fliesenverlegung nach DIN 18157 ausgef√ºhrt',
                    'Feinsteinzeug im D√ºnnbett verlegt',
                    'Mosaikfliesen im Papiervlies gesetzt',
                    'Fliesenbelag mit Dehnungsfugen erstellt',
                    'Rektifizierte Fliesen mit 2mm Fuge verlegt',
                    'Gro√üformat 120x60 im Halbverband verlegt',
                    'Bodenfliesen R10 rutschhemmend verlegt',
                    'Wandfliesen vollfl√§chig im Buttering-Floating verlegt',
                    'Feinsteinzeug poliert fachgerecht verlegt',
                    'Natursteinoptik-Fliesen diagonal verlegt',
                    'Holzoptik-Fliesen im Drittelverband verlegt',
                    'Betonoptik-Fliesen fugenlos verlegt',
                    'Metro-Fliesen im Halbverband gesetzt',
                    'Hexagon-Mosaik fachgerecht verlegt',
                    'Fischgr√§tmuster fachgerecht ausgef√ºhrt',
                    'Bord√ºre als gestalterisches Element eingearbeitet',
                    'Sockelfliesen umlaufend montiert',
                    'Dekorfliesen nach Mustervorlage verlegt',
                    'Fliesen mit Gef√§lle zum Ablauf verlegt',
                    'Antirutsch-Fliesen R11 im Nassbereich verlegt',
                    'Treppenfliesen mit Sicherheitskante verlegt',
                    'Eckschutzschienen eingearbeitet',
                    'Abschlussprofile fachgerecht montiert',
                    '√úbergangsprofil zum Parkett eingebaut',
                    'Fliesenbelag mit Bewegungsfugen angelegt'
                ],
                'verlegt': [
                    'Belag fachgerecht verlegt',
                    'Verlegung nach Herstellerangaben durchgef√ºhrt',
                    'Material im D√ºnnbettverfahren verlegt',
                    'Fliesen mit Zahnspachtel aufgezogen',
                    'Bodenbelag vollfl√§chig verlegt',
                    'Fliesenverlegung im Verbund ausgef√ºhrt',
                    'Diagonal verlegt nach Kundenwunsch',
                    'Im Halbverband fachgerecht verlegt',
                    'Mit Nivelliersystem planeben verlegt',
                    'Kreuzfuge exakt ausgef√ºhrt',
                    'Wandverlegung von unten nach oben',
                    'Bodenverlegung von der T√ºr ausgehend',
                    'Symmetrische Verlegung von der Mitte aus',
                    'Verlegung mit minimalem Verschnitt durchgef√ºhrt',
                    'Gro√üformat mit Saugheber verlegt',
                    'Schwimmende Verlegung auf Trittschalld√§mmung',
                    'Entkoppelte Verlegung auf Problemuntergrund',
                    'Verlegung auf Fu√übodenheizung nach Aufheizprotokoll',
                    'Belag im Gef√§lle zum Bodenablauf verlegt',
                    'Verlegung mit durchgehender Optik ausgef√ºhrt'
                ],
                'fugen': [
                    'Fugenarbeiten fachgerecht ausgef√ºhrt',
                    'Fugenm√∂rtel eingeschl√§mmt',
                    'Fugen diagonal ausgewaschen',
                    'Randfugen mit Silikon geschlossen',
                    'Dehnungsfugen nach DIN erstellt',
                    'Flexfugenm√∂rtel verarbeitet',
                    'Fugen mit Epoxidharz ausgef√ºhrt',
                    'Fugenbreite 3mm exakt eingehalten',
                    'Bewegungsfugen fachgerecht angelegt',
                    'Wartungsfugen elastisch verfugt',
                    'Bodenfugen mit Fugenm√∂rtel gef√ºllt',
                    'Wandfugen sauber ausgearbeitet',
                    'Fugenbild gleichm√§√üig hergestellt',
                    'Eckfugen elastisch ausgef√ºhrt',
                    'Anschlussfugen dauerelastisch verschlossen',
                    'Fugenreinigung vor Neuverfugung',
                    'Altfugen ausgekratzt und erneuert',
                    'Fugen impr√§gniert gegen Verschmutzung',
                    'Sichtfugen sauber nachgearbeitet',
                    'Fugenfarbe nach Kundenwunsch gew√§hlt',
                    'Kontrastfuge als Gestaltungselement',
                    'Fugenkreuze verwendet f√ºr gleichm√§√üiges Fugenbild',
                    'Fugen diagonal mit Schwammbrett ausgewaschen',
                    'Zementschleier entfernt',
                    'Epoxidharzfugen in Gro√ük√ºche eingebaut'
                ],
                'verfugt': [
                    'Fl√§che komplett verfugt',
                    'Bodenfliesen verfugt und gereinigt',
                    'Wandfliesen sauber verfugt',
                    'Verfugung mit Flexfuge ausgef√ºhrt',
                    'Zement√§r verfugt nach Herstellerangaben',
                    'Mit 2K-Epoxid verfugt f√ºr erh√∂hte Belastung',
                    'Fl√§che verfugt und zementschleierentfernt',
                    'Feinsteinzeug mit passender Fugenfarbe verfugt',
                    'Verfugung im Nassbereich fungizid ausgef√ºhrt',
                    'Naturstein mit Spezialfuge verfugt',
                    'Mosaik mit Flexfuge sauber verfugt',
                    'Gro√üformat mit 3mm Fuge verfugt',
                    'Terrassenbelag frostfest verfugt',
                    'Treppen mit rutschhemmender Fuge verfugt',
                    'Verfugungsarbeiten abgeschlossen'
                ],
                'silikon': [
                    'Silikonfugen fachgerecht gezogen',
                    'Sanit√§rsilikon in Nassbereich eingebracht',
                    'Dehnungsfugen mit Silikon geschlossen',
                    'Eckfugen mit dauerelastischem Silikon verfugt',
                    'Anschl√ºsse an Sanit√§robjekten abgedichtet',
                    'Wandanschluss mit Silikon verschlossen',
                    'Bewegungsfugen elastisch ausgef√ºhrt',
                    'Randfugen umlaufend mit Silikon',
                    'Silikonfuge an Duschwanne erstellt',
                    'Wannenrand fachgerecht abgedichtet',
                    'Waschbeckenanschluss versiegelt',
                    'Sp√ºlenbecken einsiliert',
                    'Silikon mit Gl√§ttmittel abgezogen',
                    'Altsilikon restlos entfernt und erneuert',
                    'Natursteinsilikon verwendet (verf√§rbungsfrei)'
                ],
                'grundierung': [
                    'Untergrund fachgerecht grundiert',
                    'Tiefengrund aufgetragen',
                    'Haftgrund vor Verlegung aufgebracht',
                    'Grundierung nach Herstellervorgabe',
                    'Sperrgrundierung auf kritischem Untergrund',
                    'Betonkontakt vollfl√§chig aufgetragen',
                    'Grundierung f√ºr Verbundabdichtung',
                    'Estrich mit Tiefengrund vorbereitet',
                    'Altbelag mit Haftbr√ºcke vorbereitet',
                    'Grundierung zweifach aufgerollt',
                    'Saugenden Untergrund grundiert',
                    'Gipsputz mit Sperrgrund behandelt',
                    'Calciumsulfatestrich fachgerecht grundiert',
                    'Zementestrich grundiert nach Trocknungspr√ºfung',
                    'Grundierung abgetrocknet, belegreif',
                    'Untergrund saugf√§higkeitsausgleichend grundiert',
                    'Gipsfaserplatten mit Tiefengrund vorbereitet',
                    'Quarzsandgef√ºllte Grundierung aufgetragen',
                    'Estrich 2x grundiert f√ºr optimale Haftung',
                    'Altfliesen mit Spezialgrund vorbereitet'
                ],
                'grundiert': [
                    'Fl√§che vorbehandelt und grundiert',
                    'Estrich grundiert - belegreif',
                    'Untergrund fachgerecht grundiert',
                    'Wand vollfl√§chig grundiert',
                    'Boden nach Reinigung grundiert',
                    'Altfliesen angeschliffen und grundiert',
                    'Putz grundiert nach Trocknungszeit',
                    'Gipskarton grundiert f√ºr Abdichtung',
                    'Anhydrit grundiert und belegreif',
                    'Zementestrich grundiert nach CM-Messung',
                    'Trockenbauwand grundiert',
                    'Gipsfaserplatten grundiert',
                    'Untergrund 2x grundiert f√ºr Haftung',
                    'Fl√§che grundiert - Verlegung m√∂glich',
                    'Estrichfl√§che vollst√§ndig grundiert'
                ],
                'abdichtung': [
                    'Verbundabdichtung fachgerecht ausgef√ºhrt',
                    'Abdichtung im Duschbereich nach DIN 18534',
                    'Fl√ºssigfolie zweilagig aufgetragen',
                    'Dichtband in Ecken eingearbeitet',
                    'Bodenfl√§che wasserundurchl√§ssig abgedichtet',
                    'Wandfl√§che im Spritzwasserbereich abgedichtet',
                    'Durchdringungen mit Manschetten abgedichtet',
                    'Bodengleiche Dusche fachgerecht abgedichtet',
                    'Abdichtung bis 20cm √ºber OKFF hochgezogen',
                    'Gef√§lleestrich vor Abdichtung erstellt',
                    'Duschrinne eingebaut und abgedichtet',
                    'Ablauf angeschlossen und abgedichtet',
                    'Verbundabdichtung W2-I ausgef√ºhrt',
                    'Abdichtung im Wannenbereich erstellt',
                    'Komplett abgedichtet nach DIN 18534',
                    'Fl√§chenabdichtung mit Reaktionsharz',
                    'Bahnenabdichtung vollfl√§chig verklebt',
                    'Ecken mit Formteilen abgedichtet',
                    'Rohrdurchf√ºhrungen fachgerecht abgedichtet',
                    'Estrich vor Abdichtung gepr√ºft',
                    'Boden- und Wandanschluss abgedichtet',
                    'Duschbereich komplett nach DIN abgedichtet',
                    'Sockelfuge als Wartungsfuge ausgef√ºhrt',
                    'Verbundabdichtung zweilagig aufgetragen',
                    'Schichtdicke dokumentiert und protokolliert'
                ],
                'abgedichtet': [
                    'Duschbereich fachgerecht abgedichtet',
                    'Nassbereich vollst√§ndig abgedichtet',
                    'Wandanschluss wasserundurchl√§ssig abgedichtet',
                    'Durchdringungen mit Manschetten abgedichtet',
                    'Bodenablauf eingebunden und abgedichtet',
                    'Duschrinne angeschlossen und abgedichtet',
                    'Bereich abgedichtet gem√§√ü DIN 18534',
                    'Wandfl√§che bis Oberkante Spritzwasser abgedichtet',
                    'Boden komplett abgedichtet und belegreif',
                    'Ecken und Kanten sicher abgedichtet',
                    'Wannenbereich rundum abgedichtet',
                    'Duschboden mit Gef√§lle abgedichtet',
                    'Sockelfuge dauerelastisch abgedichtet',
                    'Estrich gepr√ºft und abgedichtet',
                    'Fl√§che abgedichtet - Verlegung kann beginnen'
                ],
                'entfernen': [
                    'Altbelag fachgerecht entfernt',
                    'Alten Fliesenbelag abgestemmt',
                    'Bestandsfliesen demontiert',
                    'Sockelfliesen entfernt',
                    'Altkleber abgefr√§st',
                    'Kleberreste beseitigt',
                    'Alte Silikonfugen ausgekratzt',
                    'Defekte Fliesen ausgetauscht',
                    'Besch√§digten Belag entfernt',
                    'Untergrund von Altbelag befreit',
                    'Wandfliesen abgeschlagen',
                    'Bodenfliesen herausgestemmt',
                    'Fliesenreste entsorgt',
                    'Estrichboden freigelegt',
                    'Untergrund f√ºr Neuverlegung vorbereitet',
                    'Mosaik vollst√§ndig entfernt',
                    'Bord√ºren demontiert',
                    'Alte Dichtstoffe entfernt',
                    'Zementschleier beseitigt',
                    'Verschmutzungen gr√ºndlich entfernt',
                    'Altanstrich abgetragen',
                    'Tapeten im Spritzbereich entfernt',
                    'Vorhandene Profile demontiert',
                    'T√ºrschwelle ausgebaut',
                    'Sockelleisten entfernt',
                    'Sanit√§robjekte zur Seite gestellt',
                    'WC f√ºr Fliesenarbeiten demontiert',
                    'Waschbecken abgeh√§ngt',
                    'Heizk√∂rper abmontiert',
                    'Steckdosen und Schalter gesichert',
                    'Bauschutt fachgerecht entsorgt',
                    'Entsorgung inkl. Containerstellung',
                    'Material zur Deponie gebracht',
                    'Demontierte Teile f√ºr Wiederverwendung gesichert',
                    'R√ºckbauarbeiten abgeschlossen'
                ],
                'reinigung': [
                    'Baustelle besenrein gereinigt',
                    'Abschlussreinigung durchgef√ºhrt',
                    'Fliesenbelag gereinigt',
                    'Bauendreinigung ausgef√ºhrt',
                    'Zementschleier entfernt',
                    'Fl√§che f√ºr √úbergabe gereinigt',
                    'Fugen nachgereinigt',
                    'Silikonfugen ges√§ubert',
                    'Baustelle aufger√§umt und gereinigt',
                    'Arbeitsbereich sauber hinterlassen',
                    'Reinigung nach Verfugung durchgef√ºhrt',
                    'Fenster und Fl√§chen abgewischt',
                    'Baustaub entfernt',
                    'Schutzfolien entfernt und entsorgt',
                    'Fliesenbelag poliert',
                    'Naturstein impr√§gniert und gereinigt',
                    'Feinsteinzeug pflegeleicht versiegelt',
                    'Sanit√§robjekte gereinigt',
                    'Armaturen poliert',
                    'Glatte Fl√§chen streifenfrei gereinigt',
                    'Fugenreinigung mit Spezialreiniger',
                    'Epoxidharzschleier entfernt',
                    'Kalkflecken beseitigt',
                    'Fliesenfl√§che f√ºr Nutzung freigegeben',
                    'Zement√§re Verschmutzungen entfernt',
                    'Fliesenbelag √ºbergabefertig gereinigt',
                    'Oberfl√§chen abschlie√üend gereinigt',
                    'Bauschutt komplett entfernt',
                    'Restmaterial abtransportiert',
                    'Werkzeug und Material ger√§umt',
                    'Baustelle begehbar und sauber',
                    'Reinigung protokolliert',
                    'Fl√§che zur Abnahme vorbereitet',
                    '√úbergabereinigung abgeschlossen',
                    'Endreinigung komplett durchgef√ºhrt'
                ],
                'gereinigt': [
                    'Fl√§che gereinigt und √ºbergeben',
                    'Belag abschlie√üend gereinigt',
                    'Baustelle aufger√§umt',
                    'Fliesenbelag zementfrei gereinigt',
                    'Oberfl√§chen gereinigt',
                    'Feinsteinzeug poliert gereinigt',
                    'Naturstein schonend gereinigt',
                    'Fugen nachgereinigt',
                    'Sanit√§rbereich gereinigt',
                    'Boden wischbereit gereinigt',
                    'W√§nde staubfrei gereinigt',
                    'Fliesenspiegel streifenfrei gereinigt',
                    'Glasmosaik nachpoliert',
                    'Belag f√ºr Nutzung freigegeben',
                    'Fl√§che gereinigt - Abnahme erfolgt'
                ],
                'vorbereitung': [
                    'Untergrund fachgerecht vorbereitet',
                    'Vorbereitungsarbeiten durchgef√ºhrt',
                    'Untergrundpr√ºfung durchgef√ºhrt',
                    'Vorarbeiten ausgef√ºhrt',
                    'Baustelleneinrichtung durchgef√ºhrt',
                    'Estrich f√ºr Verlegung vorbereitet',
                    'Wand f√ºr Fliesenarbeiten vorbereitet',
                    'Altbelag entfernt und vorbereitet',
                    'Material bereitgestellt',
                    'Werkzeug eingerichtet',
                    'Schutzma√ünahmen getroffen',
                    'Abdeckfolien verlegt',
                    'T√ºren und Fenster gesch√ºtzt',
                    'Materiallager eingerichtet',
                    'Schneidplatz vorbereitet',
                    'Wasserzugang hergestellt',
                    'Stromversorgung gesichert',
                    'Zugang zur Baustelle geschaffen',
                    'Arbeitsger√ºst aufgebaut',
                    'Arbeitsb√ºhne bereitgestellt',
                    'Schuttrutsche installiert',
                    'Container aufgestellt',
                    'Baustellensicherung erfolgt',
                    'Absperrungen errichtet',
                    'Warnschilder aufgestellt',
                    'Schutzausr√ºstung bereitgelegt',
                    'Erste-Hilfe-Material kontrolliert',
                    'Baustellendokumentation begonnen',
                    'Aufma√ü erstellt',
                    'Verlegeplan erstellt',
                    'Material kontrolliert und gez√§hlt',
                    'Farbabgleich durchgef√ºhrt',
                    'Chargen gemischt f√ºr einheitliche Optik',
                    'Untergrund auf Ebenheit gepr√ºft',
                    'Feuchtemessung protokolliert'
                ],
                'vorbereitet': [
                    'Untergrund f√ºr Verlegung vorbereitet',
                    'Fl√§che vorbereitet',
                    'Arbeitsbereich vorbereitet',
                    'Material bereitgestellt',
                    'Baustelle vorbereitet',
                    'Estrich geschliffen und vorbereitet',
                    'Wand gespachtelt und vorbereitet',
                    'Boden ausgeglichen und vorbereitet',
                    'Untergrund grundiert und vorbereitet',
                    'Fl√§che belegreif vorbereitet',
                    'Abdichtung aufgebracht - vorbereitet',
                    'Gef√§lle erstellt - vorbereitet',
                    'Duschbereich abgedichtet und vorbereitet',
                    'Untergrund optimal vorbereitet',
                    'Fl√§che f√ºr Verlegung vorbereitet'
                ],
                'schneiden': [
                    'Fliesen zugeschnitten und angepasst',
                    'Randanpassungen erstellt',
                    'Aussparungen ausgeschnitten',
                    'Gehrungsschnitte ausgef√ºhrt',
                    'Fliesenausschnitte erstellt',
                    'Steckdosenausschnitte geschnitten',
                    'Rohrausschnitte angefertigt',
                    'Eckausschnitte pr√§zise gefertigt',
                    'L-Schnitte f√ºr Ecken erstellt',
                    'Diagonalschnitte ausgef√ºhrt',
                    'Gro√üformat mit Nassschneider zugeschnitten',
                    'Mosaikstreifen angepasst',
                    'Sockelst√ºcke zugeschnitten',
                    'Bord√ºrenenden auf Gehrung geschnitten',
                    'Treppenkanten geschnitten',
                    'Einleger passgenau gefertigt',
                    'Randfliesen exakt eingepasst',
                    'Aussparung f√ºr Duschrinne geschnitten',
                    'Ablauf√∂ffnung pr√§zise ausgeschnitten',
                    'Gehrungsschnitte 45¬∞ an Au√üenecken',
                    'Anschl√ºsse passgenau geschnitten',
                    'Fliesen mit Fliesenschneider geteilt',
                    'Ausbr√ºche mit Papageienschnabel',
                    'Rundungen mit Bohrkrone gefertigt',
                    'Sonderschnitte mit Flex ausgef√ºhrt',
                    'Komplexe Geometrien gefertigt',
                    'Verschnitt minimiert',
                    'Schnittplan optimiert',
                    'Fliesen verlustarm zugeschnitten',
                    'Pr√§zisionsschnitte f√ºr √úberg√§nge',
                    'Sto√üfugen auf Ma√ü geschnitten',
                    'Abschl√ºsse sauber geschnitten',
                    'Fliesenspiegel ma√ügenau angepasst',
                    'Wandabschluss passgenau geschnitten',
                    'Bodenabschluss exakt gefertigt'
                ],
                'zugeschnitten': [
                    'Fliesen passgenau zugeschnitten',
                    'Randst√ºcke angepasst',
                    'Material zugeschnitten',
                    'Aussparungen geschnitten',
                    'Fliesen angepasst',
                    'Steckdosen√∂ffnungen ausgeschnitten',
                    'Rohrdurchf√ºhrungen zugeschnitten',
                    'Eckst√ºcke zugeschnitten',
                    'Sockelst√ºcke angepasst',
                    'Fliesen mit Nassschneider zugeschnitten',
                    'Feinsteinzeug pr√§zise zugeschnitten',
                    'Naturstein wassergek√ºhlt geschnitten',
                    'Mosaik individuell angepasst',
                    'Fliesenstreifen zugeschnitten',
                    'Material f√ºr Verlegung zugeschnitten'
                ],
                'bad': [
                    'Badezimmer komplett gefliest',
                    'Sanit√§rbereich ausgef√ºhrt',
                    'Duschbereich abgedichtet und gefliest',
                    'Badezimmerw√§nde gefliest',
                    'Bodenfliesen im Bad verlegt',
                    'G√§ste-WC komplett gefliest',
                    'Badezimmer nach Kundenwunsch gestaltet',
                    'Nassbereich fachgerecht ausgef√ºhrt',
                    'Fliesenarbeiten im Bad abgeschlossen',
                    'Badezimmersanierung fertiggestellt'
                ],
                'dusche': [
                    'Duschbereich nach DIN abgedichtet',
                    'Duschwanne eingebaut',
                    'Bodengleiche Dusche erstellt',
                    'Duschrinne eingebaut',
                    'Duschbereich komplett gefliest',
                    'Walk-In-Dusche fachgerecht ausgef√ºhrt',
                    'Gef√§lleestrich in Dusche erstellt',
                    'Duschbereich rutschhemmend gefliest',
                    'Duschabtrennung montiert',
                    'Dusche komplett fertiggestellt'
                ],
                'k√ºche': [
                    'K√ºche gefliest',
                    'Fliesenspiegel erstellt',
                    'K√ºchenr√ºckwand gefliest',
                    'K√ºchenboden verlegt',
                    'Spritzschutz erstellt',
                    'K√ºchenw√§nde teilweise gefliest',
                    'Arbeitsfl√§che gefliest',
                    'Herdbereich mit Mosaikfliesen',
                    'K√ºche mit Feinsteinzeug belegt',
                    'K√ºchenbereich fertiggestellt'
                ],
                'terrasse': [
                    'Terrassenbelag verlegt',
                    'Au√üenfliesen frostfest verlegt',
                    'Terrassenplatten verlegt',
                    'Gef√§lle f√ºr Ablauf erstellt',
                    'Terrassenbelag fertiggestellt',
                    'Feinsteinzeug frostsicher verlegt',
                    'Bahnenverlegung auf Terrasse',
                    'Terrassenkanten mit Profil versehen',
                    'Au√üenbereich fachgerecht gefliest',
                    'Terrassensanierung abgeschlossen'
                ],
                'balkon': [
                    'Balkonbelag erneuert',
                    'Balkonfliesen verlegt',
                    'Balkonabdichtung erstellt',
                    'Balkonentw√§sserung integriert',
                    'Balkonbr√ºstung gefliest',
                    'Balkonsanierung fachgerecht',
                    'Frostfester Belag auf Balkon',
                    'Balkon mit Gef√§lle verlegt',
                    'Balkonrinne eingebaut',
                    'Balkonbelag fertiggestellt'
                ],
                'montage': [
                    'Sanit√§robjekte montiert',
                    'WC fachgerecht montiert',
                    'Waschbecken befestigt',
                    'Heizk√∂rper wieder montiert',
                    'Abschlussprofile montiert',
                    'Eckschutzschienen angebracht',
                    'T√ºrschwelle eingebaut',
                    'Sockelleisten montiert',
                    'Duschabtrennung installiert',
                    'Duschrinne eingebaut und angeschlossen',
                    'Bodenablauf montiert',
                    'Revisions√∂ffnung eingesetzt',
                    'Fliesenprofile eingebaut',
                    '√úbergangsprofil montiert',
                    'Eckverbinder angebracht',
                    'Randabschluss montiert',
                    'Waschtischunterschrank befestigt',
                    'Spiegelschrank montiert',
                    'Handtuchhalter angebracht',
                    'Accessoires montiert'
                ],
                'estrich': [
                    'Estrich auf Belegreife gepr√ºft',
                    'CM-Wert gemessen und dokumentiert',
                    'Estrich geschliffen',
                    'Estrichrisse saniert',
                    'Estrichoberfl√§che vorbereitet',
                    'Estrich grundiert',
                    'Ausgleichsmasse aufgetragen',
                    'Estrichfeld abgegrenzt',
                    'Randd√§mmstreifen gepr√ºft',
                    'Estrich f√ºr Fliesenverlegung vorbereitet'
                ],
                'naturstein': [
                    'Naturstein fachgerecht verlegt',
                    'Marmor im M√∂rtelbett gesetzt',
                    'Granit mit Spezialkleber verlegt',
                    'Naturstein impr√§gniert',
                    'Schiefer versiegelt',
                    'Travertin kristallisiert',
                    'Natursteinbelag poliert',
                    'Steinfugen elastisch ausgef√ºhrt',
                    'Naturstein gegen Verf√§rbung gesch√ºtzt',
                    'Natursteinsockel montiert'
                ],
                'heizung': [
                    'Fu√übodenheizung gepr√ºft',
                    'Aufheizprotokoll eingehalten',
                    'Heizestrich auf Belegreife gepr√ºft',
                    'Verlegung auf Fu√übodenheizung',
                    'Estrich nach Heizprotokoll belegreif',
                    'Fliesen auf Heizestrich verlegt',
                    'Heizungsrohre √ºberdeckt',
                    'W√§rmed√§mmung ber√ºcksichtigt',
                    'Fu√übodenheizung wieder in Betrieb',
                    'Aufheizprotokoll dokumentiert'
                ],
                'pool': [
                    'Poolbereich gefliest',
                    'Schwimmbeckenfliesen verlegt',
                    'Poolrand mit Formteilen ausgef√ºhrt',
                    '√úberlaufrinne eingebaut',
                    'Poolabdichtung erstellt',
                    'Mosaikbelag im Pool verlegt',
                    'Beckenkopf fachgerecht gefliest',
                    'Poolumgang rutschhemmend verlegt',
                    'Schwallwasserrinne eingebaut',
                    'Poolbereich fertiggestellt'
                ],
                'gewerbe': [
                    'Gewerbefl√§che gefliest',
                    'Ladenfl√§che mit Feinsteinzeug belegt',
                    'Verkaufsraum gefliest',
                    'Gro√ük√ºche gefliest',
                    'Produktionsbereich gefliest',
                    'Lagerbereich belegt',
                    'Sanit√§rr√§ume im Gewerbe ausgef√ºhrt',
                    'Empfangsbereich gestaltet',
                    'B√ºrofl√§che gefliest',
                    'Gewerbebereich fertiggestellt'
                ],
                'sanierung': [
                    'Badsanierung durchgef√ºhrt',
                    'Altbausanierung ausgef√ºhrt',
                    'Fliesensanierung abgeschlossen',
                    'Teilsanierung fertiggestellt',
                    'Komplettsanierung ausgef√ºhrt',
                    'Schadensbehebung durchgef√ºhrt',
                    'Sanierungsarbeiten abgeschlossen',
                    'Renovierung fertiggestellt',
                    'Modernisierung durchgef√ºhrt',
                    'Sanierung fachgerecht ausgef√ºhrt'
                ],
                'handel': [
                    'Fliesen fachgerecht verlegt',
                    'Material nach Kundenwunsch verarbeitet',
                    'Sonderfliesen aus Kundenbeistellung verlegt',
                    'Restposten fachgerecht verarbeitet',
                    'Muster vor Verlegung freigegeben',
                    'Material auf Vollst√§ndigkeit gepr√ºft',
                    'Fliesenlieferung angenommen',
                    'Zusatzmaterial nachbestellt',
                    'Chargen kontrolliert',
                    'Fliesen aus einer Brandpartie verlegt'
                ],
                'default': [
                    'Arbeiten fachgerecht ausgef√ºhrt',
                    'T√§tigkeit gem√§√ü Auftrag durchgef√ºhrt',
                    'Arbeitsschritte planm√§√üig abgeschlossen',
                    'Leistung nach Vorgabe erbracht',
                    'Qualit√§tskontrolle durchgef√ºhrt',
                    'Arbeiten nach Stand der Technik',
                    'Ausf√ºhrung nach DIN-Normen',
                    'Fachgerechte Ausf√ºhrung best√§tigt',
                    'Arbeiten termingerecht fertiggestellt',
                    'Leistung dokumentiert',
                    'Qualit√§t gesichert',
                    'Arbeitsschritte protokolliert',
                    'Tagesleistung erbracht',
                    'Fortschritt dokumentiert',
                    'Zwischenabnahme erfolgt'
                ]
            }
        };
        
        
        // ===== TEXT KORRIGIEREN =====
        function autokorrigiereText(text) {
            if (!text) return text;
            let korrigiert = text;
            korrigiert = korrigiert.charAt(0).toUpperCase() + korrigiert.slice(1);
            for (const [falsch, richtig] of Object.entries(baustellenDatenbank.autokorrektur)) {
                const regex = new RegExp('\\b' + falsch + '\\b', 'gi');
                korrigiert = korrigiert.replace(regex, richtig);
            }
            return korrigiert.replace(/\s+/g, ' ').trim();
        }
        
        // ===== STUNDEN EXTRAHIEREN =====
        function extrahiereStunden(text) {
            if (!text) return { stunden: null, taetigkeit: text };
            
            // Muster: "2 Stunden Fliesen verlegt" oder "Fliesen verlegt 2 Stunden"
            const muster = [
                /(\d+(?:[,\.]\d+)?)\s*(?:stunden?|std\.?|h)\s+(?:f√ºr\s+)?(.+)/i,
                /(.+?)\s+(\d+(?:[,\.]\d+)?)\s*(?:stunden?|std\.?|h)$/i,
                /(\d+(?:[,\.]\d+)?)\s*(?:stunden?|std\.?|h)\s+(.+)/i
            ];
            
            for (const m of muster) {
                const match = text.match(m);
                if (match) {
                    let stunden, taetigkeit;
                    if (/^\d/.test(match[1])) {
                        stunden = parseFloat(match[1].replace(',', '.'));
                        taetigkeit = match[2];
                    } else {
                        taetigkeit = match[1];
                        stunden = parseFloat(match[2].replace(',', '.'));
                    }
                    return { stunden, taetigkeit: taetigkeit.trim() };
                }
            }
            return { stunden: null, taetigkeit: text };
        }
        
        // ===== LOKALE VORSCHL√ÑGE =====
        function generiereLokalVorschlaege(text) {
            const textLower = text.toLowerCase();
            for (const [keyword, vorschlaege] of Object.entries(baustellenDatenbank.formulierungen)) {
                if (keyword !== 'default' && textLower.includes(keyword)) {
                    return [...vorschlaege];
                }
            }
            return [...baustellenDatenbank.formulierungen.default];
        }
        
        // ===== KI-VORSCHL√ÑGE MIT PUTER.JS =====
        async function generiereKIVorschlaege(text) {
            try {
                if (typeof puter === 'undefined') {
                    console.log('Puter.js nicht verf√ºgbar');
                    return [];
                }
                
                const prompt = `Du bist ein Experte f√ºr Baustellenberichte im Fliesenlegerhandwerk.
Der Nutzer hat per Sprache eingegeben: "${text}"

Erstelle 5 professionelle Formulierungen f√ºr einen offiziellen Baustellenbericht.
Kurz und pr√§gnant (max. 12 W√∂rter pro Vorschlag).
Antworte NUR mit den 5 Vorschl√§gen, einer pro Zeile, ohne Nummerierung.`;
                
                const response = await puter.ai.chat(prompt, { model: 'gpt-4o-mini' });
                if (response) {
                    return response.split('\n')
                        .map(line => line.replace(/^[\d\.\-\*]+\s*/, '').trim())
                        .filter(line => line.length > 5 && line.length < 150)
                        .slice(0, 5);
                }
            } catch (error) {
                console.log('KI nicht verf√ºgbar:', error.message);
            }
            return [];
        }
        
        // ===== HAUPTFUNKTION =====
        async function showTextVerbesserungModal(originalText, typ) {
            const korrigiert = autokorrigiereText(originalText);
            const { stunden, taetigkeit } = extrahiereStunden(korrigiert);
            const lokaleVorschlaege = generiereLokalVorschlaege(taetigkeit);
            
            // Modal erstellen
            const altesModal = document.getElementById('textVerbesserungModal');
            if (altesModal) altesModal.remove();
            
            const modal = document.createElement('div');
            modal.id = 'textVerbesserungModal';
            modal.style.cssText = 'position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.85);z-index:10002;display:flex;align-items:center;justify-content:center;padding:15px;';
            
            const stundenHtml = stunden ? `
                <div style="background:#fef3c7;padding:12px;border-radius:8px;margin-bottom:15px;border:2px solid #f59e0b;">
                    <div style="font-size:12px;color:#92400e;margin-bottom:5px;">‚è±Ô∏è Erkannte Stunden:</div>
                    <div style="display:flex;align-items:center;gap:10px;">
                        <input type="number" id="modalStunden" value="${stunden}" step="0.5" min="0" max="24"
                               style="width:80px;padding:8px;border:1px solid #d97706;border-radius:4px;font-size:16px;font-weight:bold;">
                        <span style="color:#92400e;font-weight:bold;">Stunden</span>
                    </div>
                </div>` : '';
            
            modal.innerHTML = `
                <div style="background:white;border-radius:16px;max-width:500px;width:100%;max-height:90vh;overflow-y:auto;">
                    <div style="padding:16px 20px;background:linear-gradient(135deg,#667eea,#764ba2);border-radius:16px 16px 0 0;">
                        <h3 style="margin:0;color:white;font-size:18px;">üé§ Spracheingabe verbessern</h3>
                    </div>
                    <div style="padding:20px;">
                        <div style="background:#f1f5f9;padding:10px 12px;border-radius:8px;margin-bottom:12px;">
                            <div style="font-size:11px;color:#64748b;">Erkannt:</div>
                            <div style="color:#475569;">"${originalText}"</div>
                        </div>
                        ${stundenHtml}
                        <div style="background:#dcfce7;padding:12px;border-radius:8px;margin-bottom:15px;cursor:pointer;border:2px solid #22c55e;" 
                             onclick="waehleTextvorschlag('${taetigkeit.replace(/'/g, "\\'")}', '${typ}')">
                            <div style="font-size:11px;color:#166534;">‚úÖ Korrigiert:</div>
                            <div style="color:#166534;font-weight:bold;">"${taetigkeit}"</div>
                        </div>
                        <div style="font-size:13px;color:#64748b;margin-bottom:8px;font-weight:500;">üìö Professionelle Formulierungen:</div>
                        <div id="lokaleVorschlaege">
                            ${lokaleVorschlaege.map(v => `
                                <div style="background:#f8fafc;padding:10px 12px;border-radius:8px;margin-bottom:6px;cursor:pointer;border:2px solid transparent;" 
                                     onclick="waehleTextvorschlag('${v.replace(/'/g, "\\'")}', '${typ}')"
                                     onmouseover="this.style.borderColor='#667eea';this.style.background='#eef2ff';"
                                     onmouseout="this.style.borderColor='transparent';this.style.background='#f8fafc';">
                                    ${v}
                                </div>
                            `).join('')}
                        </div>
                        <div id="kiVorschlaegeContainer" style="margin-top:15px;">
                            <div style="font-size:13px;color:#8b5cf6;margin-bottom:8px;">ü§ñ KI-Vorschl√§ge laden...</div>
                            <div style="text-align:center;padding:15px;">
                                <div style="display:inline-block;width:20px;height:20px;border:3px solid #e5e7eb;border-top-color:#8b5cf6;border-radius:50%;animation:spin 1s linear infinite;"></div>
                            </div>
                        </div>
                        <style>@keyframes spin{to{transform:rotate(360deg);}}</style>
                    </div>
                    <div style="padding:12px 20px 20px;display:flex;gap:10px;">
                        <button onclick="document.getElementById('textVerbesserungModal').remove()" 
                                style="flex:1;padding:12px;background:#e5e7eb;color:#475569;border:none;border-radius:8px;cursor:pointer;">‚ùå Abbrechen</button>
                        <button onclick="waehleTextvorschlag('${taetigkeit.replace(/'/g, "\\'")}', '${typ}')" 
                                style="flex:1;padding:12px;background:#22c55e;color:white;border:none;border-radius:8px;font-weight:bold;cursor:pointer;">‚úÖ √úbernehmen</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // KI laden
            const kiVorschlaege = await generiereKIVorschlaege(taetigkeit);
            const kiContainer = document.getElementById('kiVorschlaegeContainer');
            if (kiContainer) {
                if (kiVorschlaege.length > 0) {
                    kiContainer.innerHTML = `
                        <div style="font-size:13px;color:#8b5cf6;margin-bottom:8px;font-weight:500;">ü§ñ KI-Vorschl√§ge:</div>
                        ${kiVorschlaege.map(v => `
                            <div style="background:#faf5ff;padding:10px 12px;border-radius:8px;margin-bottom:6px;cursor:pointer;border:2px solid transparent;" 
                                 onclick="waehleTextvorschlag('${v.replace(/'/g, "\\'")}', '${typ}')"
                                 onmouseover="this.style.borderColor='#8b5cf6';this.style.background='#ede9fe';"
                                 onmouseout="this.style.borderColor='transparent';this.style.background='#faf5ff';">
                                ${v}
                            </div>
                        `).join('')}
                    `;
                } else {
                    kiContainer.innerHTML = '<div style="font-size:12px;color:#94a3b8;text-align:center;padding:10px;">KI-Vorschl√§ge nicht verf√ºgbar (offline)</div>';
                }
            }
        }
        
        // ===== VORSCHLAG √úBERNEHMEN =====
        function waehleTextvorschlag(text, typ) {
            const stundenInput = document.getElementById('modalStunden');
            const stunden = stundenInput ? parseFloat(stundenInput.value) : null;
            
            const modal = document.getElementById('textVerbesserungModal');
            if (modal) modal.remove();
            
            if (typ === 'taetigkeit') {
                const tbody = document.getElementById('taetigkeitenTable');
                const datum = document.getElementById('datum').value;
                const newRow = tbody.insertRow();
                newRow.className = 'editable-row';
                const stundenText = stunden ? stunden + ' Std' : '';
                
                newRow.innerHTML = `
                    <td contenteditable="true">${taetigkeitenRowCounter}</td>
                    <td>${datum}</td>
                    <td contenteditable="true">${text}</td>
                    <td contenteditable="true">${stundenText}</td>
                    <td contenteditable="true"></td>
                `;
                
                taetigkeitenRowCounter++;
                showToast(stunden ? `‚úÖ + ${stunden}h √ºbernommen` : '‚úÖ √úbernommen', 'success');
            } else if (typ === 'material') {
                const textarea = document.getElementById('material');
                textarea.value = textarea.value ? textarea.value + '\n' + text : text;
                showToast('‚úÖ Material √ºbernommen', 'success');
            }
        }
        
        // ===== TOAST NOTIFICATION =====
        function showToast(message, type = 'info') {
            const existingToast = document.querySelector('.toast');
            if (existingToast) existingToast.remove();
            
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.style.cssText = `
                position: fixed;
                bottom: 80px;
                left: 50%;
                transform: translateX(-50%);
                background: ${type === 'success' ? '#22c55e' : type === 'error' ? '#ef4444' : '#3b82f6'};
                color: white;
                padding: 12px 24px;
                border-radius: 8px;
                font-size: 14px;
                z-index: 10000;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            `;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => toast.remove(), 3000);
        }
        
        // ===== INITIALISIERUNG =====
        document.addEventListener('DOMContentLoaded', function() {
            // Tab-Navigation
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    tab.classList.add('active');
                    document.getElementById(tab.dataset.tab).classList.add('active');
                });
            });
            
            // Datum setzen
            const today = new Date().toISOString().split('T')[0];
            const datumInput = document.getElementById('datum');
            if (datumInput) datumInput.value = today;
            
            // Rapport-Nummer setzen
            const savedBerichte = JSON.parse(localStorage.getItem('baustellenberichte') || '[]');
            const nextNr = savedBerichte.length + 1;
            const rapportInput = document.getElementById('rapportNr');
            if (rapportInput) rapportInput.value = nextNr.toString().padStart(4, '0');
            
            // Gespeicherte Berichte laden
            loadBerichte();
            
            // Statistik
            const autoCount = Object.keys(baustellenDatenbank.autokorrektur).length;
            const formCategories = Object.keys(baustellenDatenbank.formulierungen).length;
            let formCount = 0;
            for (const arr of Object.values(baustellenDatenbank.formulierungen)) {
                formCount += arr.length;
            }
            console.log(`üìä Baustellenbericht v3.3 Ultra-Mega-Datenbank geladen:`);
            console.log(`   ‚úÖ ${autoCount} Autokorrekturen`);
            console.log(`   ‚úÖ ${formCount} Formulierungen in ${formCategories} Kategorien`);
            console.log(`   ‚úÖ Puter.js KI-Integration verf√ºgbar`);
        });
        
        
    </script>
</body>
</html>
